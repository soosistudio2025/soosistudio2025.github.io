<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">

<title>å®¿æ´—å¯µç‰© Soosi Pet | æ•¸ä½å¥‘ç´„ç³»çµ±</title>
    
    <link rel="manifest" href="manifest.json">
<meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å®¿æ´— Soosi">
    <link rel="apple-touch-icon" href="nav.png">
    <link rel="icon" type="image/png" href="nav.png">
    <meta name="theme-color" content="#6A8D73"> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        soosi: {
                            green: '#6A8D73',      // ä¸»è‰²ï¼šç¶ è‰²
                            wood: '#8E6E53',       // å‰¯è‰²ï¼šæœ¨é ­è‰²
                            dark: '#3F3F3F',       // æ–‡å­—ï¼šæ·±ç°
                            light: '#F9F7F2',      // èƒŒæ™¯ï¼šç±³ç™½
                            accent: '#E6C66D',     // é»ç¶´ï¼šé‡‘é»ƒ
                            red: '#D67D7D'         // è­¦ç¤ºï¼šæŸ”å’Œç´…
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', '"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest" defer></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

<style>
        :root {
            --brand-primary: #6A8D73;
            --brand-secondary: #8E6E53;
            --brand-bg: #F9F7F2;
            --brand-text: #3F3F3F;
        }

        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: var(--brand-bg);
            color: var(--brand-text);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }
        
      /* é¦–é  Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(106, 141, 115, 0.1);
            border-radius: 2rem;
            transition: all 0.3s ease;
        }

        /* å…§é  Cute Card */
        .cute-card {
            background: #FFFDF9;
            border: 2px solid #F0ECE6;
            border-radius: 1.5rem;
            box-shadow: 3px 3px 0px 0px rgba(142, 110, 83, 0.1);
            position: relative;
            overflow: hidden;
        }

        .dashed-divider {
            border-bottom: 2px dashed #EBE9E4;
            margin: 1.5rem 0;
        }

        /* è¼¸å…¥æ¡† */
        .cute-input {
            background: #ffffff;
            border: 2px solid #EBE9E4;
            border-radius: 1rem;
            color: var(--brand-text);
            transition: all 0.3s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        .cute-input:focus {
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 4px rgba(106, 141, 115, 0.15);
            outline: none;
            transform: translateY(-1px);
        }
        .cute-input.input-error {
            border-color: #D67D7D;
            background-color: #FFF5F5;
        }

        /* æŒ‰éˆ•æ¨£å¼ Pill */
        .pill-button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        .pill-button.active {
            background-color: var(--brand-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(106, 141, 115, 0.3);
            border-color: var(--brand-primary);
        }
        .pill-button.inactive {
            background-color: white;
            color: #8E6E53;
            border-color: #EBE9E4;
        }
        .pill-button.inactive:hover {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
        }
        /* éš±è—æ²è»¸ä½†ä¿ç•™æ»‘å‹•åŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ç°½åæ¿å…¨è¢å¹• */
        .fullscreen-signature {
            position: fixed;
            inset: 0;
            z-index: 200;
            touch-action: none;
            background-color: #F9F7F2;
            display: flex;
            flex-direction: column;
        }

        .bg-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
        }

        .field-error {
            color: #D67D7D;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        /* LINE åœ–ç‰‡ä¿®æ­£ */
        .line-img-fix {
            object-fit: contain;
            display: block;
        }
    </style>
</head>

<body>
    <div id="root"></div>

<script type="text/babel">
    // ğŸŒŸ æ–°å¢ï¼šå°‡ Base64 ç°½åè½‰ç‚º File ç‰©ä»¶
const dataURLtoFile = (dataurl, filename) => {
    let arr = dataurl.split(','),
        mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]),
        n = bstr.length,
        u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new File([u8arr], filename, { type: mime });
};
const { useState, useEffect, useRef, useMemo } = React;
// --- å·¥å…·ï¼šåœ–ç‰‡å£“ç¸®å‡½å¼ (å£“ç¸®è‡³ 1.5MB ä»¥ä¸‹ä¸”è½‰ç‚º JPEG) ---
            const compressImageFile = async (imageFile) => {
                // è¨­å®šå£“ç¸®é¸é …
                const options = {
                    maxSizeMB: 1.5,           // ç›®æ¨™å£“ç¸®åˆ° 1.5MB å·¦å³ (æ¸…æ¥šåˆç¯€çœç©ºé–“)
                    maxWidthOrHeight: 2048,   // é™åˆ¶æœ€å¤§é‚Šé•·ç‚º 2Kï¼Œç¢ºä¿ç´°ç¯€å¤ ç”¨
                    useWebWorker: true,       // ä½¿ç”¨å¤šåŸ·è¡Œç·’åŠ é€Ÿè™•ç†
                    fileType: 'image/jpeg',   // å¼·åˆ¶è½‰ç‚º JPEG æ ¼å¼ä»¥ç²å¾—æ›´å¥½å£“ç¸®ç‡
                    initialQuality: 0.85      // åˆå§‹ç•«è³ªåƒæ•¸
                };

                // å¦‚æœæª”æ¡ˆæœ¬ä¾†å°±å¾ˆå° (å°æ–¼è¨­å®šç›®æ¨™)ï¼Œå°±ç›´æ¥å›å‚³åŸæª”ï¼Œä¸åšè™•ç†
                if (imageFile.size / 1024 / 1024 <= options.maxSizeMB) {
                     return imageFile;
                }

                try {
                    console.log(`é–‹å§‹å£“ç¸®: åŸå¤§å° ${(imageFile.size / 1024 / 1024).toFixed(2)} MB`);
                    // åŸ·è¡Œå£“ç¸®
                    const compressedBlob = await imageCompression(imageFile, options);
                    console.log(`å£“ç¸®å®Œæˆ: æ–°å¤§å° ${(compressedBlob.size / 1024 / 1024).toFixed(2)} MB`);

                    // å°‡å£“ç¸®å¾Œçš„ Blob è½‰å› File ç‰©ä»¶ï¼Œä¸¦ä¿®æ”¹å‰¯æª”åç‚º .jpg
                    const newFileName = imageFile.name.substring(0, imageFile.name.lastIndexOf('.')) + '.jpg';
                    return new File([compressedBlob], newFileName, { type: 'image/jpeg' });

                } catch (error) {
                    console.error("åœ–ç‰‡å£“ç¸®å¤±æ•—:", error);
                    // å¦‚æœå£“ç¸®å¤±æ•—ï¼Œæ‹‹å‡ºéŒ¯èª¤è®“ä¸»æµç¨‹çŸ¥é“
                    throw new Error("åœ–ç‰‡è™•ç†å¤±æ•—ï¼Œè«‹æ›ä¸€å¼µè©¦è©¦çœ‹");
                }
            };

        const supabaseUrl = 'https://uhrngtsashumvwgzaumm.supabase.co'; 
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVocm5ndHNhc2h1bXZ3Z3phdW1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzMjMxNDUsImV4cCI6MjA4NDg5OTE0NX0.YDopNd9MHsjV9LFsHWyrxFIcWgQ_s0BMJlNSFqQfiTE';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (typeof window.lucide !== 'undefined' && iconRef.current) {
                    window.lucide.createIcons({
                        root: iconRef.current,
                        attrs: { "stroke-width": 2.5, class: className },
                        name: name
                    });
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"><i data-lucide={name} style={{ width: size, height: size }}></i></span>;
        };

// Modal Component (å¼·åˆ¶é–±è®€åˆ°åº•)
// 1. æ¢æ¬¾è¦–çª—
        const TermsModal = ({ isOpen, onClose, title, children, onAgree }) => {
            const contentRef = useRef(null);
            const [canAgree, setCanAgree] = useState(false);
            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollHeight - scrollTop - clientHeight < 50) setCanAgree(true);
            };
            useEffect(() => {
                if (isOpen) {
                    setCanAgree(false);
                    document.body.style.overflow = 'hidden';
                    setTimeout(() => {
                        if (contentRef.current && contentRef.current.scrollHeight <= contentRef.current.clientHeight + 10) setCanAgree(true);
                    }, 400);
                } else { document.body.style.overflow = ''; }
            }, [isOpen]);
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[150] bg-soosi-dark/40 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in">
                    <div className="w-full max-w-lg bg-white rounded-3xl shadow-2xl max-h-[85vh] flex flex-col overflow-hidden animate-in zoom-in-95">
                        <div className="px-6 py-4 bg-soosi-green text-white flex justify-between items-center shrink-0">
                            <h3 className="text-lg font-black tracking-wider flex items-center gap-2"><Icon name="file-text" size={18}/> {title}</h3>
                            <button onClick={onClose} className="p-1 hover:bg-white/20 rounded-full transition-colors"><Icon name="x" size={20} /></button>
                        </div>
                        <div ref={contentRef} onScroll={handleScroll} className="flex-1 overflow-y-auto p-6 text-sm leading-relaxed text-soosi-dark space-y-4 bg-[#F9F7F2]">
                            {children}
                            <div className="h-10"></div>
                        </div>
                        <div className="p-5 bg-white border-t-2 border-dashed border-gray-100 shrink-0">
                            {!canAgree && <div className="text-center text-xs font-bold text-soosi-red mb-3 animate-pulse">ğŸ‘‡ è«‹æ»‘å‹•å·è»¸è‡³æœ€åº•éƒ¨ä»¥å•Ÿç”¨æŒ‰éˆ•</div>}
                            <button onClick={() => { if(canAgree) { onAgree && onAgree(); onClose(); }}} disabled={!canAgree}
                                className={`w-full py-4 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all ${canAgree ? 'bg-soosi-wood text-white shadow-lg' : 'bg-gray-100 text-gray-400 cursor-not-allowed'}`}>
                                <Icon name={canAgree ? "check-circle" : "lock"} size={20} />
                                {canAgree ? "æˆ‘å·²è©³é–±ä¸¦åŒæ„" : "è«‹é–±è®€å®Œç•¢"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. æ¼‚äº®çš„å¯†ç¢¼é©—è­‰è¦–çª— (Modal æ¨£å¼)
        const PasswordModal = ({ isOpen, onClose, onConfirm }) => {
            const [pwd, setPwd] = useState("");
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[200] bg-soosi-dark/60 backdrop-blur-md flex items-center justify-center p-6 animate-in fade-in">
                    <div className="w-full max-w-xs bg-white rounded-[2.5rem] p-8 shadow-2xl animate-in zoom-in-95 flex flex-col items-center text-center">
                        <div className="w-16 h-16 bg-soosi-green/10 rounded-full flex items-center justify-center text-soosi-green mb-4">
                            <Icon name="lock" size={32} />
                        </div>
                        <h3 className="font-black text-xl text-soosi-dark mb-2">æ¬Šé™é©—è­‰</h3>
                        <p className="text-xs text-gray-400 mb-6">è«‹è¼¸å…¥åº—å®¶å¯†ç¢¼ä»¥ç”¢ç”Ÿé€£çµ</p>
                        <input 
                            type="password" 
                            autoFocus
                            value={pwd}
                            onChange={(e) => setPwd(e.target.value)}
                            placeholder="â€¢â€¢â€¢â€¢"
                            className="w-full cute-input px-4 py-3 text-center text-2xl tracking-[0.5em] mb-6 focus:ring-soosi-green/20"
                        />
                        <div className="flex gap-3 w-full">
                            <button onClick={onClose} className="flex-1 py-3 text-gray-400 font-bold text-sm">å–æ¶ˆ</button>
                            <button 
                                onClick={() => { onConfirm(pwd); setPwd(""); }}
                                className="flex-1 py-3 bg-soosi-green text-white rounded-2xl font-bold shadow-lg shadow-soosi-green/20 active:scale-95 transition-all"
                            >ç¢ºèª</button>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. å„ªæƒ çå‹µå½ˆçª— (æ–°å¢é€™å€‹çµ„ä»¶)
        const DiscountModal = ({ isOpen, message, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[250] bg-soosi-dark/60 backdrop-blur-md flex items-center justify-center p-6 animate-in fade-in">
                    <div className="w-full max-w-xs bg-white rounded-[2.5rem] p-8 shadow-2xl animate-in zoom-in-95 flex flex-col items-center text-center relative overflow-hidden">
                        {/* è£é£¾å…‰æšˆ */}
                        <div className="absolute -top-10 -right-10 w-32 h-32 bg-soosi-accent/20 rounded-full blur-2xl"></div>
                        <div className="absolute top-10 -left-10 w-20 h-20 bg-soosi-green/20 rounded-full blur-xl"></div>
                        
                        <div className="w-20 h-20 bg-soosi-accent/10 rounded-full flex items-center justify-center text-soosi-accent mb-4 ring-4 ring-soosi-accent/5">
                            <Icon name="gift" size={40} className="animate-bounce" />
                        </div>
                        
                        <h3 className="font-black text-2xl text-soosi-dark mb-2">æ­å–œç²å¾—å„ªæƒ ï¼</h3>
                        <p className="text-sm text-gray-500 mb-6 leading-relaxed">
                            {message || "ç¬¦åˆè€å®¢æˆ¶å›è¨ªè³‡æ ¼"}<br/>
                            <span className="text-soosi-red font-black text-lg">æœ¬æ¬¡å·²è‡ªå‹•æŠ˜æŠµ $200 å…ƒ</span>
                        </p>
                        
                        <button 
                            onClick={onClose}
                            className="w-full py-4 bg-soosi-wood text-white rounded-2xl font-black shadow-lg shadow-soosi-wood/20 active:scale-95 transition-all flex items-center justify-center gap-2 hover:bg-[#7a5e47]"
                        >
                            <Icon name="check" size={20} />
                            å¤ªæ£’äº†ï¼Œè¬è¬ï¼
                        </button>
                    </div>
                </div>
            );
        };

// --- 1. å®šç¾©åƒ¹ç›®è¡¨è³‡æ–™ (è¦–è¦ºå„ªåŒ–ç‰ˆ) ---
        const PRICE_DATA = {
            dogs: [
                { 
                    weight: '5kg ä»¥ä¸‹', 
                    typeA: 'å‰å¨ƒå¨ƒã€è¿·ä½ è‡˜è…¸ã€è¿·ä½ å“ã€çŸ­æ¯›å¹¼çŠ¬', 
                    typeB: 'è²´è³“ã€ç‘ªçˆ¾æ¿Ÿæ–¯ã€ç´„å…‹å¤ã€åšç¾ã€è¥¿æ–½ã€è´è¶çŠ¬', 
                    breeds: ['å‰å¨ƒå¨ƒ', 'è¿·ä½ è‡˜è…¸', 'è¿·ä½ å“', 'å¹¼çŠ¬', 'è²´è³“', 'ç‘ªçˆ¾æ¿Ÿæ–¯', 'ç´„å…‹å¤', 'åšç¾', 'è¥¿æ–½', 'è´è¶çŠ¬'],
                    small: '500~600', full: '800~1500' 
                },
                { 
                    weight: '5-10kg', 
                    typeA: 'å·´æˆˆã€æ³•é¬¥ã€æ¨™æº–è‡˜è…¸ã€å‚‘å…‹ç¾…ç´ ã€é›ªç´ç‘(çŸ­)', 
                    typeB: 'æ¯”ç†Šã€ç‹ç‹¸çŠ¬ã€è¥¿é«˜åœ°ã€åŒ—äº¬çŠ¬ã€é›ªç´ç‘(é•·)', 
                    breeds: ['å·´æˆˆ', 'æ³•é¬¥', 'æ¨™æº–è‡˜è…¸', 'å‚‘å…‹ç¾…ç´ ', 'é›ªç´ç‘', 'æ¯”ç†Š', 'ç‹ç‹¸çŠ¬', 'è¥¿é«˜åœ°', 'åŒ—äº¬çŠ¬'],
                    small: '600~900', full: '1200~1800' 
                },
                { 
                    weight: '10-20kg', 
                    typeA: 'æŸ¯åŸºã€æŸ´çŠ¬ã€ç±³æ ¼é­¯ã€å°ç£çŠ¬(å°)ã€æƒ æ¯”ç‰¹', 
                    typeB: 'å–œæ¨‚è’‚ã€é‚Šå¢ƒç‰§ç¾ŠçŠ¬ã€éŠ€ç‹ã€æ¾³æ´²ç‰§ç¾ŠçŠ¬', 
                    breeds: ['æŸ¯åŸº', 'æŸ´çŠ¬', 'ç±³æ ¼é­¯', 'å°ç£çŠ¬', 'æƒ æ¯”ç‰¹', 'å–œæ¨‚è’‚', 'é‚Šå¢ƒç‰§ç¾ŠçŠ¬', 'éŠ€ç‹', 'æ¾³æ´²ç‰§ç¾ŠçŠ¬'],
                    small: '1000~1800', full: '2000~3500' 
                },
                { 
                    weight: '20-30kg', 
                    typeA: 'å°ç£çŠ¬(ä¸­)ã€é«˜å±±çŠ¬ã€ç±³å…‹æ–¯(ä¸­)', 
                    typeB: 'å“ˆå£«å¥‡ã€é¬†ç…çŠ¬ã€æ¨™æº–è²´è³“ã€å¤ä»£ç‰§ç¾ŠçŠ¬', 
                    breeds: ['é«˜å±±çŠ¬', 'ç±³å…‹æ–¯', 'å“ˆå£«å¥‡', 'é¬†ç…çŠ¬', 'æ¨™æº–è²´è³“', 'å¤ä»£ç‰§ç¾ŠçŠ¬'],
                    small: '1400~2000', full: '2800~4500' 
                },
                { 
                    weight: '30-40kg', 
                    typeA: 'æ‹‰å¸ƒæ‹‰å¤šã€é»ƒé‡‘çµçŠ¬ã€å¨ç‘ªã€æœè³“ã€æ‹³å¸«', 
                    typeB: 'è–©æ‘©è€¶ã€ç§‹ç”°ã€å¤§å‹é¬†ç…ã€é˜¿å¯Œæ±—çµçŠ¬', 
                    breeds: ['æ‹‰å¸ƒæ‹‰å¤š', 'é»ƒé‡‘çµçŠ¬', 'å¨ç‘ª', 'æœè³“', 'æ‹³å¸«', 'è–©æ‘©è€¶', 'ç§‹ç”°', 'é˜¿å¯Œæ±—çµçŠ¬'],
                    small: '1800~2200', full: '3600~5500' 
                },
                { 
                    weight: '40kg ä»¥ä¸Š', 
                    typeA: 'å¤§ä¸¹ã€ç¾…å¨ç´ã€è—ç’ã€å¤§å‹ç’çŠ¬', 
                    typeB: 'é˜¿æ‹‰æ–¯åŠ ã€å¤§ç™½ç†Šã€è–ä¼¯ç´ã€ä¼¯æ©å±±', 
                    breeds: ['å¤§ä¸¹', 'ç¾…å¨ç´', 'è—ç’', 'å¤§å‹ç’çŠ¬', 'é˜¿æ‹‰æ–¯åŠ ', 'å¤§ç™½ç†Š', 'è–ä¼¯ç´', 'ä¼¯æ©å±±'],
                    small: '2000~2400', full: '4000~6500' 
                },
            ],
cats: [
    { type: 'å¹¼è²“', sub: '2-6å€‹æœˆ', small: '600', full: '-', note: '*è¦–è¦ªäººç¨‹åº¦' },
    { type: 'çŸ­æ¯›è²“', sub: '2-6kg / >6kg', small: '800 / 1000', full: '1600 / 2000', note: '*6kgä»¥ä¸Š +$100/kg' },
    { type: 'ä¸­é•·æ¯›', sub: '2-6kg / >6kg', small: '1000 / 1200', full: '2000 / 2400', note: '*6kgä»¥ä¸Š +$100/kg' },
    { type: 'é•·æ¯›è²“', sub: '2-6kg / >6kg', small: '1200 / 1400', full: '2400 / 2800', note: '*6kgä»¥ä¸Š +$100/kg' },
    // è²“å’ªå‡ç´šé …ç›®
    { type: 'å‡ç´šé …ç›®', sub: 'å»æ²¹é¸é …', small: 'å±€éƒ¨ 200', full: 'å…¨èº« 800~1000', note: '*è¦–æ¯›é‡èˆ‡ç‹€æ³è€Œå®š' },
],
extras: [
                { id: 'local', name: 'å±€éƒ¨ä¿®é£¾', desc: 'è²´è³“è‡‰/è…³', price: '$150 / $300', forDogOnly: true },
                { id: 'style', name: 'ç‰¹æ®Šé€ å‹', desc: 'è…³çƒ / è…³æŸ±', price: '$400èµ· / $600èµ·', forDogOnly: true },
                { id: 'scissor', name: 'å…¨èº«æ‰‹å‰ª', desc: 'å…¨èº«é€ å‹ä¿®å‰ª', price: '$500èµ·', forDogOnly: true },
                { id: 'other', name: 'å…¶ä»–è²»ç”¨', desc: 'æ‹†çµ / é™¤èš¤ / å…‡', price: 'ç¾å ´å ±åƒ¹', forDogOnly: false }
            ]
        };

// --- 2. å®šç¾©åƒ¹ç›®è¡¨é é¢ (å…¨è¢å¹•ç¨ç«‹é é¢ç‰ˆ) ---
const PriceListPage = ({ onBack }) => {
            const [activeTab, setActiveTab] = useState('small');
            const [searchQuery, setSearchQuery] = useState('');

            // è¨ˆç®—å“ªäº›å¡ç‰‡ç¬¦åˆæœå°‹æ¢ä»¶
            const filteredDogs = useMemo(() => {
                if (!searchQuery) return null;
                return PRICE_DATA.dogs.filter(item => 
                    item.typeA.includes(searchQuery) || 
                    item.typeB.includes(searchQuery) || 
                    item.weight.includes(searchQuery) ||
                    (item.breeds && item.breeds.some(b => b.includes(searchQuery)))
                );
            }, [searchQuery]);

            const groupedDogs = useMemo(() => ({
                small: [PRICE_DATA.dogs[0]],
                medium: [PRICE_DATA.dogs[1], PRICE_DATA.dogs[2]],
                large: [PRICE_DATA.dogs[3], PRICE_DATA.dogs[4], PRICE_DATA.dogs[5]]
            }), []);

            const TabBtn = ({ id, label, icon }) => (
                <button 
                    onClick={() => { setActiveTab(id); setSearchQuery(''); }}
                    className={`flex-1 py-3 rounded-xl text-xs font-bold transition-all border ${
                        activeTab === id && !searchQuery
                        ? 'bg-soosi-wood text-white border-soosi-wood shadow-md' 
                        : 'bg-white text-gray-400 border-gray-100'
                    }`}
                >
                    {icon} {label}
                </button>
            );

            // --- ç‹—ç‹—å¡ç‰‡çµ„ä»¶ (å·²å¥—ç”¨æ–°é¡è‰²è¦å‰‡) ---
            const PriceCard = ({ item }) => (
                <div className="bg-white rounded-2xl p-5 shadow-sm border border-soosi-wood/5 animate-in fade-in duration-300">
                    <div className="bg-soosi-green/10 text-soosi-green font-black px-3 py-1 rounded-lg text-xs w-fit mb-3">{item.weight}</div>
                    <div className="space-y-2 mb-4 text-xs">
                        <div className="flex gap-2"><span className="font-bold text-soosi-wood shrink-0">çŸ­æ¯›ï¼š</span><span className="text-gray-500">{item.typeA}</span></div>
                        <div className="flex gap-2"><span className="font-bold text-soosi-wood shrink-0">é•·æ¯›ï¼š</span><span className="text-gray-500">{item.typeB}</span></div>
                    </div>
                    <div className="grid grid-cols-2 gap-4 pt-3 border-t border-dashed">
                        {/* å°ç¾å®¹å€å¡Š */}
                        <div className="text-center">
                            <div className="text-[11px] text-black font-bold mb-1">å°ç¾å®¹</div>
                            <div className="font-mono font-black text-soosi-wood text-lg">${item.small}</div>
                        </div>
                        {/* å¤§ç¾å®¹å€å¡Š */}
                        <div className="text-center border-l border-gray-100">
                            <div className="text-[11px] text-black font-bold mb-1">å¤§ç¾å®¹</div>
                            <div className="font-mono font-black text-soosi-green text-lg">${item.full}</div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-[#F9F7F2] pb-20 animate-in slide-in-from-right duration-300">
                    <div className="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b px-4 py-3 flex items-center gap-3">
                        <button onClick={onBack} className="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-gray-400"><Icon name="arrow-left"/></button>
                        <div className="flex-1 relative">
                            <Icon name="search" size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-300"/>
                            <input 
                                type="text" 
                                placeholder="è¼¸å…¥å“ç¨®æœå°‹ (å¦‚: æŸ´çŠ¬)" 
                                className="w-full bg-gray-100 border-0 rounded-full pl-10 pr-4 py-2 text-sm focus:ring-2 focus:ring-soosi-wood/20"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>
                    </div>

                    <div className="p-4 space-y-5 max-w-lg mx-auto">
                        {!searchQuery && (
                            <div className="grid grid-cols-4 gap-1.5">
                                <TabBtn id="small" label="å°å‹" icon="ğŸ¾" />
                                <TabBtn id="medium" label="ä¸­å‹" icon="ğŸ•" />
                                <TabBtn id="large" label="å¤§å‹" icon="ğŸ¦®" />
                                <TabBtn id="cat" label="è²“å’ª" icon="ğŸ±" />
                            </div>
                        )}

{searchQuery ? (
    <div className="space-y-4">
        <div className="text-xs font-bold text-gray-400 px-1">æœå°‹çµæœï¼š</div>
        {filteredDogs?.length > 0 ? filteredDogs.map((item, i) => <PriceCard key={i} item={item} />) : <div className="text-center py-10 text-gray-300 font-bold">æ‰¾ä¸åˆ°ç›¸é—œçŠ¬ç¨®ï¼Œè«‹å˜—è©¦å…¶ä»–é—œéµå­—</div>}
    </div>
) : activeTab === 'cat' ? (

    <div className="space-y-4 animate-in fade-in">
        <div className="bg-white rounded-2xl p-6 shadow-sm border border-soosi-wood/5 relative overflow-hidden">
            <Icon name="cat" className="absolute -right-6 -bottom-6 text-soosi-wood/5 w-32 h-32" />
            <h4 className="font-black text-soosi-wood mb-5 text-lg">ğŸ± è²“å’ªç¾å®¹åƒ¹æ ¼</h4>
            <div className="space-y-6">
                {PRICE_DATA.cats.map((cat, i) => (
                    <div key={i} className="relative z-10 border-b border-gray-50 pb-4 last:border-0 last:pb-0">
                        <div className="flex justify-between items-baseline mb-3">
                            <span className="font-bold text-soosi-dark">{cat.type}</span>
                            <span className="text-[10px] text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full">{cat.sub}</span>
                        </div>
                        
                        {/* å¦‚æœæ˜¯å‡ç´šé …ç›®ï¼Œé¡¯ç¤ºä¸åŒçš„ä½ˆå±€ */}
                        {cat.type === 'å‡ç´šé …ç›®' ? (
                            <div className="grid grid-cols-2 gap-4 mt-3">
                                <div className="text-center">
                                    <div className="text-[10px] font-bold text-black mb-1">å±€éƒ¨å»æ²¹</div>
                                    <div className="font-mono font-black text-soosi-wood text-lg">${cat.small}</div>
                                </div>
                                <div className="text-center border-l border-gray-100">
                                    <div className="text-[10px] font-bold text-black mb-1">å…¨èº«å»æ²¹</div>
                                    <div className="font-mono font-black text-soosi-green text-lg">${cat.full}</div>
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-2 gap-4">
                                <div className="text-center">
                                    <div className="text-[10px] font-bold text-black mb-1">å°ç¾å®¹</div>
                                    <div className="font-mono font-black text-soosi-wood text-lg">${cat.small}</div>
                                </div>
                                <div className="text-center border-l border-gray-100">
                                    <div className="text-[10px] font-bold text-black mb-1">å¤§ç¾å®¹</div>
                                    <div className="font-mono font-black text-soosi-green text-lg">${cat.full}</div>
                                </div>
                            </div>
                        )}
                        
                        {/* é€™è£¡åŠ å…¥æ‚¨è¦æ±‚çš„å‚™è¨»é¡¯ç¤º */}
                        {cat.note && <div className="mt-2 text-[10px] text-red-400 font-bold text-right">{cat.note}</div>}
                    </div>
                ))}
            </div>
        </div>
    </div>
) : (

                            groupedDogs[activeTab].map((item, i) => <PriceCard key={i} item={item} />)
                        )}

                        {/* å…¶ä»–è²»ç”¨å€å¡Šï¼šè‡ªå‹•éæ¿¾å…§å®¹ */}
                        <div className="bg-white rounded-2xl p-6 shadow-sm border border-soosi-wood/5">
                            <h4 className="font-black text-soosi-wood mb-4 text-sm flex items-center gap-2">
                             âœ¨ å…¶ä»–è²»ç”¨é …ç›®
                            </h4>
                            {PRICE_DATA.extras
                                .filter(ex => activeTab === 'cat' ? !ex.forDogOnly : true)
                                .map((ex, i) => (
                                <div key={i} className="flex justify-between items-center py-3 border-b border-dashed border-gray-50 last:border-0">
                                    <div>
                                        <div className="font-bold text-soosi-dark text-sm">{ex.name}</div>
                                        <div className="text-[10px] text-gray-400">{ex.desc}</div>
                                    </div>
                                    <div className="text-soosi-wood font-mono font-bold">{ex.price}</div>
                                </div>
                            ))}
                        </div>

                        <div className="bg-yellow-50 text-yellow-800 p-4 rounded-2xl text-[11px] leading-relaxed border border-yellow-100">
                            <span className="font-bold block mb-1 underline">è¨ˆåƒ¹èªªæ˜ï¼š</span>
                            å¯¦éš›æ”¶è²»ä¾ç¾å ´æ¸¬é‡ã€Œé«”é‡ã€æ¯›é‡ã€å»¢æ¯›ç‹€æ³ã€ç‚ºæº–ã€‚è‹¥æœ‰åš´é‡æ‰“çµã€è·³èš¤ã€æ”»æ“Šè¡Œç‚ºï¼Œå°‡ç¾å ´å¦åŠ æ”¶è™•ç†è²»ã€‚
                            <br/><br/>
                            <span className="font-bold text-red-600">âš ï¸ æ³¨æ„ï¼šæœ¬åº—ä¸æ¥æœ‰å¯„ç”ŸèŸ²ã€å‚³æŸ“ç–¾ç—…ã€é»´èŒä¹‹é¡çš„æ¯›å­©ã€‚è‹¥éç¨‹ä¸­ç™¼ç¾ï¼Œå°‡é¡å¤–æ”¶å–ç’°å¢ƒæ¸…æ½”è²» $1000ã€‚</span>
                        </div>

                    </div>  
                  </div>
            );        };
        // --- ä½å®¿åƒ¹ç›®è¡¨ Modal (åœ–ç‰‡ç‰ˆ) ---
        const BoardingPriceModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[160] bg-soosi-dark/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200" onClick={onClose}>
                    <div className="w-full max-w-lg bg-white rounded-3xl shadow-2xl max-h-[85vh] flex flex-col overflow-hidden animate-in zoom-in-95" onClick={e => e.stopPropagation()}>
                        {/* Header */}
                        <div className="px-6 py-4 bg-soosi-green text-white flex justify-between items-center shrink-0">
                            <h3 className="text-lg font-black tracking-wider flex items-center gap-2"><Icon name="image" size={18}/> ä½å®¿åƒ¹ç›®è¡¨</h3>
                            <button onClick={onClose} className="p-1 hover:bg-white/20 rounded-full transition-colors"><Icon name="x" size={20} /></button>
                        </div>
                        
                        {/* åœ–ç‰‡å…§å®¹å€ */}
                        <div className="overflow-y-auto p-4 bg-[#F9F7F2] space-y-4">
                            {/* ç‹—ç‹—åƒ¹ç›®è¡¨ */}
                            <div className="bg-white p-2 rounded-xl shadow-sm border border-gray-100">
                                <div className="text-center text-xs font-bold text-gray-400 mb-2">- ç‹—ç‹—ä½å®¿ -</div>
                                {/* æª”åå°æ‡‰ dogprice.jpg (è«‹ç¢ºèªå‰¯æª”åæ˜¯ jpg ä¸æ˜¯ jgp) */}
                                <img src="./dogprice.jpg" alt="ç‹—ç‹—ä½å®¿åƒ¹ç›®è¡¨" className="w-full h-auto rounded-lg" onError={(e) => e.target.style.display = 'none'} />
                            </div>
                            
                            {/* è²“å’ªåƒ¹ç›®è¡¨ */}
                            <div className="bg-white p-2 rounded-xl shadow-sm border border-gray-100">
                                <div className="text-center text-xs font-bold text-gray-400 mb-2">- è²“å’ªä½å®¿ -</div>
                                {/* æª”åå°æ‡‰ catprice.jpg */}
                                <img src="./catprice.jpg" alt="è²“å’ªä½å®¿åƒ¹ç›®è¡¨" className="w-full h-auto rounded-lg" onError={(e) => e.target.style.display = 'none'} />
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
                    const PillBtn = ({ active, onClick, children, className = "" }) => (
                <button type="button" onClick={onClick} 
                    className={`pill-button flex-1 py-3 px-4 rounded-xl font-bold text-sm flex items-center justify-center gap-2 ${active ? 'active' : 'inactive'} ${className}`}>
                    {children}
                </button>
            );

const InputGroup = ({ label, error, id, children, required = false }) => (
    <div className="space-y-1.5" id={id}>
        <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1">
            {label} {required && <span className="text-red-500">*</span>}
        </label>
        {children}
        {/* ğŸŒŸ åªæœ‰é€™è£¡æœ‰ error ä¸”ä¸ç‚ºç©ºæ™‚ï¼Œç´…å­—æ‰æœƒå‡ºç¾ */}
        {error && <div className="field-error"><Icon name="alert-circle" size={12}/>{error}</div>}
    </div>
);
// --- ä¿®æ”¹å¾Œçš„é›†é»é€²åº¦å¡ (åŒ…å«å¥—ç”¨æŒ‰éˆ•) ---
const LoyaltyProgressCard = ({ info, formData, setFormData, isCustomerMode }) => {
    if (!info || info.count === undefined) return null;
    if (info.count === 0 && !info.message) return null;
    const isCompleted = info.eligible;
    const current = isCompleted ? 5 : info.count;
    const deadline = info.deadline;
    return (
        <div className={`cute-card p-5 border-2 bg-white relative overflow-hidden animate-in slide-in-from-top-4 duration-500 ${isCompleted ? 'border-soosi-red/30' : 'border-soosi-wood/20'}`}>
            {/* èƒŒæ™¯è£é£¾ */}
            <div className="absolute top-0 right-0 w-24 h-24 bg-soosi-accent/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
            
            <div className="flex justify-between items-start mb-4 relative z-10">
                <div className="flex items-center gap-2">
                    <div className="bg-soosi-wood text-white p-1.5 rounded-lg shadow-sm">
                        <Icon name="crown" size={18} />
                    </div>
                    <div>
                        <div className="text-[10px] font-bold text-gray-400 tracking-wider">50å¤©å›è¨ªå„ªæƒ </div>
                        <div className="text-sm font-black text-soosi-dark">
                            {isCompleted ? "ğŸ‰ æ­å–œé”æˆå„ªæƒ ï¼" : `ç›®å‰ç´¯ç©ï¼šç¬¬ ${current} æ¬¡`}
                        </div>
                    </div>
                </div>
                
                {/* â˜… æŒ‰éˆ•å€åŸŸï¼šç¬¦åˆè³‡æ ¼æ™‚é¡¯ç¤ºã€Œå¥—ç”¨æŒ‰éˆ•ã€ â˜… */}
                {isCompleted ? (
                    <button 
                        type="button"
                        disabled={isCustomerMode}
                        onClick={() => setFormData(p => ({ ...p, usePromo50: !p.usePromo50 }))}
                        className={`text-xs font-bold px-3 py-1.5 rounded-full transition-all flex items-center gap-1 shadow-sm active:scale-95 ${
                            formData.usePromo50 
                            ? 'bg-soosi-red text-white ring-2 ring-offset-1 ring-soosi-red' 
                            : 'bg-white text-soosi-red border border-soosi-red hover:bg-red-50'
                        }`}
                    >
                        <Icon name={formData.usePromo50 ? "check-circle" : "gift"} size={12}/>
                        {formData.usePromo50 ? "å·²å¥—ç”¨æŠ˜æ‰£" : "ç«‹å³æŠ˜æŠµ"}
                    </button>
                ) : (
                    /* æœªç¬¦åˆè³‡æ ¼æ™‚é¡¯ç¤ºæœŸé™æˆ–åŠ æ²¹æ–‡å­— */
                    deadline ? (
                        <div className="flex flex-col items-end">
                            <span className="text-[9px] font-bold text-gray-400">æœ¬è¼ªæˆªæ­¢</span>
                            <div className="flex items-center gap-1 bg-red-50 text-soosi-red px-2 py-1 rounded-md border border-red-100">
                                <Icon name="clock" size={10} />
<span className="text-[10px] font-black">{deadline ? deadline.split('T')[0] : ''}</span>
                            </div>
                        </div>
                    ) : (
                        <div className="px-2 py-1 rounded-md text-[10px] font-black bg-gray-100 text-gray-500">
                            åŠ æ²¹ï¼å¿«é”æˆäº†
                        </div>
                    )
                )}
            </div>

            {/* é€²åº¦æ¢å€åŸŸ */}
            <div className="relative px-2 py-2 mb-2">
                <div className="absolute top-1/2 left-0 w-full h-1.5 bg-gray-100 -translate-y-1/2 rounded-full z-0"></div>
<div className="absolute top-1/2 left-0 h-1.5 bg-gradient-to-r from-soosi-wood to-soosi-accent -translate-y-1/2 rounded-full z-0 transition-all duration-1000 ease-out" 
     style={{ width: `${Math.min(Math.max(0, (current - 1) * 25), 100)}%` }}></div>

                <div className="relative z-10 flex justify-between">
                    {[1, 2, 3, 4].map((step) => {
                        const active = current >= step;
                        return (
                            <div key={step} className="flex flex-col items-center gap-1 group">
                                <div className={`w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-black border-2 transition-all duration-500 ${
                                    active 
                                    ? 'bg-soosi-wood border-soosi-wood text-white shadow-md scale-110' 
                                    : 'bg-white border-gray-200 text-gray-300'
                                }`}>
                                    {active ? <Icon name="check" size={12}/> : step}
                                </div>
                            </div>
                        );
                    })}
                    <div className="flex flex-col items-center gap-1">
                        <div className={`w-9 h-9 -mt-1 rounded-full flex items-center justify-center border-2 transition-all duration-500 ${
                            isCompleted 
                            ? 'bg-soosi-red border-soosi-red text-white shadow-lg animate-bounce' 
                            : 'bg-white border-gray-200 text-gray-300'
                        }`}>
                            <Icon name="gift" size={18} />
                        </div>
                    </div>
                </div>
            </div>
            
{/* æç¤ºæ–‡å­— - ä¿®æ­£ï¼šç›´æ¥è®€å–å¾Œç«¯ info.message ä»¥é¡¯ç¤ºå„ªåŒ–æ–‡æ¡ˆ */}
            <div className="text-[10px] font-bold text-gray-400 text-center animate-in fade-in">
                 {isCompleted 
                    ? (formData.usePromo50 ? "æŠ˜æ‰£å·²ç”Ÿæ•ˆï¼Œæœ¬æ¬¡æ¶ˆè²»å°‡æŠ˜æŠµ $200" : "é»æ“Šä¸Šæ–¹æŒ‰éˆ•å³å¯ä½¿ç”¨å„ªæƒ ") 
                    : info.message}
            </div>
        </div>
    );
};
// --- å„ªåŒ–å¾Œçš„æ­·å²ç´€éŒ„å½ˆçª— (å…©éšæ®µé¸æ“‡) ---
const HistoryModal = ({ records, onClose, onSelect }) => {
    // è¨˜éŒ„ç•¶å‰é¸ä¸­çš„å¯µç‰© (null ä»£è¡¨åœ¨ç¬¬ä¸€å±¤åˆ—è¡¨)
    const [selectedPet, setSelectedPet] = useState(null);

    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-soosi-dark/40 backdrop-blur-sm animate-in fade-in">
            <div className="w-full max-w-md bg-white rounded-3xl overflow-hidden shadow-2xl flex flex-col max-h-[80vh]">
                
                {/* Header */}
                <div className="bg-soosi-wood p-6 text-white text-center relative">
                    {selectedPet && (
                        <button onClick={() => setSelectedPet(null)} className="absolute left-4 top-1/2 -translate-y-1/2 p-2 hover:bg-white/20 rounded-full transition-colors">
                            <Icon name="arrow-left" size={20}/>
                        </button>
                    )}
                    <h3 className="text-xl font-black">
                        {selectedPet ? `é¸æ“‡ ${selectedPet.name} çš„ç´€éŒ„` : "ğŸ‰ æ­¡è¿å›ä¾†ï¼"}
                    </h3>
                    <p className="text-sm opacity-80 mt-1">
                        {selectedPet ? "è«‹å•è¦å¸¶å…¥å“ªç¨®æœå‹™è³‡æ–™ï¼Ÿ" : "è«‹é¸æ“‡è¦å¸¶å…¥çš„æ¯›å­©ï¼š"}
                    </p>
                </div>

                {/* Content Area */}
                <div className="p-6 space-y-3 overflow-y-auto bg-[#F9F7F2] min-h-[200px]">
                    {!selectedPet && (
        <button onClick={() => onSelect({ ownerOnly: true, ...records[0].grooming || records[0].boarding })}
            className="w-full py-3 mb-2 bg-soosi-green/10 text-soosi-green border-2 border-dashed border-soosi-green/30 rounded-2xl font-black text-sm flex items-center justify-center gap-2 hover:bg-soosi-green/20 transition-all">
            <Icon name="user" size={18}/> åƒ…å¡«å…¥é£¼ä¸»è³‡æ–™ (ä¸å¸¶å…¥æ¯›å­©)
        </button>
    )}
                    {!selectedPet ? (
                        // ç¬¬ä¸€å±¤ï¼šé¡¯ç¤ºå¯µç‰©åˆ—è¡¨
                        records.map((pet, index) => (
                            <button key={index} onClick={() => setSelectedPet(pet)} 
                                className="w-full bg-white p-4 rounded-2xl border-2 border-transparent shadow-sm hover:border-soosi-wood hover:shadow-md transition-all text-left flex items-center gap-4 group">
                                <div className="w-12 h-12 rounded-full bg-soosi-wood/10 flex items-center justify-center text-soosi-wood font-black text-lg">
                                    {pet.name.charAt(0)}
                                </div>
                                <div className="flex-1">
                                    <div className="font-black text-soosi-dark text-lg">{pet.name}</div>
                                    <div className="flex gap-2 mt-1">
                                        {/* é¡¯ç¤ºè©²å¯µç‰©æœ‰å“ªäº›é¡å‹çš„ç´€éŒ„ */}
                                        {pet.grooming && <span className="text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-600 font-bold">æœ‰ç¾å®¹ç´€éŒ„</span>}
                                        {pet.boarding && <span className="text-[10px] px-2 py-0.5 rounded-full bg-orange-100 text-orange-600 font-bold">æœ‰ä½å®¿ç´€éŒ„</span>}
                                    </div>
                                </div>
                                <Icon name="chevron-right" className="text-gray-300 group-hover:text-soosi-wood" />
                            </button>
                        ))
                    ) : (
                        // ç¬¬äºŒå±¤ï¼šé¡¯ç¤ºè©²å¯µç‰©çš„ ç¾å®¹/ä½å®¿ é¸é …
                        <div className="space-y-4 animate-in slide-in-from-right duration-300">
                            {/* ç¾å®¹é¸é … */}
                            {selectedPet.grooming ? (
                                <button onClick={() => onSelect(selectedPet.grooming)} className="w-full bg-white p-5 rounded-2xl border-2 border-blue-100 hover:border-blue-400 shadow-sm hover:shadow-md transition-all text-left group relative overflow-hidden">
                                    <div className="absolute right-0 top-0 p-10 bg-blue-50 rounded-bl-full -mr-10 -mt-10 opacity-50 group-hover:scale-110 transition-transform"></div>
                                    <div className="relative z-10 flex items-center gap-4">
                                        <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
                                            <Icon name="scissors" size={20}/>
                                        </div>
                                        <div>
                                            <div className="font-black text-blue-800 text-lg">å¸¶å…¥ã€Œç¾å®¹ã€è³‡æ–™</div>
                                            <div className="text-xs text-gray-400 font-bold mt-1">
                                                ä¸Šæ¬¡æ¶ˆè²»ï¼š{new Date(selectedPet.grooming.created_at).toLocaleDateString()}
                                            </div>
                                        </div>
                                    </div>
                                </button>
                            ) : (
                                <div className="p-4 text-center text-gray-400 text-xs bg-gray-100 rounded-xl border border-dashed border-gray-300">
                                    æ­¤å¯µç‰©å°šç„¡ç¾å®¹ç´€éŒ„
                                </div>
                            )}

                            {/* ä½å®¿é¸é … */}
                            {selectedPet.boarding ? (
                                <button onClick={() => onSelect(selectedPet.boarding)} className="w-full bg-white p-5 rounded-2xl border-2 border-orange-100 hover:border-orange-400 shadow-sm hover:shadow-md transition-all text-left group relative overflow-hidden">
                                    <div className="absolute right-0 top-0 p-10 bg-orange-50 rounded-bl-full -mr-10 -mt-10 opacity-50 group-hover:scale-110 transition-transform"></div>
                                    <div className="relative z-10 flex items-center gap-4">
                                        <div className="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center">
                                            <Icon name="home" size={20}/>
                                        </div>
                                        <div>
                                            <div className="font-black text-orange-800 text-lg">å¸¶å…¥ã€Œä½å®¿ã€è³‡æ–™</div>
                                            <div className="text-xs text-gray-400 font-bold mt-1">
                                                ä¸Šæ¬¡æ¶ˆè²»ï¼š{new Date(selectedPet.boarding.created_at).toLocaleDateString()}
                                            </div>
                                            <div className="text-[10px] text-orange-400 mt-1">åŒ…å«é£²é£Ÿã€æ’æ³„ç¿’æ…£ç­‰è©³ç´°è³‡æ–™</div>
                                        </div>
                                    </div>
                                </button>
                            ) : (
                                <div className="p-4 text-center text-gray-400 text-xs bg-gray-100 rounded-xl border border-dashed border-gray-300">
                                    æ­¤å¯µç‰©å°šç„¡ä½å®¿ç´€éŒ„
                                </div>
                            )}
                        </div>
                    )}
                </div>

                <div className="p-4 bg-white border-t border-dashed">
                    <button onClick={onClose} className="w-full py-3 rounded-xl text-gray-400 font-bold text-sm hover:bg-gray-50 transition-colors">å–æ¶ˆæœå°‹</button>
                </div>
            </div>
        </div>
    );
};

const App = () => {
        
        // Toast ç‹€æ…‹
        const [toast, setToast] = useState(null);
        // ğŸŒŸ æ–°å¢ï¼šæ›´æ–°æç¤ºç‹€æ…‹
        const [showUpdate, setShowUpdate] = useState(false);

        // ğŸŒŸ æ–°å¢ï¼šService Worker ç›£è½é‚è¼¯ (æ•´åˆåœ¨ React å…§)
        useEffect(() => {
            if ('serviceWorker' in navigator) {
                const registerSW = async () => {
                    try {
                        // è¨»å†Š SW (é€™è£¡çš„ç‰ˆæœ¬è™Ÿ v=20 è¨˜å¾—è¦è·Ÿä½ çš„ sw.js åŒæ­¥æˆ–æ›´é«˜)
                        const registration = await navigator.serviceWorker.register('./sw.js?v=24');
                        
                        // ç›£è½æ›´æ–°
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                // ç•¶æ–°ç‰ˆæœ¬å®‰è£å®Œæˆ (installed) ä¸”ç›®å‰å·²ç¶“æœ‰æ§åˆ¶æ¬Š (controller) ä»£è¡¨æ˜¯æ›´æ–°è€Œéé¦–æ¬¡è¼‰å…¥
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // âœ¨ è§¸ç™¼æˆ‘å€‘è‡ªè¨‚çš„ UIï¼Œè€Œä¸æ˜¯é†œé†œçš„ alert
                                    setShowUpdate(true);
                                }
                            });
                        });
                    } catch (error) {
                        console.error('SW è¨»å†Šå¤±æ•—:', error);
                    }
                };
                registerSW();
            }
        }, []);
        // ğŸŒŸ æ–°å¢ï¼šæˆåŠŸé é¢æ‰€éœ€çš„ç‹€æ…‹
const [successData, setSuccessData] = useState(null);


        // ğŸŒŸ è‡ªå‹•å°‡åŸæœ¬çš„ alert è½‰æ›ç‚º Toast (å…¨ç«™çµ±ä¸€è¨­å®š)
        useEffect(() => {
            window.alert = (message) => {
                // æ ¹æ“šè¨Šæ¯å…§å®¹åˆ¤æ–·æ˜¯æˆåŠŸé‚„æ˜¯éŒ¯èª¤ (ç°¡å–®åˆ¤æ–·æ³•)
                const isSuccess = message.includes('æˆåŠŸ') || message.includes('âœ…') || message.includes('æ­¡è¿');
                setToast({ 
                    message, 
                    type: isSuccess ? 'success' : 'error' 
                });
                
                // 3ç§’å¾Œè‡ªå‹•é—œé–‰
                setTimeout(() => setToast(null), 3000);
            };
        }, []);

        // Toast UI çµ„ä»¶ (æ¸²æŸ“ç”¨)
        const ToastUI = () => {
            if (!toast) return null;
            return (
                <div className={`fixed top-6 left-1/2 -translate-x-1/2 z-[300] flex items-center gap-3 px-6 py-4 rounded-2xl shadow-2xl backdrop-blur-md animate-in slide-in-from-top-4 duration-300 ${toast.type === 'success' ? 'bg-soosi-green/90 text-white shadow-soosi-green/30' : 'bg-red-500/90 text-white shadow-red-500/30'}`}>
                    <Icon name={toast.type === 'success' ? "check-circle" : "alert-circle"} size={24} className="shrink-0" />
                    <span className="font-bold text-sm tracking-wide">{toast.message}</span>
                </div>
            );
        };
// ğŸŒŸ æ–°å¢ï¼šæ›´æ–°é€šçŸ¥çµ„ä»¶ (é¢¨æ ¼åŒ–æç¤º - ç½®é ‚é¿é–‹åŠ‰æµ·ç‰ˆ)
        const UpdatePrompt = ({ show, onUpdate }) => {
            if (!show) return null;
            return (
                // ä¿®æ”¹èªªæ˜ï¼š
                // 1. top-[calc(env(safe-area-inset-top)+1.5rem)] -> è‡ªå‹•è¨ˆç®—åŠ‰æµ·é«˜åº¦ä¸¦å¾€ä¸‹æ¨ 1.5rem
                // 2. z-[400] -> ç¢ºä¿åœ¨æœ€ä¸Šå±¤
                <div className="fixed left-6 right-6 z-[400] md:left-1/2 md:-translate-x-1/2 md:w-auto md:min-w-[320px] top-[calc(env(safe-area-inset-top)+1.5rem)]">
                    {/* å‹•ç•«æ”¹ç‚ºå¾ä¸Šæ–¹æ»‘å…¥ (slide-in-from-top-4) */}
                    <div className="bg-white p-4 rounded-2xl shadow-2xl border-2 border-soosi-green flex items-center justify-between gap-4 animate-in slide-in-from-top-4 duration-500">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-soosi-green text-white rounded-full flex items-center justify-center shrink-0 animate-spin-slow">
                                <Icon name="refresh-cw" size={20} />
                            </div>
                            <div>
                                <h4 className="font-black text-soosi-dark text-sm">ç™¼ç¾æ–°ç‰ˆæœ¬ï¼</h4>
                                <p className="text-[10px] text-gray-400 font-bold">æ›´æ–°ä»¥ç²å¾—æœ€ä½³é«”é©— âœ¨</p>
                            </div>
                        </div>
                        <button 
                            onClick={onUpdate}
                            className="bg-soosi-green text-white text-xs font-black px-4 py-2.5 rounded-xl shadow-lg shadow-soosi-green/20 hover:bg-[#5a7a63] active:scale-95 transition-all whitespace-nowrap"
                        >
                            ç«‹å³æ›´æ–°
                        </button>
                    </div>
                </div>
            );
        };
    // 2. é€šç”¨è¼¸å…¥è™•ç† (æ–‡å­—ã€æ—¥æœŸã€å–®é¸)
    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    // 3. è¤‡é¸æ¡†è™•ç† (é‡å°ç± å…§è¨“ç·´)
    const handleCheckboxChange = (e, field) => {
        const { value, checked } = e.target;
        setFormData(prev => {
            const currentValues = prev[field] || [];
            if (checked) {
                return { ...prev, [field]: [...currentValues, value] };
            } else {
                return { ...prev, [field]: currentValues.filter(v => v !== value) };
            }
        });
    };
const [logoClickCount, setLogoClickCount] = useState(0);

const handleLogoClick = () => {
    // æ¯æ¬¡é»æ“Šéƒ½çµ¦ä¸€å€‹è¼•å¾®çš„éœ‡å‹•å›é¥‹ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“ã€Œæœ‰æŒ‰åˆ°ã€
    if (navigator.vibrate) navigator.vibrate(30);

    setLogoClickCount(prev => {
        const newCount = prev + 1;
        if (newCount >= 2) {
            // æˆåŠŸè·³è½‰å‰éœ‡å‹•ä¹…ä¸€é» (50ms)ï¼Œé«”æ„Ÿæœƒéå¸¸æ˜é¡¯
            if (navigator.vibrate) navigator.vibrate(60);
            window.location.href = './admin.html'; 
            return 0;
        }
        // åˆ¤å®šæ™‚é–“ç¨å¾®æ‹‰é•·åˆ° 800msï¼Œè®“é»æ“Šä¸ç”¨é‚£éº¼è¶•
        setTimeout(() => setLogoClickCount(0), 800);
        return newCount;
    });
};
const [view, setView] = useState('entry'); 
            const [isBoarding, setIsBoarding] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [isUploading, setIsUploading] = useState(false); 
const [isSearching, setIsSearching] = useState(false);
            const [unavailableSlots, setUnavailableSlots] = useState([]); 
            const [showHistoryModal, setShowHistoryModal] = useState(false);



// --- ä¿®æ”¹å¾Œçš„æœå°‹èˆŠå®¢é‚è¼¯ (æ”¹ç”¨ RPC ç¹é RLS é™åˆ¶) ---
const handleSearchHistory = async () => {
    if (!formData.phone || formData.phone.length < 9) {
        alert("âš ï¸ è«‹å…ˆè¼¸å…¥å®Œæ•´çš„è¯çµ¡é›»è©±");
        return;
    }

    setIsSearching(true);
    try {
        // ğŸŒŸ é—œéµä¿®æ”¹ï¼šæ”¹ç”¨ rpc å‘¼å«å¾Œç«¯å‡½æ•¸ï¼Œè€Œä¸æ˜¯ç›´æ¥ select è³‡æ–™è¡¨
        const { data, error } = await supabase.rpc('search_guest_history', { 
            phone_input: formData.phone 
        });
        if (error) throw error;

        if (!data || data.length === 0) {
            alert("ğŸ” æŸ¥ç„¡æ­¤é›»è©±çš„éå¾€ç´€éŒ„");
            return;
        }

const allRecords = data.map(r => {
            // 1. å„ªå…ˆä½¿ç”¨è³‡æ–™åº«æ¬„ä½ (r.service_type)ï¼Œè‹¥ç„¡å‰‡æ‰¾ JSON å…§çš„
            const dbType = r.service_type || '';
            const innerData = r.raw_data.raw_data || r.raw_data || {};
            const jsonType = innerData.service_type || r.raw_data.service_type || '';
            
            // 2. ç¶œåˆåˆ¤æ–· (åªè¦ä»»ä¸€è™•é¡¯ç¤ºç‚ºä½å®¿/å®‰è¦ªï¼Œå°±è¦–ç‚ºä½å®¿)
            const isBoardingRecord = 
                dbType === 'boarding' || dbType === 'daycare' || 
                jsonType.includes('ä½å®¿') || jsonType.includes('å®‰è¦ª');

            const source = isBoardingRecord ? 'boarding' : 'grooming';
            
            return {
                ...innerData, 
                id: r.id,
                created_at: r.created_at,
                source: source
            };
        });

// --- æ ¸å¿ƒé‚è¼¯å„ªåŒ–ï¼šå…ˆä»¥ã€Œåå­—ã€åˆ†çµ„ï¼Œæ¯éš»å¯µç‰©åº•ä¸‹ä¿ç•™ã€Œæœ€æ–°ç¾å®¹ã€èˆ‡ã€Œæœ€æ–°ä½å®¿ã€ ---
        const petsGroup = {};

        // ä¾ç…§æ™‚é–“æ’åº (æœ€æ–°çš„åœ¨å‰)
        data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

        data.forEach(r => {
            // åˆ¤æ–·æœå‹™é¡å‹
            const dbType = r.service_type || '';
            const innerData = r.raw_data.raw_data || r.raw_data || {};
            const jsonType = innerData.service_type || r.raw_data.service_type || '';
            
            const isBoardingRecord = 
                dbType === 'boarding' || dbType === 'daycare' || 
                jsonType.includes('ä½å®¿') || jsonType.includes('å®‰è¦ª');

            const source = isBoardingRecord ? 'boarding' : 'grooming';
            
            // æº–å‚™å®Œæ•´çš„ç´€éŒ„ç‰©ä»¶
            const finalRecord = {
                ...innerData,
                id: r.id,
                created_at: r.created_at,
                source: source
            };

const petName = finalRecord.pet_name?.trim();
            if (!petName) return;

            // åˆå§‹åŒ–è©²å¯µç‰©çš„æ¬„ä½
            if (!petsGroup[petName]) {
                petsGroup[petName] = { 
                    name: petName, 
                    grooming: null, 
                    boarding: null,
                    lastSeen: finalRecord.created_at // ç”¨æ–¼æ’åºå¯µç‰©åˆ—è¡¨
                };
            }

            // å¦‚æœè©²é¡å‹é‚„æ²’æœ‰å­˜å…¥ç´€éŒ„ï¼Œå°±å­˜å…¥ (å› ç‚ºå·²ç¶“æŒ‰æ™‚é–“æ’åºï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹é‡åˆ°çš„ä¸€å®šæ˜¯æœ€æ–°çš„)
            if (source === 'grooming' && !petsGroup[petName].grooming) {
                petsGroup[petName].grooming = finalRecord;
            } else if (source === 'boarding' && !petsGroup[petName].boarding) {
                petsGroup[petName].boarding = finalRecord;
            }
        });

        // è½‰ç‚ºé™£åˆ—ä¸¦æ’åº (æœ€è¿‘æœ‰ä¾†çš„å¯µç‰©æ’ä¸Šé¢)
        const sortedPets = Object.values(petsGroup).sort((a, b) => new Date(b.lastSeen) - new Date(a.lastSeen));

        setHistoryRecords(sortedPets);
        setShowHistoryModal(true);

    } catch (err) {
        console.error("æœå°‹èˆŠå®¢å¤±æ•—:", err);
        alert("æœå°‹å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¢ºèªå¾Œç«¯è¨­å®šã€‚");
    } finally {
        setIsSearching(false);
    }
};

const handleApplyHistory = (record) => {
        // æ¨¡å¼ 1ï¼šåƒ…å¡«å…¥é£¼ä¸»è³‡æ–™
        if (record.ownerOnly) {
            setFormData(prev => ({
                ...prev,
                owner_name: record.owner_name,
                phone: record.phone,
                email: record.email,
                address: record.address,
                owner_id: record.owner_id,
                emergency_name: record.emergency_name,
                emergency_phone: record.emergency_phone
            }));
            setLineConfirmed(true);
            setShowHistoryModal(false);
            alert("âœ… å·²å¡«å…¥é£¼ä¸»åŸºæœ¬è³‡æ–™ã€‚");
            return;
        }

        // æ¨¡å¼ 2ï¼šå°å…¥å¯µç‰©å®Œæ•´æª”æ¡ˆè³‡è¨Š
        setFormData(prev => ({
            ...prev, // ä¿ç•™ç•¶å‰ç‹€æ…‹ï¼ˆå¦‚å¤šå¯µæ¨¡å¼ä¸‹çš„å…¶ä»–åˆ†é å…§å®¹ï¼‰

            // A. é£¼ä¸»æª”æ¡ˆ (è‡ªå‹•è£œå…¨ç©ºç¼º)
            owner_name: record.owner_name || prev.owner_name,
            phone: record.phone || prev.phone,
            email: record.email || prev.email,
            address: record.address || prev.address,
            owner_id: record.owner_id || prev.owner_id,
            emergency_name: record.emergency_name || prev.emergency_name,
            emergency_phone: record.emergency_phone || prev.emergency_phone,

            // B. å¯µç‰©åŸºæœ¬èº«åˆ†æª”æ¡ˆ
            pet_name: record.pet_name,
            pet_type: record.pet_type || 'dog',
            breed: record.breed,
            weight: record.weight,
            sex: record.sex,
            fix: record.fix,
            age: Math.floor(record.age || 0),
            age_months: Math.round(((record.age || 0) % 1) * 12) || '',
            is_under_one: record.age < 1 && record.age > 0,

            // C. é†«ç™‚èˆ‡æ€§æƒ…æª”æ¡ˆ
            medical_status: record.medical_status,
            medical_history: record.medical_history || [],
            medical_history_other: record.medical_history_other || '',
            chip_status: record.chip_status || '',
            chip_id: record.chip_id || '',
            preferred_clinic: record.preferred_clinic || '',
            grooming_temperament: record.grooming_temperament || '',
            social_aggression: record.social_aggression || '',
            social_play: record.social_play || '',
            personality: record.personality || '',
            specialNotes: record.specialNotes || '',
            allergies: record.allergies || '',

            // D. ç”Ÿæ´»ç¿’æ…£èˆ‡èª¿æŸ¥æª”æ¡ˆ (ä½å®¿æ¨¡å¼é‡è¦è³‡è¨Š)
            pica: record.pica || '',
            pica_note: record.pica_note || '',
            diet_type: record.diet_type || [],
            diet_type_other: record.diet_type_other || '',
            feeding_plan: record.feeding_plan || '',
            hasBoardingExp: record.hasBoardingExp || '',
            vaccine: record.vaccine || '',
            vaccine_url: record.vaccine_url || '',
            deworm: record.deworm || '',
            deworm_brand: record.deworm_brand || '',
            isBarking: record.isBarking || '',
            isFoodGuarding: record.isFoodGuarding || '',
            useToiletPad: record.useToiletPad || '',
            crateTraining: record.crateTraining || [],
            litter_type: record.litter_type || '',

// E. â˜… å¼·åˆ¶é‡ç½®ï¼šçµ•å°ä¸å¯å°å…¥çš„ã€Œäº¤æ˜“å…§å®¹ã€èˆ‡ç‰¹å®šåœ–ç‰‡ â˜…
            addGrooming: '',
            bookingDate: '',
            bookingTime: '',
            estimated_price: '',
            price_per_night: '',
            holiday_surcharge: '',
            boarding_grooming_price: '',
            service_items: [],
            service_items_other: '',
            usePromo50: false,
            proof_type: '',
            proof_url: '',    // ğŸŒŸ ç¢ºä¿æ¸…ç©ºæ´—æ¾¡è­‰æ˜
            vaccine_url: ''   // ğŸŒŸ ç¢ºä¿æ¸…ç©ºç–«è‹—æ‰‹å†Šç…§ç‰‡
        }));

        setLineConfirmed(true);
        setIsSearching(false);
        setShowHistoryModal(false);
        alert(`âœ… å·²å¸¶å…¥ ${record.pet_name} çš„éå¾€è³‡æ–™ã€‚`);
    };
    
// --- è™•ç†ç…§ç‰‡/æ”¶æ“šä¸Šå‚³ (å·²åŠ å…¥è‡ªå‹•å£“ç¸®) ---
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                try {
                    setIsUploading(true);
                    
                    // â˜… é—œéµæ­¥é©Ÿï¼šå…ˆåŸ·è¡Œå£“ç¸® â˜…
                    const compressedFile = await compressImageFile(file);

                    const fileExt = compressedFile.name.split('.').pop(); // ä½¿ç”¨å£“ç¸®å¾Œæª”æ¡ˆçš„å‰¯æª”å(jpg)
                    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.${fileExt}`;
                    const filePath = `${fileName}`; 

                    // ä¸Šå‚³å£“ç¸®å¾Œçš„æª”æ¡ˆ
                    const { data, error } = await supabase.storage
                        .from('receipts')
                        .upload(filePath, compressedFile);

                    if (error) throw error;

                    const { data: { publicUrl } } = supabase.storage
                        .from('receipts')
                        .getPublicUrl(filePath);
                    
                    setFormData(prev => ({ ...prev, proof_url: publicUrl }));
                    alert('è­‰æ˜ä¸Šå‚³æˆåŠŸï¼');

                } catch (error) {
                    console.error('Upload error:', error);
                    // å¦‚æœæ˜¯å£“ç¸®å¤±æ•—çš„éŒ¯èª¤ï¼Œé¡¯ç¤ºè‡ªå®šç¾©è¨Šæ¯
                    alert(error.message || 'ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦');
                } finally {
                    setIsUploading(false);
                    // æ¸…ç©º input valueï¼Œç¢ºä¿ä¸‹æ¬¡é¸åŒä¸€å¼µåœ–ä¹Ÿèƒ½è§¸ç™¼ onChange
                    e.target.value = ''; 
                }
            };

            // --- è™•ç†ç–«è‹—æ‰‹å†Šä¸Šå‚³ (å·²åŠ å…¥è‡ªå‹•å£“ç¸®) ---
            const [isUploadingVaccine, setIsUploadingVaccine] = useState(false);
            
            const handleVaccineUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // ç§»é™¤ 5MB é™åˆ¶è­¦å‘Š

                try {
                    setIsUploadingVaccine(true);

                    // â˜… é—œéµæ­¥é©Ÿï¼šå…ˆåŸ·è¡Œå£“ç¸® â˜…
                    const compressedFile = await compressImageFile(file);

                    const fileExt = compressedFile.name.split('.').pop();
                    const fileName = `vaccine_${Date.now()}_${Math.random().toString(36).substring(7)}.${fileExt}`;

                    // ä¸Šå‚³å£“ç¸®å¾Œçš„æª”æ¡ˆ
                    const { data, error } = await supabase.storage
                        .from('vaccines')
                        .upload(fileName, compressedFile);

                    if (error) throw error;

                    const { data: { publicUrl } } = supabase.storage
                        .from('vaccines')
                        .getPublicUrl(fileName);
                    
                    setFormData(prev => ({ ...prev, vaccine_url: publicUrl }));
                    alert('ç–«è‹—æ‰‹å†Šä¸Šå‚³æˆåŠŸï¼');

                } catch (error) {
                    console.error('Vaccine upload error:', error);
                     // å¦‚æœæ˜¯å£“ç¸®å¤±æ•—çš„éŒ¯èª¤ï¼Œé¡¯ç¤ºè‡ªå®šç¾©è¨Šæ¯
                    alert(error.message || 'æ‰‹å†Šä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦');
                } finally {
                    setIsUploadingVaccine(false);
                    e.target.value = '';
                }
            };
            const [errors, setErrors] = useState({});
const [lineConfirmed, setLineConfirmed] = useState(false);
            
            // 1. æ–°å¢ï¼šå®¢äººæ¨¡å¼ç‹€æ…‹èˆ‡é–å®šé‚è¼¯
            const [isCustomerMode, setIsCustomerMode] = useState(false);

            // 2. æ–°å¢ï¼šåˆå§‹åŒ–æª¢æŸ¥ç¶²å€åƒæ•¸ (ç•¶å®¢äººé»é–‹ã€Œç‰¹å®šé€£çµã€æ™‚åŸ·è¡Œ)
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const mode = params.get('mode');
                
                if (mode === 'customer') {
                    setIsCustomerMode(true); // é€²å…¥é–å®šæ¨¡å¼
                    setView('form'); // ç›´æ¥è·³åˆ°å¡«å¯«é é¢
                    
                    // åˆ¤æ–·æ˜¯ç¾å®¹é‚„æ˜¯ä½å®¿
                    const viewType = params.get('type');
                    if (viewType === 'boarding') setIsBoarding(true);
                    else setIsBoarding(false);

                    const newConfig = {};
                    // å¸¶å…¥é ç´„æ™‚é–“
                    if (params.get('date')) newConfig.bookingDate = params.get('date');
                    if (params.get('time')) newConfig.bookingTime = params.get('time');
                    if (params.get('in')) newConfig.checkInDate = params.get('in');
                    if (params.get('out')) newConfig.checkOutDate = params.get('out');

                    // å¸¶å…¥é‡‘é¡è¨­å®š
                    if (params.get('price')) newConfig.estimated_price = params.get('price'); 
                    if (params.get('ppn')) newConfig.price_per_night = params.get('ppn'); 
                    if (params.get('hol')) newConfig.holiday_surcharge = params.get('hol'); 
                    if (params.get('bgp')) newConfig.boarding_grooming_price = params.get('bgp'); 
                    if (params.get('pet_type')) newConfig.pet_type = params.get('pet_type');
                    // å¸¶å…¥æœå‹™é …ç›®
                    if (params.get('items')) {
                        newConfig.service_items = params.get('items').split(',');
                    }
                    if (params.get('other')) newConfig.service_items_other = decodeURIComponent(params.get('other'));
                    if (params.get('addGrooming')) newConfig.addGrooming = params.get('addGrooming') === 'true';

                    // ä¸€æ¬¡æ€§æ›´æ–°æ‰€æœ‰å¸¶å…¥çš„è³‡æ–™
                    setFormData(prev => ({ ...prev, ...newConfig }));
                }
            }, []);

// é»æ“ŠæŒ‰éˆ•æ™‚è§¸ç™¼
            const handleRequestLink = () => {
                setShowPwdModal(true);
            };

            // å¯†ç¢¼ç¢ºèªå¾ŒåŸ·è¡Œ
            const onPasswordVerified = (inputPwd) => {
                if (inputPwd !== "soosi") {
                    alert("å¯†ç¢¼éŒ¯èª¤ï¼");
                    return;
                }
                setShowPwdModal(false);
                
                // åŸ·è¡ŒåŸæœ¬çš„ç”¢ç”Ÿé€£çµé‚è¼¯
                const params = new URLSearchParams();
                params.set('mode', 'customer');
                
                if (isBoarding) {
                    params.set('type', 'boarding');
                    if (formData.checkInDate) params.set('in', formData.checkInDate);
                    if (formData.checkOutDate) params.set('out', formData.checkOutDate);
                    
                    // --- ğŸ› ï¸ ä¿®æ­£ï¼šå°‡ä½å®¿çš„ç´°é …é‡‘é¡ä¹Ÿå¸¶å…¥é€£çµ ---
                    if (formData.price_per_night) params.set('ppn', formData.price_per_night); // æ¯æ™šå–®åƒ¹
                    if (formData.holiday_surcharge) params.set('hol', formData.holiday_surcharge); // å‡æ—¥åŠ åƒ¹
                    if (formData.boarding_grooming_price) params.set('bgp', formData.boarding_grooming_price); // ç¾å®¹åŠ è³¼åƒ¹
                    
                    // è¨˜å¾—å¸¶å…¥æ˜¯å¦åŠ è³¼ç¾å®¹çš„ç‹€æ…‹ï¼Œä¸ç„¶å®¢äººç«¯ä¸æœƒé¡¯ç¤ºç¾å®¹é‡‘é¡æ¬„ä½
                    if (formData.addGrooming !== undefined) params.set('addGrooming', formData.addGrooming);
                    
                    // ç¸½é‡‘é¡
                    if (formData.estimated_price) params.set('price', formData.estimated_price);
                } else {
                    params.set('type', 'grooming');
                    if (formData.bookingDate) params.set('date', formData.bookingDate);
                    if (formData.bookingTime) params.set('time', formData.bookingTime);
                    if (formData.estimated_price) params.set('price', formData.estimated_price);
                }
                params.set('pet_type', formData.pet_type);
                if (formData.service_items.length > 0) params.set('items', formData.service_items.join(','));
                
                // å¸¶å…¥æœå‹™é …ç›®å‚™è¨» (ä¾‹å¦‚ï¼šåªå‰ªæŒ‡ç”²)
                if (formData.service_items_other) params.set('other', encodeURIComponent(formData.service_items_other));

                const finalUrl = `${window.location.href.split('?')[0].split('#')[0]}?${params.toString()}`;
                
                navigator.clipboard.writeText(finalUrl).then(() => {
                    alert("âœ… é–å®šé€£çµå·²æˆåŠŸè¤‡è£½ï¼\nç¾åœ¨æ‚¨å¯ä»¥è²¼ä¸Š LINE å‚³é€çµ¦å®¢äººå¡«å¯«ã€‚");
                });
            };

            // Signature State
            const [showFullSig, setShowFullSig] = useState(false);
            const [realtimeSig, setRealtimeSig] = useState(null);
            const sigCanvasRef = useRef(null);
            const padInstance = useRef(null);

            // Terms State
const [activeModal, setActiveModal] = useState(null);
const [showPwdModal, setShowPwdModal] = useState(false);
            const [termsRead, setTermsRead] = useState({ 
                grooming: false, 
                boarding: false, 
                highRiskGrooming: false, 
                highRiskBoarding: false 
            });
const [showDiscountModal, setShowDiscountModal] = useState(false);
    const [discountMessage, setDiscountMessage] = useState('');
const [formData, setFormData] = useState({
    email: '', owner_name: '', phone: '', owner_id: '', address: '',
    emergency_name: '', emergency_phone: '',
    pet_name: '', breed: '', weight: '', 
    age: '', age_months: '', is_under_one: false,
    sex: '', fix: '', 
    social_aggression: '', social_play: '', 
    grooming_temperament: '',
    chip_status: '', chip_id: '', preferred_clinic: '',
    medical_status: '', medical_history: [], medical_history_other: '',
    service_type: '', service_type_other: '', legal_agree: false,
    service_items: [], 
    service_items_other: '', 
estimated_price: '',
    hasTrialStay: false,
    pet_type: 'dog', 
isDaycare: false,
    bookingTimeEnd: '', // æ–°å¢ï¼šå®‰è¦ªçµæŸæ™‚é–“
usePromo50: false, // 50å¤©å„ªæƒ æ–¹æ¡ˆç‹€æ…‹
            image_auth: '', // ğŸŒŸ æ–°å¢ï¼šå½±åƒæˆæ¬Šç‹€æ…‹ (é è¨­ç©ºå­—ä¸²)
            isWalking: '', // ğŸŒŸ æ–°å¢ï¼šæ˜¯å¦æ•£æ­¥
        });

        useEffect(() => {
    const fetchBusySlots = async () => {
        // åˆ¤æ–·ç›®å‰æ˜¯ç¾å®¹é‚„æ˜¯ä½å®¿
        const targetDate = formData.bookingDate;

        if (!targetDate) {
            setUnavailableSlots([]);
            return;
        }

        try {
            const { data, error } = await supabase
                .from('busy_slots')
                .select('time_slot')
                .eq('date', targetDate);

            if (error) throw error;

            if (data) {
                const slots = data.map(item => item.time_slot);
                console.log(`ğŸ“… ${targetDate} å·²é—œé–‰æ™‚æ®µ:`, slots);
                setUnavailableSlots(slots);
            }
        } catch (err) {
            console.error("ç„¡æ³•è®€å–å¿™ç¢Œæ™‚æ®µ:", err);
        }
    };

    fetchBusySlots();
}, [formData.bookingDate]);
// â˜… æ–°å¢ï¼šé›†é»å¡è³‡è¨Šç‹€æ…‹
            const [loyaltyInfo, setLoyaltyInfo] = useState(null);

            // --- 1. å…ˆå®šç¾©å¯µç‰©åˆ—è¡¨ (ä¿®æ­£é †åºï¼šå¿…é ˆæ”¾åœ¨ useMemo ä¹‹å‰) ---
            const [petList, setPetList] = useState([{ id: 0, name: 'å¯µç‰© 1' }]);
            const [currentPetIdx, setCurrentPetIdx] = useState(0);

            // --- 2. å†å®šç¾©è¨ˆç®—æ‰€æœ‰å¯µç‰©çš„å³æ™‚ç‹€æ…‹ (ç”¨æ–¼é‡‘é¡åŠ ç¸½) ---
            const allPetsCurrentState = useMemo(() => {
                // å°‡ã€Œæš«å­˜åˆ—è¡¨ã€ä¸­çš„ç•¶å‰å¯µç‰©è³‡æ–™ï¼Œæ›¿æ›æˆã€Œæ­£åœ¨ç·¨è¼¯ä¸­ã€çš„ formData
                // é€™æ¨£å¯ä»¥ç¢ºä¿è¼¸å…¥åˆ°ä¸€åŠçš„æ•¸å€¼ä¹Ÿèƒ½å³æ™‚åæ‡‰åœ¨ç¸½é‡‘é¡
                if (!petList) return [formData];
                return petList.map((p, index) => index === currentPetIdx ? formData : p);
            }, [petList, formData, currentPetIdx]);

            // --- 3. æ–°å¢ï¼šåŒæ­¥æˆ¿åƒ¹/å‡æ—¥åŠ åƒ¹çµ¦æ‰€æœ‰å¯µç‰© (å› ç‚ºä½åŒä¸€é–“) ---
            const handleSharedPriceChange = (field, value) => {
                // A. æ›´æ–°ç•¶å‰æ­£åœ¨å¡«å¯«çš„è¡¨å–®
                setFormData(prev => ({ ...prev, [field]: value }));
                
                // B. åŒæ­¥æ›´æ–°åˆ—è¡¨è£¡çš„å…¶ä»–å¯µç‰© (ç¢ºä¿åˆ‡æ›åˆ†é æ™‚ï¼Œæˆ¿åƒ¹é‡‘é¡ä¸€è‡´)
                setPetList(prev => prev.map(p => ({ ...p, [field]: value })));
            };
// å®šç¾©éœ€è¦éš¨ Tab åˆ‡æ›çš„ã€Œå¯µç‰©å°ˆå±¬æ¬„ä½ã€
const PET_SPECIFIC_FIELDS = [
    'pet_name', 'pet_type', 'breed', 'weight', 'sex', 'fix', 
    'age', 'age_months', 'is_under_one', 
    'social_aggression', 'social_play', 'grooming_temperament',
    'chip_status', 'chip_id', 'preferred_clinic',
    'medical_status', 'medical_history', 'medical_history_other',
    'deworm', 'deworm_brand', 'vaccine', 'vaccine_url',
    'personality', 'specialNotes', 'allergies',
    'pica', 'pica_note', 'diet_type', 'diet_type_other', 'feeding_plan',
'isBarking', 'isFoodGuarding', 'useToiletPad', 'isWalking', 'crateTraining',
    'litter_type', 'hasBoardingExp',
    'service_items', 'service_items_other',
    'addGrooming', 'proof_type', 'proof_url', 'boarding_grooming_price',
    'hasTrialStay', 'estimated_price', 'usePromo50'
];

const saveCurrentPetToState = (idx) => {
    setPetList(prev => {
        const newList = [...prev];
        const petData = {};
        
        // ğŸŒŸ è‡ªå‹•åŒ–åŒæ­¥ï¼šç¢ºä¿æ‰€æœ‰åœ¨ PET_SPECIFIC_FIELDS å®šç¾©çš„æ¬„ä½éƒ½æœƒè¢«å­˜å…¥åˆ—è¡¨
        PET_SPECIFIC_FIELDS.forEach(field => {
            petData[field] = formData[field];
        });

        newList[idx] = { 
            ...newList[idx], 
            ...petData,
            // ä¿æŒç´¢å¼•æ¨™ç±¤çš„åå­—æ›´æ–°
            name: formData.pet_name || `å¯µç‰© ${idx + 1}`
        };
        return newList;
    });
};

// åˆ‡æ› Tab
const handleSwitchPet = (newIdx) => {
    if (newIdx === currentPetIdx) return;
    
    // 1. å…ˆæŠŠã€Œç•¶å‰æ­£åœ¨å¡«å¯«ã€çš„è³‡æ–™å­˜å›åˆ—è¡¨
    const currentPetData = {};
    PET_SPECIFIC_FIELDS.forEach(field => {
        currentPetData[field] = formData[field];
    });

    setPetList(prev => {
        const newList = [...prev];
        newList[currentPetIdx] = { 
            ...newList[currentPetIdx], 
            ...currentPetData,
            name: formData.pet_name || `å¯µç‰© ${currentPetIdx + 1}`
        };
        
        // 2. å­˜å®Œå¾Œç«‹å³å¾ newList è®€å–ç›®æ¨™å¯µç‰©çš„è³‡æ–™
        const targetPet = newList[newIdx];
        setFormData(prev => {
            const nextState = { ...prev };
            PET_SPECIFIC_FIELDS.forEach(field => {
                if (['service_items', 'medical_history', 'diet_type', 'crateTraining'].includes(field)) {
                    nextState[field] = targetPet[field] || [];
                } else if (field === 'pet_type') {
                    nextState[field] = targetPet[field] || 'dog';
                } else if (['is_under_one', 'hasTrialStay', 'addGrooming', 'usePromo50'].includes(field)) {
                    nextState[field] = targetPet[field] || false;
                } else {
                    nextState[field] = targetPet[field] || '';
                }
            });
            return nextState;
        });
        return newList;
    });
    
    setCurrentPetIdx(newIdx);
};

// æ–°å¢å¯µç‰©
const handleAddPet = () => {
    saveCurrentPetToState(currentPetIdx);
    const newIdx = petList.length;
    setPetList(prev => [...prev, { id: newIdx, name: `å¯µç‰© ${newIdx + 1}` }]);
    
    // æ¸…ç©ºè¡¨å–®ä¾›å¡«å¯«
    setFormData(prev => {
        const nextState = { ...prev };
        PET_SPECIFIC_FIELDS.forEach(field => {
            if (['service_items', 'medical_history', 'diet_type', 'crateTraining'].includes(field)) {
                nextState[field] = [];
            } else if (field === 'pet_type') {
                // æ–°å¢å¯µç‰©æ™‚ï¼Œé è¨­è·Ÿä¸Šä¸€éš»ä¸€æ¨£çš„ç¨®é¡ï¼Œé«”é©—æœƒæ¯”è¼ƒå¥½
                nextState[field] = prev.pet_type || 'dog'; 
            } else if (['is_under_one', 'hasTrialStay', 'addGrooming', 'usePromo50'].includes(field)) {
                // ğŸŒŸ ä¿®æ­£ï¼šå¸ƒæ—å€¼æ¬„ä½æ‡‰è©²é‡ç½®ç‚º falseï¼Œè€Œä¸æ˜¯ç©ºå­—ä¸²
                nextState[field] = false;
            } else if (field === 'estimated_price') {
                nextState[field] = '';
            } else {
                nextState[field] = '';
            }
        });
        return nextState;
    });
    setCurrentPetIdx(newIdx);
};

// åˆªé™¤å¯µç‰©
const handleDeletePet = (e, idx) => {
    e.stopPropagation();
    if (petList.length <= 1) { alert("è‡³å°‘éœ€è¦å¡«å¯«ä¸€éš»å¯µç‰©è³‡æ–™å–”ï¼"); return; }
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ ${petList[idx].name || 'é€™éš»å¯µç‰©'} çš„è³‡æ–™å—ï¼Ÿ`)) return;

    if (idx === currentPetIdx) {
        const targetIdx = idx === 0 ? 1 : idx - 1;
        const targetPet = petList[targetIdx];
        setFormData(prev => {
            const nextState = { ...prev };
            PET_SPECIFIC_FIELDS.forEach(field => {
                if (['service_items', 'medical_history', 'diet_type', 'crateTraining'].includes(field)) nextState[field] = targetPet[field] || [];
                else nextState[field] = targetPet[field] || '';
            });
            return nextState;
        });
        setCurrentPetIdx(targetIdx);
    } else if (idx < currentPetIdx) {
        setCurrentPetIdx(prev => prev - 1);
    }
    setPetList(prev => prev.filter((_, i) => i !== idx));
};
// --- æ›´æ–°ï¼šè‡ªå‹•åµæ¸¬å„ªæƒ è³‡æ ¼ (Debug åµéŒ¯ç‰ˆ) ---
    useEffect(() => {
        const checkLoyalty = async () => {
            console.log("ğŸ“Š [1-1] ç•¶å‰è¡¨å–®ç‹€æ…‹:", {
                phone: formData.phone,
                pet_name: formData.pet_name,
                isBoarding: isBoarding,
                addGrooming: formData.addGrooming,
                usePromo50: formData.usePromo50,
                checkDate: formData.bookingDate || formData.checkInDate || "ä½¿ç”¨ä»Šæ—¥"
            });

            // æ¢ä»¶ 1: åŸºæœ¬è³‡æ–™
            if (!formData.phone || !formData.pet_name) { console.log("âŒ [End] ç¼ºä¹é›»è©±æˆ–å¯µç‰©åï¼Œåœæ­¢æª¢æŸ¥"); return; }
            if (formData.phone.length < 9) { console.log("âŒ [End] é›»è©±é•·åº¦ä¸è¶³"); return; }

            // æ¢ä»¶ 2: ä½å®¿/ç¾å®¹é‚è¼¯åˆ¤æ–·
            if (isBoarding && !formData.addGrooming) {
                console.log("âŒ [End] ä½å®¿ä¸”æœªåŠ è³¼ç¾å®¹ï¼Œä¸ç¬¦åˆå„ªæƒ è³‡æ ¼");
                if (formData.usePromo50) setFormData(prev => ({ ...prev, usePromo50: false }));
                return;
            }

            // æ¢ä»¶ 3: å¦‚æœå·²ç¶“æ˜¯å„ªæƒ ç‹€æ…‹ï¼Œå°±ä¸é‡è¤‡æª¢æŸ¥ (é˜²æ­¢ç„¡é™è¿´åœˆï¼Œä½†æœƒ log å‡ºä¾†)
            if (formData.usePromo50) {
                console.log("âš ï¸ [Skip] ç•¶å‰ç‹€æ…‹å·²æ˜¯ã€Œå„ªæƒ ä¸­ã€ï¼Œè·³éå¾Œç«¯æª¢æŸ¥");
                // é€™è£¡æˆ‘å€‘ä¸ returnï¼Œç‚ºäº†è®“ä½ çœ‹åˆ°æ˜¯ä¸æ˜¯å› ç‚ºé€™å€‹åŸå› å¡ä½ï¼Œæˆ‘å€‘ç¹¼çºŒå¾€ä¸‹è·‘ï¼Œä½†å¯¦å‹™ä¸Šé€šå¸¸æœƒæ“‹
            }

            try {
                const checkDate = formData.bookingDate || formData.checkInDate || new Date().toISOString().split('T')[0];
                console.log(`ğŸš€ [2] å‘¼å« Supabase RPC (check_loyalty_eligibility)... æ—¥æœŸ: ${checkDate}`);

                const { data, error } = await supabase.rpc('check_loyalty_eligibility', {
                    p_phone: formData.phone,
                    p_pet_name: formData.pet_name,
                    p_check_date: checkDate
                });

                if (error) {
                    console.error("ğŸ”¥ [Error] RPC å‘¼å«å¤±æ•—:", error);
                    throw error;
                }

console.log("âœ… [3] Supabase å›å‚³çµæœ:", data);

                // â˜… ä¿®æ”¹ï¼šå°‡å¾Œç«¯å›å‚³çš„é›†é»è³‡è¨Šå­˜å…¥ Stateï¼Œä¾›ä»‹é¢é¡¯ç¤º
if (data) {
                    setLoyaltyInfo({
                        count: data.count || 0,
                        eligible: data.eligible,
                        deadline: data.deadline, 
                        message: data.message
                    });

                    // åŸæœ¬çš„å„ªæƒ å½ˆçª—èˆ‡å‹¾é¸é‚è¼¯
                    if (data.eligible) {
                        console.log("ğŸ‰ [Result] ç¬¦åˆè³‡æ ¼ï¼");
                        if (!formData.usePromo50) { 
                            setFormData(prev => ({ ...prev, usePromo50: true }));
                            setDiscountMessage(data.message);
                            setShowDiscountModal(true); 
                        }
                    } else {
                        console.log("â„ï¸ [Result] ä¸ç¬¦åˆè³‡æ ¼");
                        if (formData.usePromo50) {
                            setFormData(prev => ({ ...prev, usePromo50: false }));
                        }
                    }
                }

            } catch (err) {
                console.error("ğŸ”¥ [Fatal Error] å„ªæƒ æª¢æŸ¥å´©æ½°:", err);
            }
        };

        // è¨­å®šå»¶é²åŸ·è¡Œ (Debounce)
        const timer = setTimeout(() => {
            checkLoyalty();
        }, 1000);

        return () => clearTimeout(timer);

    }, [formData.phone, formData.pet_name, formData.bookingDate, formData.checkInDate, formData.addGrooming, isBoarding, isCustomerMode, formData.usePromo50]); 
    // â†‘ æ³¨æ„ï¼šæˆ‘åœ¨ä¾è³´é™£åˆ—æœ€å¾ŒåŠ äº† formData.usePromo50 ç¢ºä¿ç‹€æ…‹æ”¹è®Šæœƒè§¸ç™¼ log  

            // Routing
            useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash;
                    if (hash === '#grooming') {
                        setView('form'); setIsBoarding(false); window.scrollTo(0, 0);
                    } else if (hash === '#boarding') {
                        setView('form'); setIsBoarding(true); window.scrollTo(0, 0);
                    } else {
                        setView('entry');
                        if(window.location.hash) history.replaceState(null, null, ' ');
                    }
                };
                handleHashChange(); 
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            const goHome = () => { window.location.hash = ''; };
            const goGrooming = () => { window.location.hash = 'grooming'; };
            const goBoarding = () => { window.location.hash = 'boarding'; };

            // Logic Helpers
            const actualAge = useMemo(() => {
                if (formData.is_under_one && formData.age_months) return parseFloat(formData.age_months) / 12;
                return parseFloat(formData.age) || 0;
            }, [formData.age, formData.age_months, formData.is_under_one]);

// --- ğŸŒŸ ä¿®æ”¹ï¼šå…¨åŸŸé«˜é¢¨éšªèˆ‡ç¾å®¹åŠ è³¼åˆ¤å®š (æª¢æŸ¥æ‰€æœ‰å¯µç‰©) ---
const { isHighRisk, riskType, hasAnyGrooming } = useMemo(() => {
                let foundHighRisk = false;
                let foundGrooming = false;
                let type = null;

                // ğŸ›¡ï¸ ç¢ºä¿ pet å­˜åœ¨ï¼Œé¿å…è®€å–å±¬æ€§æ™‚å´©æ½°
                for (const pet of (allPetsCurrentState || [])) {
                    if (!pet) continue;
                    // 1. æª¢æŸ¥ç¾å®¹åŠ è³¼
                    if (pet.addGrooming) foundGrooming = true;

                    // 2. æª¢æŸ¥é«˜é¢¨éšª
                    const pAge = pet.is_under_one && pet.age_months 
                        ? parseFloat(pet.age_months) / 12 
                        : parseFloat(pet.age) || 0;
                    
                    const isSenior = pAge >= 8;
                    const isPuppy = pAge > 0 && pAge < 0.42; 
                    const isMedical = pet.medical_status === 'æœ‰';

                    if (isSenior || isPuppy || isMedical) {
                        foundHighRisk = true;
                        // æ±ºå®šé¡¯ç¤ºçš„é¢¨éšªé¡å‹ (å„ªå…ˆç´šï¼šç—…å² > è€çŠ¬ > å¹¼çŠ¬)
                        if (!type) {
                            if (isMedical) type = 'medical';
                            else if (isSenior) type = 'senior';
                            else if (isPuppy) type = 'puppy';
                        } else if (type !== 'medical' && isMedical) {
                             type = 'medical'; // å‡ç´šç‚ºç—…å²æé†’
                        }
                    }
                }
                return { isHighRisk: foundHighRisk, riskType: type, hasAnyGrooming: foundGrooming };
            }, [allPetsCurrentState]);

            // --- æ–°å¢ï¼šä½å®¿å¤©æ•¸è¨ˆç®— ---
            const stayDuration = useMemo(() => {
                if (!formData.checkInDate || !formData.checkOutDate) return null;
                const start = new Date(formData.checkInDate);
                const end = new Date(formData.checkOutDate);
                const diffTime = end - start;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays > 0 ? diffDays : null;
            }, [formData.checkInDate, formData.checkOutDate]);

            // --- æ–°å¢ï¼šç¾å®¹æ™‚æ®µç”¢ç”Ÿ (æ¯åŠå°æ™‚) ---
            const timeSlots = useMemo(() => {
                const slots = [];
                const startHour = 10; // 10:00 é–‹å§‹
                const endHour = 18;   // 18:00 çµæŸ
                for (let i = startHour; i < endHour; i++) {
                    slots.push(`${i}:00`);
                    slots.push(`${i}:30`);
                }
                slots.push(`${endHour}:00`);
                return slots;
            }, []);
            
// æ¢æ¬¾å®Œæˆæª¢æŸ¥ (é‚è¼¯æ›´æ–°ï¼šä½¿ç”¨å…¨åŸŸåˆ¤å®š)
            const allTermsRead = useMemo(() => {
                // ğŸŒŸ ä¿®æ”¹ï¼šåªè¦æœ‰ä»»æ„ä¸€éš»å¯µç‰©åŠ è³¼ç¾å®¹ (hasAnyGrooming)ï¼Œå°±éœ€è¦è®€ç¾å®¹æ¢æ¬¾
                const needGroomingTerms = !isBoarding || (isBoarding && hasAnyGrooming);
                
                // 1. åŸºç¤ç¾å®¹æ¢æ¬¾
                if (needGroomingTerms && !termsRead.grooming) return false;
                
                // 2. ä½å®¿æ¢æ¬¾ (ä½å®¿å®¢å¿…è®€)
                if (isBoarding && !termsRead.boarding) return false;
                
                // 3. é«˜é¢¨éšªåˆ¤å®š (ä»»æ„ä¸€éš»ç¬¦åˆå³è§¸ç™¼)
                if (isHighRisk) {
                    // é«˜é¢¨éšªç¾å®¹ (æœ‰åšç¾å®¹æ‰éœ€è®€)
                    if (needGroomingTerms && !termsRead.highRiskGrooming) return false;
                    
                    // é«˜é¢¨éšªä½å®¿ (ä½å®¿ + é«˜é¢¨éšªå¿…è®€)
                    if (isBoarding && !termsRead.highRiskBoarding) return false;
                }
                
                return true;
            }, [isBoarding, isHighRisk, hasAnyGrooming, termsRead]);
        
            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                if (errors[field]) setErrors(prev => ({ ...prev, [field]: null }));
            };

            const toggleArray = (field, value) => {
                setFormData(prev => {
                    const arr = prev[field] || [];
                    const newArr = arr.includes(value) ? arr.filter(i => i !== value) : [...arr, value];
                    return { ...prev, [field]: newArr };
                });
            };

            // ç°½åæ¿åˆå§‹åŒ– (ä¿®å¾© Canvas å¤§å°å•é¡Œ)
            useEffect(() => {
                if (showFullSig && sigCanvasRef.current) {
                    // ä½¿ç”¨ setTimeout ç¢ºä¿ DOM æ¸²æŸ“å®Œæˆ
                    setTimeout(() => {
                        const canvas = sigCanvasRef.current;
                        if(canvas) {
                             const ratio = Math.max(window.devicePixelRatio || 1, 1);
                             canvas.width = canvas.offsetWidth * ratio;
                             canvas.height = canvas.offsetHeight * ratio;
                             const ctx = canvas.getContext("2d");
                             ctx.scale(ratio, ratio);
                             // ç¢ºä¿ç­†è·¡æ¸…æ¥š
                             padInstance.current = new window.SignaturePad(canvas, { 
                                 minWidth: 2, 
                                 maxWidth: 4, 
                                 penColor: "#3F3F3F",
                                 backgroundColor: 'rgba(0,0,0,0)'
                             });
                        }
                    }, 100);
                }
            }, [showFullSig]);

const handleSubmit = async () => {
    // 1. æ‰‹å‹•å»ºç«‹ã€Œæœ€æ–°å¯µç‰©æ¸…å–®ã€é€²è¡Œé©—è­‰ï¼Œç¢ºä¿æ‹¿åˆ°ç•¶å‰ç•«é¢è¼¸å…¥çš„å€¼
    const currentPetData = {};
    PET_SPECIFIC_FIELDS.forEach(field => { currentPetData[field] = formData[field]; });
    const petListToValidate = petList.map((p, i) => i === currentPetIdx ? { ...p, ...currentPetData } : p);

    const newErrors = {};
    const dataToValidate = { ...formData, estimated_price: calculatedTotalPrice };

    // --- A. å¿…å¡«é©—è­‰é–‹å§‹ ---
const sharedRequired = ['owner_name', 'phone', 'image_auth'];
    if (isBoarding) {
        sharedRequired.push('owner_id', 'address', 'emergency_name', 'emergency_phone');
        if (!formData.checkInDate) newErrors.checkInDate = 'è«‹é¸æ“‡æ—¥æœŸ';
        if (!formData.isDaycare && !formData.checkOutDate) newErrors.checkOutDate = 'è«‹é¸æ“‡æ—¥æœŸ';
    } else {
        sharedRequired.push('bookingDate', 'bookingTime');
    }
    sharedRequired.forEach(f => { if(!dataToValidate[f]) newErrors[f] = 'æ­¤æ¬„ä½ç‚ºå¿…å¡«'; });
    if (!calculatedTotalPrice || calculatedTotalPrice <= 0) newErrors.estimated_price = 'é‡‘é¡ä¸å¯ç‚º 0';

    petListToValidate.forEach((pet, index) => {
        const suffix = `_${index}`;
        const petLabel = `ç¬¬ ${index + 1} éš»(${pet.pet_name || 'æœªå‘½å'})ï¼š`;
        const petBasic = ['pet_name', 'breed', 'weight', 'sex', 'fix', 'grooming_temperament', 'medical_status', 'social_aggression'];
        if (pet.pet_type === 'dog') petBasic.push('social_play');
        petBasic.forEach(f => { if(!pet[f]) newErrors[`${f}${suffix}`] = `${petLabel}å¿…å¡«`; });
        if (pet.is_under_one ? !pet.age_months : !pet.age) newErrors[`${pet.is_under_one ? 'age_months' : 'age'}${suffix}`] = `${petLabel}è«‹å¡«å¯«å¹´é½¡`;
if (isBoarding) {
    ['chip_status', 'personality', 'pica', 'feeding_plan'].forEach(f => { 
        if(!pet[f]) newErrors[`${f}${suffix}`] = `${petLabel}å¿…å¡«`; 
    });

    if(!pet.diet_type || pet.diet_type.length === 0) {
        newErrors[`diet_type${suffix}`] = `${petLabel}è«‹å‹¾é¸é£²é£Ÿ`;
    }

    // âœ… æ–°å¢ï¼šç–«è‹—è­‰æ˜ (é¸æœ‰å¿…é ˆä¸Šå‚³)
    if (pet.vaccine === 'æœ‰' && !pet.vaccine_url) {
        newErrors[`vaccine_url${suffix}`] = `${petLabel}ç–«è‹—è­‰æ˜å¿…é ˆä¸Šå‚³`;
    }

    // âœ… æ–°å¢ï¼šé©…èŸ²ç‰Œå­ (é¸æœ‰å¿…å¡«)
    if (pet.deworm === 'æœ‰' && !pet.deworm_brand) {
        newErrors[`deworm_brand${suffix}`] = `${petLabel}è«‹å¡«å¯«é©…èŸ²ç‰Œå­`;
    }

    // âœ… æ–°å¢ï¼šæ´—æ¾¡è­‰æ˜ (ç‹—ç‹—ä¸”æœªåŠ è³¼ç¾å®¹)
    if (pet.pet_type === 'dog' && pet.addGrooming === false) {
        if (!pet.proof_type) {
            newErrors[`proof_type${suffix}`] = `${petLabel}è«‹é¸æ“‡æ´—æ¾¡è­‰æ˜æ–¹å¼`;
        } else if (pet.proof_type === 'upload' && !pet.proof_url) {
            newErrors[`proof_url${suffix}`] = `${petLabel}éœ€ä¸Šå‚³æ´—æ¾¡è­‰æ˜`;
        }
    }

} else {
    if (!pet.service_items || pet.service_items.length === 0) {
        newErrors[`service_items${suffix}`] = `${petLabel}è«‹é¸æ“‡æœå‹™å…§å®¹`;
    }
}
    });

    let targetPetIdx = currentPetIdx;
    const firstErrorKey = Object.keys(newErrors)[0];
    if (firstErrorKey && firstErrorKey.includes('_')) targetPetIdx = parseInt(firstErrorKey.split('_').pop());
    Object.keys(newErrors).forEach(key => { if (key.endsWith(`_${targetPetIdx}`)) newErrors[key.replace(`_${targetPetIdx}`, '')] = newErrors[key]; });

    setErrors(newErrors);
    if (Object.keys(newErrors).length > 0) {
        if (targetPetIdx !== currentPetIdx) handleSwitchPet(targetPetIdx);
        alert(firstErrorKey === 'image_auth' ? 'âš ï¸ã€Œå½±åƒä½¿ç”¨æˆæ¬Šã€å°šæœªå‹¾é¸å–”ï¼' : `âš ï¸ é‚„æœ‰æ¬„ä½æœªå¡«é½Šï¼Œå·²æ¨™è¨˜ç‚ºç´…è‰²ã€‚`);
        setTimeout(() => { document.getElementById(firstErrorKey.split('_')[0])?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 300);
        return; 
    }
    // --- B. é©—è­‰çµæŸï¼Œé–‹å§‹å‚³é€è³‡æ–™ ---

    setIsSubmitting(true);
    try {
        // 1. ä¸Šå‚³æ•¸ä½ç°½ååœ–æª”
        const sigFile = dataURLtoFile(realtimeSig, `sig_${Date.now()}.png`);
        const { data: sigData, error: sigError } = await supabase.storage
            .from('signatures')
            .upload(`${Date.now()}_${Math.random().toString(36).substring(7)}.png`, sigFile);
        if (sigError) throw sigError;
        const { data: { publicUrl: signature_url } } = supabase.storage.from('signatures').getPublicUrl(sigData.path);

        // 2. æº–å‚™å‚³é€çµ¦è³‡æ–™åº«çš„æœ€çµ‚ç‰©ä»¶
        const finalSubmitData = {
            p_owner_data: { 
                owner_name: formData.owner_name, 
                phone: formData.phone, 
                email: formData.email 
            },
            p_pet_data: petListToValidate, // å‚³é€åŒ…å«æ‰€æœ‰æ¯›å­©çš„æ¸…å–®
            p_contract_data: { 
                ...formData, 
                estimated_price: calculatedTotalPrice, 
                signature_url,
                petList: petListToValidate // å‚™ä»½å®Œæ•´çš„ JSON çµ¦å¾Œå°ä½¿ç”¨
            },
            p_is_boarding: isBoarding
        };

// 3. å‘¼å« Supabase RPC
        const { data, error: rpcError } = await supabase.rpc('submit_form_data', finalSubmitData);
        if (rpcError) throw rpcError;

        // ğŸŒŸ ä¸²æ¥ Resendï¼šå‚³é€å®Œæ•´è³‡æ–™çµ¦å¾Œç«¯
        let contractHtmlFromServer = "";
        try {
            const edgeResp = await fetch(`${supabaseUrl}/functions/v1/send-resend-email`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${supabaseKey}`
                },
                body: JSON.stringify({
                    ...formData,          // å‚³é€ owner_id, emergency ç­‰æ‰€æœ‰è³‡è¨Š
                    petList: petListToValidate, 
                    total_price: calculatedTotalPrice, 
                    isBoarding: isBoarding, 
                    signature_url: signature_url 
                })
            });
            const edgeResult = await edgeResp.json();
            contractHtmlFromServer = edgeResult.contractHtml; 
        } catch (e) {
            console.error("èª¿ç”¨å¤±æ•—:", e);
        }

        alert("ğŸ‰ å¥‘ç´„æäº¤æˆåŠŸï¼");
        await new Promise(resolve => setTimeout(resolve, 1500));

        const hasEmail = formData.email && formData.email.trim() !== '';
        setView('success'); 
        setSuccessData({ 
            hasEmail, 
            email: formData.email,
            contractHtml: contractHtmlFromServer, // å°‡å¾Œç«¯å‚³å›çš„ HTML å­˜å…¥ç‹€æ…‹
            contractData: {
                ...formData,
                estimated_price: calculatedTotalPrice,
                signature_url,
                petList: petListToValidate
            }
        });
        
        // å»¶å¾Œ 0.5 ç§’å†æ¸…ç©ºè³‡æ–™ï¼Œç¢ºä¿ç•«é¢åˆ‡æ›å›é¦–é å¾Œæ‰åœ¨èƒŒæ™¯é‡ç½®ï¼Œè¦–è¦ºä¸Šæœ€é †æš¢
        setTimeout(() => {
            setPetList([{ id: 0, name: 'å¯µç‰© 1' }]);
            setCurrentPetIdx(0);
            setRealtimeSig(null);
            setFormData({
                email: '', owner_name: '', phone: '', owner_id: '', address: '',
                emergency_name: '', emergency_phone: '',
                pet_name: '', breed: '', weight: '', 
                age: '', age_months: '', is_under_one: false,
                sex: '', fix: '', 
                social_aggression: '', social_play: '', 
                grooming_temperament: '',
                chip_status: '', chip_id: '', preferred_clinic: '',
                medical_status: '', medical_history: [], medical_history_other: '',
                service_type: '', service_type_other: '', legal_agree: false,
                service_items: [], 
                service_items_other: '', 
                estimated_price: '',
                hasTrialStay: false,
                pet_type: 'dog', 
                isDaycare: false,
                bookingTimeEnd: '',
                usePromo50: false,
                image_auth: '',
            });
            setLineConfirmed(false);
            setLoyaltyInfo(null);
        }, 500);

    } catch (err) {
        console.error("æäº¤å¤±æ•—è©³æƒ…:", err);
        alert(`âŒ æäº¤å¤±æ•—ï¼š${err.message || 'è«‹æª¢æŸ¥ç¶²è·¯å¾Œå†è©¦ä¸€æ¬¡'}`);
    } finally {
        setIsSubmitting(false); // ğŸŒŸ é—œéµï¼šç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½è¦åœæ­¢è½‰åœˆ
    }
};

            // ğŸŒŸ å„ªåŒ–ï¼šæå–ç¸½é‡‘é¡è¨ˆç®—é‚è¼¯ (é¿å…é¡¯ç¤ºèˆ‡å¯¦éš›æäº¤é‡‘é¡ä¸ä¸€è‡´)
const calculatedTotalPrice = useMemo(() => {
                // 1. ç´”ç¾å®¹æ¨¡å¼ æˆ– å®‰è¦ªæ¨¡å¼ï¼šç›´æ¥ç”±è¼¸å…¥æ¡†æ±ºå®šï¼Œä¸¦æ‰£é™¤å„ªæƒ 
                if (!isBoarding || formData.isDaycare) {
                    const basePrice = parseInt(formData.estimated_price || 0);
                    const discount = formData.usePromo50 ? 200 : 0;
                    return Math.max(0, basePrice - discount);
                }

                // 2. ä½å®¿æ¨¡å¼é‚è¼¯ï¼š
                const roomTotal = parseInt(formData.price_per_night || 0) * (stayDuration || 0);
                const discountRate = stayDuration >= 15 ? 0.85 : stayDuration >= 6 ? 0.95 : 1;
                const surcharge = parseInt(formData.holiday_surcharge || 0);
                
                const totalGrooming = allPetsCurrentState.reduce((sum, p) => {
                    const price = p.addGrooming ? parseInt(p.boarding_grooming_price || 0) : 0;
                    const discount = (p.addGrooming && p.usePromo50) ? 200 : 0;
                    return sum + price - discount;
                }, 0);

                return Math.round(roomTotal * discountRate) + surcharge + totalGrooming;
            }, [formData.price_per_night, stayDuration, formData.holiday_surcharge, allPetsCurrentState, isBoarding, formData.isDaycare, formData.estimated_price, formData.usePromo50]);

            // --- 1. é¦–é  View ---
            if (view === 'entry') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
                        <div className="bg-blob w-96 h-96 bg-soosi-green/20 top-[-10%] left-[-10%]"></div>
                        <div className="bg-blob w-80 h-80 bg-soosi-wood/10 bottom-[-10%] right-[-10%]"></div>

                        <div className="w-full max-w-lg mx-auto relative z-10 flex flex-col items-center">
<div className="mb-10 relative group cursor-default">
    <div className="absolute inset-0 bg-white/40 rounded-full blur-2xl transform scale-110"></div>
<img 
        src="logo.png" 
        alt="å®¿æ´— Soosi Pet" 
        className="w-56 md:w-64 h-auto relative z-10 drop-shadow-sm transform group-hover:scale-105 active:scale-90 transition-all duration-200 cursor-pointer touch-manipulation"
        onClick={handleLogoClick}
    />
    <div className="absolute -right-4 -top-2 bg-soosi-accent text-soosi-dark text-xs font-black px-3 py-1 rounded-full rotate-12 shadow-sm">ç‰¹å¯µæ¥­å­—ç¬¬ S1140030è™Ÿ</div>
</div>                            <div className="text-center mb-10 space-y-2">
                                <h1 className="text-2xl font-black text-soosi-dark tracking-wide">å®¿æ´—å¯µç‰© <span className="text-soosi-green">Soosi Pet</span></h1>
                                <p className="text-soosi-wood font-medium text-sm tracking-widest">ç¾å®¹ | æ—…é¤¨ | å®‰è¦ª | é¸å“</p>
                            </div>
                            
                            <div className="grid grid-cols-1 w-full gap-5">
                                <button onClick={goGrooming} 
                                    className="glass-card p-6 flex items-center gap-5 group hover:bg-white/90 active:scale-[0.98] border-l-8 border-soosi-green transition-all relative overflow-hidden">
                                    <div className="w-16 h-16 rounded-2xl bg-soosi-green/10 flex items-center justify-center text-soosi-green group-hover:bg-soosi-green group-hover:text-white transition-colors shadow-sm z-10">
                                        <Icon name="scissors" size={32} />
                                    </div>
                                    <div className="text-left flex-1 z-10">
                                        <h3 className="text-xl font-black text-soosi-dark mb-1">æ´—æ¾¡ç¾å®¹</h3>
                                        <p className="text-xs text-gray-500 font-medium">Grooming Service</p>
                                    </div>
                                    <div className="text-soosi-green z-10"><Icon name="arrow-right" /></div>
                                </button>

                                <button onClick={goBoarding} 
                                    className="glass-card p-6 flex items-center gap-5 group hover:bg-white/90 active:scale-[0.98] border-l-8 border-soosi-wood transition-all relative overflow-hidden">
                                    <div className="w-16 h-16 rounded-2xl bg-soosi-wood/10 flex items-center justify-center text-soosi-wood group-hover:bg-soosi-wood group-hover:text-white transition-colors shadow-sm z-10">
                                        <Icon name="home" size={32} />
                                    </div>
                                    <div className="text-left flex-1 z-10">
                                        <h3 className="text-xl font-black text-soosi-dark mb-1">å®‰è¦ªä½å®¿</h3>
                                        <p className="text-xs text-gray-500 font-medium">Pet Boarding</p>
                                    </div>
                                    <div className="text-soosi-wood z-10"><Icon name="arrow-right" /></div>
                                </button>
                            </div>

                            <footer className="mt-12 text-center space-y-5">
                                <div className="flex items-center justify-center gap-8 text-soosi-wood/70">
                                    <a href="https://www.instagram.com/soosi.studio/" target="_blank" className="hover:text-soosi-green hover:scale-110 transition-all flex flex-col items-center gap-1">
                                        <Icon name="instagram" size={24}/>
                                        <span className="text-[10px] font-bold">Instagram</span>
                                    </a>
                                    <a href="https://www.facebook.com/soosistudio/?rdid=4JTN13dweC8vLijB" target="_blank" className="hover:text-soosi-green hover:scale-110 transition-all flex flex-col items-center gap-1">
                                        <Icon name="facebook" size={24}/>
                                        <span className="text-[10px] font-bold">Facebook</span>
                                    </a>
                                    <a href="http://lin.ee/nfGjHryU" target="_blank" className="hover:text-soosi-green hover:scale-110 transition-all flex flex-col items-center gap-1">
                                        <img src="line.png" className="w-6 h-6 grayscale opacity-70 hover:grayscale-0 hover:opacity-100 transition-all line-img-fix"/>
                                        <span className="text-[10px] font-bold">LINE</span>
                                    </a>
                                </div>
                                <div>
                                    <a href="https://maps.app.goo.gl/Y2sQnyWPW5Dysezg6" target="_blank" 
                                       className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/50 border border-white/60 hover:bg-white/80 transition-all text-soosi-wood text-xs font-bold shadow-sm backdrop-blur-sm">
                                        <Icon name="map-pin" size={14} className="text-soosi-red" />
                                        å°ä¸­å¸‚æ¸…æ°´å€æ–°èˆˆè·¯142-1è™Ÿ
                                    </a>
                                </div>
                                <p className="text-[10px] text-gray-400 font-medium tracking-wider">
                                    Â© 2026 Soosi Pet. All Rights Reserved.
                                </p>
                            </footer>
                        </div>
                    </div>
                );
            }
            // --- æ–°å¢ï¼šæˆåŠŸé é¢ View ---
if (view === 'success') {
    return (
        <div className="min-h-screen bg-[#F9F7F2] flex flex-col items-center justify-center p-6 relative overflow-hidden animate-in fade-in duration-500">
            {/* èƒŒæ™¯è£é£¾ */}
            <div className="bg-blob w-96 h-96 bg-soosi-green/10 top-[-10%] left-[-10%]"></div>
            <div className="bg-blob w-80 h-80 bg-soosi-wood/10 bottom-[-10%] right-[-10%]"></div>

            <div className="w-full max-w-md mx-auto relative z-10 bg-white rounded-[2.5rem] shadow-2xl p-8 text-center space-y-6 border-2 border-soosi-green/10">
                {/* æˆåŠŸåœ–ç¤º */}
                <div className="w-24 h-24 bg-soosi-green/10 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                    <Icon name="check-circle" size={48} className="text-soosi-green" />
                </div>

                <h2 className="text-2xl font-black text-soosi-dark tracking-tight">
                    é ç´„æˆåŠŸï¼
                </h2>
                <p className="text-sm text-gray-500 leading-relaxed">
                    æ„Ÿè¬æ‚¨çš„å¡«å¯«ï¼Œæˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„é ç´„è³‡æ–™ã€‚
                </p>

                {/* æ ¹æ“šæ˜¯å¦æœ‰ Email é¡¯ç¤ºä¸åŒè¨Šæ¯ */}
                <div className={`p-4 rounded-xl border-2 ${successData.hasEmail ? 'bg-soosi-green/5 border-soosi-green/20' : 'bg-yellow-50 border-yellow-200'}`}>
                    <div className="flex items-start gap-3">
                        <Icon name={successData.hasEmail ? "mail" : "alert-circle"} size={20} className={successData.hasEmail ? "text-soosi-green mt-0.5" : "text-yellow-600 mt-0.5"} />
                        <div className="text-left">
                            <h3 className="font-bold text-soosi-dark text-sm mb-1">
                                {successData.hasEmail ? "å¥‘ç´„å‰¯æœ¬å·²ç™¼é€" : "æé†’ï¼šæœªå¡«å¯«é›»å­éƒµä»¶"}
                            </h3>
                            <p className="text-xs text-gray-600">
                                {successData.hasEmail 
                                    ? `è©³ç´°è³‡è¨Šå·²ç™¼é€è‡³ ${successData.email}ï¼Œè«‹æŸ¥æ”¶ä¿¡ç®±ã€‚` 
                                    : "å› æœªå¡«å¯« Emailï¼Œæˆ‘å€‘ç„¡æ³•ä¸»å‹•ç™¼é€å¥‘ç´„å‰¯æœ¬ã€‚å»ºè­°æ‚¨é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¿å­˜å®Œæ•´å¥‘ç´„ã€‚"}
                            </p>
                        </div>
                    </div>
                </div>

                {/* æŒ‰éˆ•å€åŸŸ */}
                <div className="space-y-3 pt-4">
<button 
                        onClick={() => {
                            const contractWindow = window.open('', '_blank');
                            if (contractWindow) {
                                // ğŸŒŸ é—œéµä¿®æ”¹ï¼šç›´æ¥èª¿ç”¨å¾å¾Œç«¯æ‹¿åˆ°çš„ contractHtml
                                if (successData.contractHtml) {
                                    contractWindow.document.write(successData.contractHtml);
                                } else {
                                    contractWindow.document.write('<h3>æ­£åœ¨ç”Ÿæˆå¥‘ç´„å‰¯æœ¬ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æª¢æŸ¥ä¿¡ç®±ã€‚</h3>');
                                }
                                contractWindow.document.close();
                            } else {
                                alert('ç„¡æ³•é–‹å•Ÿæ–°è¦–çª—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨çš„å½ˆå‡ºè¦–çª—è¨­å®š');
                            }
                        }}
                        className="w-full py-4 bg-soosi-green text-white rounded-2xl font-bold shadow-lg shadow-soosi-green/20 active:scale-95 transition-all flex items-center justify-center gap-2"
                    >
                        <Icon name="file-text" size={20} />
                        æŸ¥çœ‹å®Œæ•´å¥‘ç´„å‰¯æœ¬
                    </button>
                    
                    <button 
                        onClick={goHome}
                        className="w-full py-4 bg-white border-2 border-soosi-wood text-soosi-wood rounded-2xl font-bold active:scale-95 transition-all flex items-center justify-center gap-2"
                    >
                        <Icon name="home" size={20} />
                        è¿”å›é¦–é 
                    </button>
                </div>
            </div>
        </div>
    );
}

// --- æ–°å¢ï¼šåƒ¹ç›®è¡¨ View (æ”¾åœ¨ entry ä¹‹å¾Œï¼Œè¡¨å–®ä¹‹å‰) ---
            if (view === 'prices') {
                return <PriceListPage onBack={() => setView('form')} />;
            }

            // --- 2. è¡¨å–® View ---
            return (
                <div className="min-h-screen pb-32">
                    <ToastUI />
                    <UpdatePrompt show={showUpdate} onUpdate={() => window.location.reload()} />
                    {/* Nav: Logo æ”¾å¤§ */}
                    <nav className="fixed top-0 w-full z-40 bg-white/90 backdrop-blur-xl border-b border-soosi-green/10 shadow-sm transition-all">
                        <div className="px-6 py-3 flex justify-between items-center max-w-3xl mx-auto">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={goHome}>
                                <img src="nav.png" alt="Logo" className="w-12 h-12 object-contain" />
                                <div className="font-black text-lg text-soosi-dark tracking-wide">å®¿æ´— Soosi</div>
                            </div>
<div className="flex items-center gap-2">
                                {/* ç¾å®¹æ¨¡å¼ï¼šé¡¯ç¤ºæ–‡å­—ç‰ˆåƒ¹ç›®è¡¨ */}

{!isBoarding && (
    <button onClick={() => setView('prices')} className="text-xs font-bold text-white bg-soosi-wood px-3 py-1.5 rounded-full shadow-sm hover:bg-soosi-wood/90 transition-all flex items-center gap-1">
        <Icon name="dollar-sign" size={14}/> åƒ¹ç›®è¡¨
    </button>
)}

                                {/* ä½å®¿æ¨¡å¼ï¼šé¡¯ç¤ºåœ–ç‰‡ç‰ˆåƒ¹ç›®è¡¨ */}
                                {isBoarding && (
                                    <button onClick={() => setActiveModal('boardingPrice')} className="text-xs font-bold text-white bg-soosi-green px-3 py-1.5 rounded-full shadow-sm hover:bg-soosi-green/90 transition-all flex items-center gap-1">
                                        <Icon name="image" size={14}/> åƒ¹ç›®è¡¨
                                    </button>
                                )}

                                <button onClick={goHome} className="text-xs font-bold text-soosi-wood hover:bg-soosi-wood/10 px-3 py-1.5 rounded-full transition-colors flex items-center gap-1">
                                    <Icon name="arrow-left" size={14}/> è¿”å›é¦–é 
                                </button>
                            </div>
                        </div>
                    </nav>

                    <main className="pt-28 px-4 max-w-3xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <div className="text-center space-y-2 pb-2">
                            <div className={`inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider ${isBoarding ? 'bg-soosi-wood/10 text-soosi-wood' : 'bg-soosi-green/10 text-soosi-green'}`}>
                                {isBoarding ? "Hotel Service" : "Grooming Service"}
                            </div>
                            <h2 className="text-3xl font-black text-soosi-dark tracking-tight">
                                {isBoarding ? "ä½å®¿æœå‹™è³‡æ–™å¡«å¯«" : "ç¾å®¹æœå‹™è³‡æ–™å¡«å¯«"}
                            </h2>
                        </div>

                        {/* LINE Section (é‡è¨­è¨ˆ) */}
                        <div className="cute-card p-6 space-y-4" id="line">
                            <div className="text-center space-y-1">
                                <div className="inline-block bg-[#06C755] text-white px-3 py-0.5 rounded-full text-[10px] font-black shadow-sm mb-1">STEP 1</div>
                                <h3 className="text-lg font-black text-soosi-wood flex items-center justify-center gap-2">
                                    åŠ å…¥å®˜æ–¹ LINE
                                </h3>
                                <p className="text-xs text-gray-400 font-bold">ID: @610ijdjr</p>
                            </div>
                            
                            <div className="bg-white border-2 border-dashed border-gray-200 rounded-2xl p-4 flex flex-col md:flex-row items-center gap-4">
<div className="flex-1 w-full">
                                    <a href="http://lin.ee/nfGjHryU" target="_blank" className="w-full bg-[#06C755]/5 border border-[#06C755]/20 hover:bg-[#06C755]/10 text-[#06C755] rounded-xl p-3 flex items-center justify-center gap-2 transition-all active:scale-95">
                                        <img src="line.png" className="w-6 h-6 line-img-fix" /> 
                                        <span className="font-bold">1. é»æ“ŠåŠ å…¥å¥½å‹</span>
                                    </a>
                                
                                </div>
                                <div className="hidden md:block text-gray-300 font-black"><Icon name="arrow-right" size={24}/></div>
                                <div className="flex-1 w-full bg-red-50 text-soosi-red border border-red-100 rounded-xl p-3 flex items-center justify-center gap-2">
                                    <Icon name="message-circle" size={18}/>
                                    <span className="font-bold">2. å‹™å¿…å‚³é€è²¼åœ–</span>
                                </div>
                            </div>
                            
                            <label className={`w-full flex items-center justify-center gap-3 p-4 rounded-xl border-2 transition-all cursor-pointer select-none ${lineConfirmed ? 'bg-[#06C755]/10 border-[#06C755] text-[#06C755]' : 'bg-white border-gray-200 text-gray-400 hover:border-[#06C755]/50'}`}>
                                <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${lineConfirmed ? 'bg-[#06C755] border-[#06C755]' : 'border-gray-300'}`}>
                                    {lineConfirmed && <Icon name="check" size={12} className="text-white"/>}
                                </div>
                                <input type="checkbox" className="hidden" checked={lineConfirmed} onChange={()=>setLineConfirmed(!lineConfirmed)}/>
                                <span className="font-bold text-sm">æˆ‘å·²å®ŒæˆåŠ å…¥å¥½å‹ä¸¦å‚³é€è²¼åœ–</span>
                            </label>
                            {errors.line && <div className="field-error justify-center"><Icon name="alert-circle" size={12}/>{errors.line}</div>}
                        </div>

                        {/* Owner Info */}
                        <section className="cute-card p-8 space-y-6">
                            <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <span className="text-2xl">ğŸ‘¤</span>
                                <h3 className="text-lg font-black text-soosi-dark">é£¼ä¸»åŸºæœ¬è³‡æ–™</h3>
                            </div>
                            <div className="grid md:grid-cols-2 gap-5">
<InputGroup label="é›»å­éƒµä»¶ (é¸å¡«)" error={errors.email} id="email">
                                    <input type="email" value={formData.email} onChange={e=>handleChange('email', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.email ? 'input-error' : ''}`} placeholder="å¯„é€å¥‘ç´„å‰¯æœ¬ç”¨" />
                                </InputGroup>
                                <InputGroup label="ä¸»äººå§“å" required error={errors.owner_name} id="owner_name">
                                    <input type="text" value={formData.owner_name} onChange={e=>handleChange('owner_name', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.owner_name ? 'input-error' : ''}`} placeholder="è«‹è¼¸å…¥å…¨å" />
                                </InputGroup>
                                <InputGroup label="é€£çµ¡é›»è©±" required error={errors.phone} id="phone">
<div className="flex gap-2">
<input 
    type="tel" 
    inputMode="numeric" // ğŸŒŸ å¼·åˆ¶æ‰‹æ©Ÿè·³å‡ºæ•¸å­—éµç›¤
    pattern="[0-9]*"    // ğŸŒŸ è¼”åŠ©é©—è­‰
    value={formData.phone} 
    onChange={e => {
        // ğŸŒŸ é¡å¤–å„ªåŒ–ï¼šåªå…è¨±è¼¸å…¥æ•¸å­—ï¼Œé˜²æ­¢å®¢äººèª¤æ‰“æ–‡å­—
        const val = e.target.value.replace(/\D/g, ''); 
        handleChange('phone', val);
    }}
    className={`w-full cute-input px-4 py-3 flex-1 ${errors.phone ? 'input-error' : ''}`} 
    placeholder="0912345678" 
/>
    <button 
        type="button"
        onClick={handleSearchHistory}
        disabled={isSearching}
        className="px-4 bg-soosi-wood text-white rounded-xl font-bold text-sm shadow-md hover:bg-[#7a5e47] flex items-center gap-1 whitespace-nowrap disabled:opacity-50"
    >
        {isSearching ? <Icon name="loader-2" className="animate-spin" size={14}/> : <Icon name="search" size={14}/>}
        èˆŠå®¢
    </button>
</div>
                                </InputGroup>
<InputGroup label="èº«åˆ†è­‰å­—è™Ÿ" required error={errors.owner_id} id="owner_id">
                                    <input type="text" value={formData.owner_id} onChange={e=>handleChange('owner_id', e.target.value)} className="w-full cute-input px-4 py-3" placeholder="ä¾‹å¦‚: A123456789" />
                                </InputGroup>
                                <div className="md:col-span-2">
                                    <InputGroup label="é€šè¨Šåœ°å€" required error={errors.address} id="address">
                                        <input type="text" value={formData.address} onChange={e=>handleChange('address', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.address ? 'input-error' : ''}`} placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€" />
                                    </InputGroup>
                                </div>
                                <div className="md:col-span-2 dashed-divider"></div>
                                <InputGroup label="ç·Šæ€¥è¯çµ¡äººå§“å" required error={errors.emergency_name} id="emergency_name">
                                    <input type="text" value={formData.emergency_name} onChange={e=>handleChange('emergency_name', e.target.value)} className={`w-full cute-input px-4 py-3 border-red-100 bg-red-50/20 ${errors.emergency_name ? 'input-error' : ''}`} />
                                </InputGroup>
                                <InputGroup label="ç·Šæ€¥é€£çµ¡é›»è©±" required error={errors.emergency_phone} id="emergency_phone">
                                    <input type="tel" value={formData.emergency_phone} onChange={e=>handleChange('emergency_phone', e.target.value)} className={`w-full cute-input px-4 py-3 border-red-100 bg-red-50/20 ${errors.emergency_phone ? 'input-error' : ''}`} />
                                </InputGroup>
</div>
                        </section>


                        {/* æ–°å¢ï¼šå¯µç‰©è©³ç´°è³‡æ–™ (ç§»åˆ°é ç´„æ™‚é–“ä¸Šæ–¹) */}
<section className="cute-card p-8 space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100">
{/* --- æ–°å¢ï¼šå¯µç‰©åˆ‡æ› Tab (åƒ…ä½å®¿æ¨¡å¼é¡¯ç¤º) --- */}
    {isBoarding && (
    <div className="flex items-center gap-2 mb-2 overflow-x-auto hide-scrollbar pb-2">
        {petList.map((pet, idx) => (
            <div key={idx} onClick={() => handleSwitchPet(idx)}
                className={`relative group flex-shrink-0 flex items-center gap-2 px-4 py-2.5 rounded-xl border-2 cursor-pointer transition-all select-none ${
                    currentPetIdx === idx ? 'bg-soosi-wood text-white border-soosi-wood shadow-lg scale-105' : 'bg-white text-gray-400 border-gray-100 hover:border-soosi-wood/30'
                }`}>
                <div className={`w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-black ${currentPetIdx === idx ? 'bg-white text-soosi-wood' : 'bg-gray-100'}`}>{idx + 1}</div>
                <span className="text-sm font-bold whitespace-nowrap max-w-[80px] truncate">{(currentPetIdx === idx ? formData.pet_name : pet.pet_name) || pet.name}</span>
                {petList.length > 1 && (
                    <button onClick={(e) => handleDeletePet(e, idx)} className={`ml-1 p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors ${currentPetIdx === idx ? 'text-white/70' : 'text-gray-300'}`}>
                        <Icon name="x" size={12} />
                    </button>
                )}
            </div>
        ))}
        <button onClick={handleAddPet} className="flex-shrink-0 flex items-center gap-1 px-4 py-2.5 rounded-xl border-2 border-dashed border-soosi-green/30 text-soosi-green font-bold text-xs hover:bg-soosi-green/5 transition-all active:scale-95">
            <Icon name="plus" size={14} /><span>åŒä½æ¯›å­©</span>
        </button>
    </div>
    )}
    {/* ------------------------- */}
    <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <span className="text-2xl">ğŸ¾</span>
                                <h3 className="text-lg font-black text-soosi-dark">å¯µç‰©è©³ç´°è³‡æ–™</h3>
                            </div>
                            
                            {/* æ–°å¢ï¼šç‹—/è²“é¸æ“‡ */}
                            <div className="space-y-2">
                                <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1">
                                ç¨®é¡<span className="text-red-500">*</span>
                                </label>
                                <div className="flex gap-3">
                                    <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.pet_type === 'dog' ? 'bg-soosi-wood text-white border-soosi-wood shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
<input 
    type="radio" 
    name="pet_type" 
    value="dog" 
    checked={formData.pet_type === 'dog'} 
    onChange={(e) => {
        setFormData(prev => ({ ...prev, pet_type: 'dog', service_items: [], service_items_other: '' }));
    }} 
    className="hidden" 
/>
                                        <span className="font-bold">ğŸ¶ ç‹—ç‹—</span>
                                    </label>
                                    <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.pet_type === 'cat' ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
<input 
    type="radio" 
    name="pet_type" 
    value="cat" 
    checked={formData.pet_type === 'cat'} 
    onChange={(e) => {
        setFormData(prev => ({ ...prev, pet_type: 'cat', service_items: [], service_items_other: '' }));
    }} 
    className="hidden" 
/>
                                        <span className="font-bold">ğŸ± è²“å’ª</span>
                                    </label>
                                </div>
                            </div>

                            <div className="grid md:grid-cols-2 gap-5">
                                <InputGroup label="å¯µç‰©åå­—" required error={errors.pet_name} id="pet_name">
                                    <input type="text" value={formData.pet_name} onChange={e=>handleChange('pet_name', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.pet_name ? 'input-error' : ''}`} />
                                </InputGroup>
                                <InputGroup label="å“ç¨®" required error={errors.breed} id="breed">
                                    <input type="text" value={formData.breed} onChange={e=>handleChange('breed', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.breed ? 'input-error' : ''}`} />
                                </InputGroup>
                                <InputGroup label="é«”é‡ (kg)" required error={errors.weight} id="weight">
                                    <input type="number" step="0.1" value={formData.weight} onChange={e=>handleChange('weight', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.weight ? 'input-error' : ''}`} />
                                </InputGroup>
                                
                                {/* ä¿®æ”¹å¹´é½¡é‚è¼¯ï¼šåˆ‡æ›æ™‚æ¸…ç©ºå¦ä¸€é‚Šçš„æ•¸å€¼ */}
<div className="space-y-2">
    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1">å¹´é½¡<span className="text-red-500">*</span></label>
    <div className="flex gap-2">
        <PillBtn active={!formData.is_under_one} onClick={()=>setFormData(p=>({...p, is_under_one:false, age_months:''}))}>ä¸€æ­²ä»¥ä¸Š</PillBtn>
        <PillBtn active={formData.is_under_one} onClick={()=>setFormData(p=>({...p, is_under_one:true, age:''}))}>ä¸€æ­²ä»¥ä¸‹</PillBtn>
    </div>
    {formData.is_under_one ? (
        <select value={formData.age_months} onChange={e=>handleChange('age_months', e.target.value)} className="w-full cute-input px-4 py-3">
            <option value="">è«‹é¸æ“‡æœˆé½¡</option>
            {[1,2,3,4,5,6,7,8,9,10,11].map(m=><option key={m} value={m}>{m} å€‹æœˆ</option>)}
        </select>
    ) : (
        <div className="flex items-center gap-2">
<input 
                type="number" 
                inputMode="numeric" 
                min="1"
                placeholder="è«‹è¼¸å…¥æ•¸å­—" 
                value={formData.age} 
                onChange={e => {
                    const val = e.target.value;
                    if (val === '' || (parseInt(val) >= 1)) {
                        handleChange('age', val);
                    }
                }}
                className="flex-1 cute-input px-4 py-3 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" 
            />
            <span className="font-bold text-soosi-wood shrink-0">æ­²</span>
        </div>
    )}
</div>

                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1">æ€§åˆ¥<span className="text-red-500">*</span></label>
                                    <div className="flex gap-2">
                                        <PillBtn active={formData.sex === 'å…¬'} onClick={()=>handleChange('sex', 'å…¬')}>å…¬</PillBtn>
                                        <PillBtn active={formData.sex === 'æ¯'} onClick={()=>handleChange('sex', 'æ¯')}>æ¯</PillBtn>
                                    </div>
                                    {errors.sex && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.sex}</div>}
                                </div>

                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1">çµç´®<span className="text-red-500">*</span></label>
                                    <div className="flex gap-2">
                                        <PillBtn active={formData.fix === 'æ˜¯'} onClick={()=>handleChange('fix', 'æ˜¯')}>æ˜¯</PillBtn>
                                        <PillBtn active={formData.fix === 'å¦'} onClick={()=>handleChange('fix', 'å¦')}>å¦</PillBtn>
                                    </div>
                                    {errors.fix && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.fix}</div>}
                                </div>

                                {/* ç¤¾äº¤ç‹€æ³ï¼šæ”¹ç‚ºäºŒé¸ä¸€çš„å…©çµ„é¡Œç›® */}
                                <div className="md:col-span-2 space-y-4" id="social_aggression">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"> æ”»æ“Šæ€§<span className="text-red-500">*</span></label>
                                    <div className="flex gap-3">
                                        <PillBtn active={formData.social_aggression === 'æœ‰æ”»æ“Šæ€§'} onClick={()=>handleChange('social_aggression', 'æœ‰æ”»æ“Šæ€§')}>æœ‰æ”»æ“Šæ€§</PillBtn>
                                        <PillBtn active={formData.social_aggression === 'ç„¡æ”»æ“Šæ€§'} onClick={()=>handleChange('social_aggression', 'ç„¡æ”»æ“Šæ€§')}>ç„¡æ”»æ“Šæ€§</PillBtn>
                                    </div>
                                    {errors.social_aggression && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.social_aggression}</div>}
                                </div>

{formData.pet_type === 'dog' && (
                                    <div className="md:col-span-2 space-y-4" id="social_play">
                                        <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"> èˆ‡ç‹—ç›¸è™•<span className="text-red-500">*</span></label>
                                        <div className="flex gap-3">
                                            <PillBtn active={formData.social_play === 'å¯èˆ‡ç‹—ç©'} onClick={()=>handleChange('social_play', 'å¯èˆ‡ç‹—ç©')}>å¯èˆ‡ç‹—æœ‹å‹ç©</PillBtn>
                                            <PillBtn active={formData.social_play === 'ä¸å¯èˆ‡ç‹—ç©'} onClick={()=>handleChange('social_play', 'ä¸å¯èˆ‡ç‹—ç©')}>ä¸èƒ½èˆ‡ç‹—æœ‹å‹ç©</PillBtn>
                                        </div>
                                        {errors.social_play && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.social_play}</div>}
                                    </div>
                                )}

                                {/* ç¾å®¹æ€§æƒ…è©•ä¼° */}

                                <div className="md:col-span-2 space-y-2" id="grooming_temperament">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"> ç¾å®¹æ€§æƒ…èˆ‡æ”»æ“Šæ€§è©•ä¼°<span className="text-red-500">*</span></label>
                                    <div className="space-y-2">
                                        {[
                                            {v: 'å¤©ä½¿å¯¶å¯¶', l: 'ğŸ˜‡ å¤©ä½¿å¯¶å¯¶ï¼šå€‹æ€§æº«å’Œï¼Œç„¡ä»»ä½•æ”»æ“Šç´€éŒ„ï¼Œä¹Ÿä¸æ€•ç”Ÿã€‚'},
                                            {v: 'æœ‰é»ç·Šå¼µ', l: 'ğŸ˜“ æœ‰é»ç·Šå¼µï¼šè†½å°æ€•ç”Ÿï¼Œå¯èƒ½æœƒä½å¼æˆ–é–ƒèº²ï¼Œä½†æœªæ›¾å’¬äººã€‚'},
                                            {v: 'æ•æ„Ÿå¯¶å¯¶', l: <span className="text-red-500">ğŸ¤¬ æ•æ„Ÿå¯¶å¯¶ï¼šç‰¹å®šéƒ¨ä½æ•æ„Ÿæˆ–æ›¾æœ‰æ”»æ“Šç´€éŒ„ (è«‹å‹™å¿…å‘ŠçŸ¥)ã€‚</span>}
                                        ].map(item => (
                                            <button key={item.v} type="button" onClick={()=>handleChange('grooming_temperament', item.v)}
                                                className={`w-full pill-button px-4 py-3 rounded-xl text-left font-bold text-sm ${formData.grooming_temperament === item.v ? 'active' : 'inactive'}`}>
                                                {item.l}
                                            </button>
                                        ))}
                                    </div>
                                    {errors.grooming_temperament && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.grooming_temperament}</div>}
                                </div>

                                <div className="md:col-span-2 space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"> æ™¶ç‰‡ç‹€æ…‹<span className="text-red-500">*</span></label>
                                    <div className="flex gap-2 flex-wrap">
                                        {['æœ‰æ™¶ç‰‡','æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)','ç„¡æ™¶ç‰‡'].map(s => (
                                            <PillBtn key={s} active={formData.chip_status===s} onClick={()=>handleChange('chip_status', s)}>{s}</PillBtn>
                                        ))}
                                    </div>
                                    {formData.chip_status === 'æœ‰æ™¶ç‰‡' && (
                                        <input type="text" value={formData.chip_id} onChange={e=>handleChange('chip_id', e.target.value)} className="w-full cute-input px-4 py-3 mt-2" placeholder="è«‹è¼¸å…¥æ™¶ç‰‡è™Ÿç¢¼" />
                                    )}
                                    {errors.chip_status && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.chip_status}</div>}
                                </div>

                                <div className="md:col-span-2">
                                    <InputGroup label="æŒ‡å®šå°±é†«è¨ºç™‚æ©Ÿæ§‹ (è‹¥æœªå¡«å¯«ï¼Œå‰‡é€å¾€ç‰¹ç´„é†«é™¢)" id="preferred_clinic">
                                        <input type="text" value={formData.preferred_clinic} onChange={e=>handleChange('preferred_clinic', e.target.value)} className="w-full cute-input px-4 py-3" />
                                        <div className="mt-2 p-3 rounded-xl bg-soosi-green/5 border border-soosi-green/20 flex items-center gap-3">
                                            <div className="bg-soosi-green p-2 rounded-full text-white"><Icon name="hospital" size={16}/></div>
                                            <div>
<div className="text-xs font-bold text-gray-400">ç‰¹ç´„é†«é™¢</div>
                                            <div className="font-bold text-soosi-wood text-sm">æ³°çˆ¾å‹•ç‰©é†«é™¢<br/>433è‡ºä¸­å¸‚æ²™é¹¿å€å°ç£å¤§é“ä¸ƒæ®µ941è™Ÿ</div>
                                            </div>
                                        </div>
                                    </InputGroup>
                                </div>

{/* éå¾€ç—…å²å€å¡Šï¼šé è¨­ç´…åº•ä¸¦å°‡æé†’ç·Šè²¼æ¨™é¡Œ */}
                                <div className="md:col-span-2 p-5 rounded-2xl border bg-red-50 border-red-100 transition-all" id="medical_status">
                                    <div className="flex items-center gap-2 mb-4">
                                        <label className="text-sm font-bold text-soosi-wood ml-1">
                                            éå¾€ç—…å²<span className="text-red-500">*</span>
                                        </label>
                                        <div className="flex items-center gap-1 text-soosi-red text-[10px] font-black bg-white px-2 py-0.5 rounded-full shadow-sm animate-pulse border border-red-100 shrink-0">
                                            <Icon name="alert-circle" size={14}/> è«‹å‹™å¿…å¦‚å¯¦å‘ŠçŸ¥
                                        </div>
                                    </div>

                                    <div className="flex gap-3 mb-4">
                                        <PillBtn active={formData.medical_status === 'æœ‰'} onClick={() => handleChange('medical_status', 'æœ‰')} className={formData.medical_status === 'æœ‰' ? 'bg-soosi-red border-soosi-red' : 'bg-white'}>æœ‰</PillBtn>
                                        <PillBtn active={formData.medical_status === 'ç„¡'} onClick={() => handleChange('medical_status', 'ç„¡')} className={formData.medical_status === 'ç„¡' ? '' : 'bg-white'}>ç„¡</PillBtn>
                                    </div>
                                    
                                    {errors.medical_status && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.medical_status}</div>}

                                    {formData.medical_status === 'æœ‰' && (
                                        <div className="space-y-3 mt-4 pt-4 border-t border-red-200/50 animate-in fade-in">
                                            <div className="flex flex-wrap gap-2">
                                                {[
                                                    'å¿ƒè‡Ÿç—…', 'æ°£å–˜', 'æ°£ç®¡å¡Œé™·', 'ç™½å…§éšœ', 
                                                    'ç™²ç™‡', 'å¿ƒçµ²èŸ²', 'è‰¾åˆ©å¸Œé«”', 'è…¹è†œç‚', 
                                                    'è…¹ç©æ°´', 'æ‰‹è¡“å¤–å‚·æœªç™’åˆ', 'é«–é—œç¯€å•é¡Œ', 
                                                    'éª¨æŠ˜', 'è…¸ç‚', 'è¡€ä¾¿', 'è¡€å°¿', 
                                                    'æ‡·å­•', 'å‚³æŸ“æ€§ç–¾ç—…', '+ å…¶ä»–'
                                                ].map(v => (
                                                    <button key={v} type="button" onClick={() => toggleArray('medical_history', v)}
                                                        className={`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${formData.medical_history.includes(v) ? 'bg-soosi-wood text-white border-soosi-wood shadow-md' : 'bg-white text-gray-500 border-gray-200 hover:border-soosi-wood/50'}`}>
                                                        {v}
                                                    </button>
                                                ))}
                                            </div>
                                            {/* ç•¶é¸æ“‡ '+ å…¶ä»–' æ™‚é¡¯ç¤ºè¼¸å…¥æ¡† */}
                                            {formData.medical_history.includes('+ å…¶ä»–') && (
                                                <div className="mt-3 animate-in fade-in slide-in-from-top-2">
                                                    <textarea 
                                                        className="w-full cute-input px-4 py-3" 
                                                        placeholder="è«‹è©³ç´°èªªæ˜å…¶ä»–ç—…å²..." 
                                                        value={formData.medical_history_other} 
                                                        onChange={e => handleChange('medical_history_other', e.target.value)} 
                                                        rows="3"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    )}

                                </div>
                            </div>
                        </section>

{/* æ–°å¢ï¼šé ç´„æ™‚é–“å€å¡Š (ç§»åˆ°å¯µç‰©è³‡æ–™ä¸‹æ–¹) */}
                        <section className="cute-card p-8 space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100">
<div className="flex items-center justify-between border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">ğŸ“…</span>
                                    <h3 className="text-lg font-black text-soosi-dark">
                                        {isBoarding ? (formData.isDaycare ? "å®‰è¦ªæ™‚é–“é ç´„" : "ä½å®¿æ™‚é–“é ç´„") : "ç¾å®¹é ç´„è³‡è¨Š"}
                                    </h3>
                                </div>
                                {isBoarding && !isCustomerMode && (
                                    <div className="flex bg-gray-100 p-1 rounded-xl">
                                        <button onClick={() => handleChange('isDaycare', false)} className={`px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${!formData.isDaycare ? 'bg-white text-soosi-wood shadow-sm' : 'text-gray-400'}`}>ä½å®¿</button>
                                        <button onClick={() => handleChange('isDaycare', true)} className={`px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${formData.isDaycare ? 'bg-white text-soosi-wood shadow-sm' : 'text-gray-400'}`}>å®‰è¦ª</button>
                                    </div>
                                )}
                            </div>

                            {isBoarding ? (
                                /* ä½å®¿/å®‰è¦ªæ¨¡å¼é¡¯ç¤º */
                                <div className="space-y-4">
{formData.isDaycare ? (
                                        <div className="space-y-4">
                                            <InputGroup label="å®‰è¦ªæ—¥æœŸ" required error={errors.checkInDate} id="checkInDate">
                                                <input disabled={isCustomerMode} type="date" name="checkInDate" value={formData.checkInDate || ''} onChange={handleInputChange} className={`w-full cute-input px-4 py-3 ${errors.checkInDate ? 'input-error' : ''}`} />
                                            </InputGroup>
                                            <div className="grid grid-cols-2 gap-4">
                                                <InputGroup label="èµ·å§‹æ™‚é–“" id="bookingTime">
                                                    <select disabled={isCustomerMode} name="bookingTime" value={formData.bookingTime || ''} onChange={handleInputChange} className="w-full cute-input px-4 py-3 appearance-none">
                                                        <option value=""></option>
{timeSlots.filter(t => !unavailableSlots.includes(t)).map(time => (
                                                <option key={time} value={time}>{time}</option>
                                            ))}
                                                    </select>
                                                </InputGroup>
                                                <InputGroup label="é è¨ˆæ¥å›" id="bookingTimeEnd">
                                                    <select disabled={isCustomerMode} name="bookingTimeEnd" value={formData.bookingTimeEnd || ''} onChange={handleInputChange} className="w-full cute-input px-4 py-3 appearance-none">
                                                        <option value=""></option>
{timeSlots.filter(t => !unavailableSlots.includes(t)).map(time => (
                                                <option key={time} value={time}>{time}</option>
                                            ))}
                                                    </select>
                                                </InputGroup>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="grid md:grid-cols-2 gap-5">
                                            <InputGroup label="å…¥ä½æ—¥æœŸ" required error={errors.checkInDate} id="checkInDate">
                                                <input disabled={isCustomerMode} type="date" name="checkInDate" value={formData.checkInDate || ''} onChange={handleInputChange} className={`w-full cute-input px-4 py-3 ${errors.checkInDate ? 'input-error' : ''}`} />
                                            </InputGroup>
<InputGroup label="é€€æˆ¿æ—¥æœŸ" required error={errors.checkOutDate} id="checkOutDate">
    <input 
        disabled={isCustomerMode} 
        type="date" 
        name="checkOutDate" 
        // ğŸŒŸ æ–°å¢ï¼šè¨­å®šæœ€å°å€¼ç‚ºå…¥ä½æ—¥æœŸ (è‹¥æ²’é¸å…¥ä½æ—¥å‰‡è¨­ç‚ºä»Šå¤©)ï¼Œé˜²æ­¢é¸éŒ¯
        min={formData.checkInDate || new Date().toISOString().split('T')[0]} 
        value={formData.checkOutDate || ''} 
        onChange={handleInputChange} 
        className={`w-full cute-input px-4 py-3 ${errors.checkOutDate ? 'input-error' : ''}`} 
    />
</InputGroup>
                                        </div>
                                    )}
                                    {/* è‡ªå‹•è¨ˆç®—æ™šæ•¸ Badge */}
                                    {stayDuration && (
                                        <div className="flex justify-center pt-2 animate-in zoom-in duration-300">
                                            <div className="bg-gradient-to-r from-soosi-wood to-[#7A5E47] text-white px-6 py-2.5 rounded-full font-bold shadow-lg flex items-center gap-2 transform hover:scale-105 transition-transform">
                                                <Icon name="moon" size={18} className="text-soosi-accent" />
                                                <span>å…±å…¥ä½ <span className="text-soosi-accent text-lg">{stayDuration}</span> æ™š</span>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* æ–°å¢ï¼šä½å®¿è©¦ä½ç¢ºèª */}
                                    <div className="bg-yellow-50 text-yellow-800 p-4 rounded-2xl text-[11px] leading-relaxed border border-yellow-100 space-y-3">
                                        <div className="flex items-start gap-2">
                                            <Icon name="alert-triangle" size={16} className="mt-0.5 shrink-0"/>
                                            <div>
                                                <div className="font-bold mb-1">ä½å®¿é ç´„æ³¨æ„äº‹é …</div>
                                                <div>éœ€æ–¼ä¸‰å¤©å…§æ”¯ä»˜è¨‚é‡‘ä»¥ä¿ç•™æˆ¿é–“ã€‚</div>
                                            </div>
                                        </div>

{/* ä¿®æ”¹ï¼šç‹—ç‹—ä¸”ã€Œéå®‰è¦ªã€æ¨¡å¼æ‰é¡¯ç¤ºè©¦ä½å•å· */}
                                        {formData.pet_type === 'dog' && !formData.isDaycare && (
                                            <div className="border-t border-yellow-200 pt-3">
                                                <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1 mb-2">
                                                    <span className="text-soosi-red text-xs">â—</span> 
                                                    æ˜¯å¦å·²åœ¨æœ¬å·¥ä½œå®¤å®‰è¦ªè©¦ä½ï¼Ÿ
                                                </label>
                                                <div className="flex gap-3">
                                                    <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.hasTrialStay ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                        <input type="radio" name="hasTrialStay" value={true} checked={formData.hasTrialStay === true} onChange={() => handleChange('hasTrialStay', true)} className="hidden" />
                                                        <span className="font-bold">æ˜¯</span>
                                                    </label>
                                                    <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.hasTrialStay === false ? 'bg-soosi-red text-white border-soosi-red' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                        <input type="radio" name="hasTrialStay" value={false} checked={formData.hasTrialStay === false} onChange={() => handleChange('hasTrialStay', false)} className="hidden" />
                                                        <span className="font-bold">å¦</span>
                                                    </label>
                                                </div>
                                                {errors.hasTrialStay && <div className="field-error mt-2"><Icon name="alert-circle" size={12}/>{errors.hasTrialStay}</div>}
                                                {!formData.hasTrialStay && (
                                                    <div className="mt-3 p-3 bg-white rounded-lg border border-yellow-200 text-xs text-yellow-800">
                                                        è«‹å…ˆåŸ·è¡Œå®‰è¦ªè©¦ä½å¾Œå†é ç´„ä½å®¿ã€‚ç¾å®¹å¯å…è²»2å°æ™‚å®‰è¦ªè©¦ä½ï¼Œä¹Ÿå¯å–®ç´”å®‰è¦ªã€‚
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ) : (
                                /* ç¾å®¹æ¨¡å¼é¡¯ç¤º */
                                <div className="grid md:grid-cols-2 gap-5">
                                    <InputGroup label="é ç´„æ—¥æœŸ" required error={errors.bookingDate} id="bookingDate">
                                        <input disabled={isCustomerMode} type="date" name="bookingDate" value={formData.bookingDate || ''} onChange={handleInputChange} className={`w-full cute-input px-4 py-3 ${errors.bookingDate ? 'input-error' : ''}`} />
                                    </InputGroup>
<InputGroup label="é ç´„æ™‚æ®µ" required error={errors.bookingTime} id="bookingTime">
                                        <select disabled={isCustomerMode} name="bookingTime" value={formData.bookingTime || ''} onChange={handleInputChange} className={`w-full cute-input px-4 py-3 appearance-none ${errors.bookingTime ? 'input-error' : ''}`}>
                                            <option value="">è«‹é¸æ“‡æ™‚æ®µ</option>
                                            {/* ğŸŒŸ åªæœ‰ã€Œä¸åœ¨ä¸å¯é¸æ¸…å–®ä¸­ã€çš„æ™‚æ®µæ‰æœƒå‡ºç¾ */}
                                            {timeSlots.filter(t => !unavailableSlots.includes(t)).map(time => (
                                                <option key={time} value={time}>{time}</option>
                                            ))}
                                        </select>
                                    </InputGroup>
                                </div>
                            )}
                        </section>

{/* æ–°å¢ï¼šæœå‹™å…§å®¹å€å¡Š (æ”¾åœ¨é ç´„æ™‚é–“ä¸‹æ–¹) - ä¿®æ”¹ï¼šæ•´å¡Šåƒ…åœ¨ç¾å®¹æ¨¡å¼é¡¯ç¤ºï¼Œä½å®¿æ¨¡å¼éš±è— */}
                        {!isBoarding && (
                            <section className="cute-card p-8 space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-200">
                                <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                    <span className="text-2xl">ğŸ›</span>
                                    <h3 className="text-lg font-black text-soosi-dark">æœå‹™å…§å®¹é¸æ“‡</h3>
                                </div>

                                <div className="mt-6 space-y-4">
                                    <div className="flex items-center gap-2">
                                        <h3 className="text-lg font-black text-soosi-dark">æœ¬æ¬¡æœå‹™å…§å®¹<span className="text-red-500">*</span></h3>
                                        <span className="text-xs text-soosi-red font-bold">è«‹é¸æ“‡è‡³å°‘ä¸€é …</span>
                                    </div>
                                    
                                    {/* æœå‹™é …ç›®é¸å–®å€ (ç¾å®¹æ¨¡å¼å°ˆç”¨) */}
                                    <div className="space-y-6">
                                        {/* 1. åŸºç¤èˆ‡åŠ è³¼æœå‹™ */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {(() => {
                                                // 1. å®šç¾©åŸºç¤æœå‹™ (å€åˆ†è²“ç‹—)
                                                let baseServices = [];
                                                if (formData.pet_type === 'dog') {
                                                    baseServices = [
                                                        { id: 'basic', title: 'å°ç¾å®¹', desc: 'æ´—æ¾¡ã€å‰ªæŒ‡ç”²ã€å‰ƒè…³åº•æ¯›ã€å±å±æ¯›ã€è‚šå­æ¯›ã€æ“ è‚›é–€è…ºã€æ¸…è€³æœµã€è‡‰éƒ¨å¾®ä¿®', highlight: true, icon: 'droplets', color: 'text-soosi-pink' },
                                                        { id: 'full', title: 'å¤§ç¾å®¹', desc: 'åŒ…å«å°ç¾å®¹æ‰€æœ‰é …ç›®ï¼Œå¤–åŠ å…¨èº«é€ å‹ä¿®å‰ª', highlight: true, icon: 'sparkles', color: 'text-soosi-purple' },
                                                    ];
                                                } else {
                                                    baseServices = [
                                                        { id: 'basic', title: 'å°ç¾å®¹', desc: 'æ´—æ¾¡ã€å‰ªæŒ‡ç”²ã€å‰ƒè…³åº•æ¯›ã€å±å±æ¯›ã€æ“ è‚›é–€è…ºã€æ¸…è€³æœµ (ç„¡å‰ƒè‚šæ¯›/ç„¡è‡‰éƒ¨ä¿®å‰ª)', highlight: true, icon: 'droplets', color: 'text-soosi-pink' },
                                                        { id: 'full', title: 'å¤§ç¾å®¹', desc: 'åŒ…å«å°ç¾å®¹æ‰€æœ‰é …ç›®ï¼Œå¤–åŠ å…¨èº«å‰ƒæ¯› (ç„¡é€ å‹ä¿®å‰ª)', highlight: true, icon: 'sparkles', color: 'text-soosi-purple' },
                                                    ];
                                                }

                                                // 2. å®šç¾©å‹•æ…‹åŠ è³¼é …ç›® (æ ¹æ“šç‹—/è²“)
                                                let extraServices = [];
                                                if (formData.pet_type === 'dog') {
                                                    extraServices = [
                                                        { id: 'local_style', title: 'å±€éƒ¨ä¿®é£¾', desc: 'è²´è³“è‡‰/è…³ $150 / $300', highlight: false, icon: 'scissors', color: 'text-soosi-wood' },
                                                        { id: 'special_style', title: 'ç‰¹æ®Šé€ å‹', desc: 'è…³çƒ/è…³æŸ± $400èµ·', highlight: false, icon: 'sparkles', color: 'text-soosi-accent' },
                                                        { id: 'scissor_cut', title: 'å…¨èº«æ‰‹å‰ª', desc: 'å…¨èº«æ‰‹å‰ªé€ å‹ $500èµ·', highlight: false, icon: 'scissors', color: 'text-soosi-red' }
                                                    ];
                                                } else if (formData.pet_type === 'cat') {
                                                    extraServices = [
                                                        { id: 'local_degrease', title: 'å±€éƒ¨å»æ²¹', desc: 'å±€éƒ¨ $200', highlight: false, icon: 'droplets', color: 'text-soosi-wood' },
                                                        { id: 'full_degrease', title: 'å…¨èº«å»æ²¹', desc: 'å…¨èº« $800~1000', highlight: false, icon: 'sparkles', color: 'text-soosi-green' }
                                                    ];
                                                }

                                                // 3. å®šç¾©å›ºå®šåœ¨æœ€å¾Œçš„é …ç›®
                                                const fixedServices = [
                                                    { id: 'boarding', title: 'å¯µç‰©å®‰è¦ª', desc: 'æä¾›å¯µç‰©å®‰è¦ªç…§è­·æœå‹™', highlight: false, icon: 'alert-circle', color: 'text-orange-500' },
                                                    { id: 'other', title: 'å…¶ä»–é …ç›®', desc: 'è«‹åœ¨ä¸‹æ–¹è¼¸å…¥æ¡†èªªæ˜', highlight: false, icon: 'plus-circle', color: 'text-gray-500' }
                                                ];

                                                const allServices = [...baseServices, ...extraServices, ...fixedServices];

                                                return allServices.map((item) => (
                                                    <label key={item.id} className={`cursor-pointer relative p-5 rounded-xl border-2 transition-all group ${
                                                        formData.service_items.includes(item.id) 
                                                            ? (item.highlight ? 'border-soosi-wood bg-soosi-wood/10 shadow-lg' : 'border-soosi-green bg-soosi-green/5 shadow-md') 
                                                            : 'border-gray-200 hover:border-soosi-green/50 bg-white'
                                                    }`}>
                                                        <div className="flex items-start gap-3">
                                                            <div className={`mt-0.5 w-10 h-10 rounded-full flex items-center justify-center transition-colors ${
                                                                formData.service_items.includes(item.id) 
                                                                    ? (item.highlight ? 'bg-soosi-wood text-white' : 'bg-soosi-green text-white') 
                                                                    : 'bg-gray-100 text-gray-400'
                                                            }`}>
                                                                <Icon name={item.icon} size={20} className={formData.service_items.includes(item.id) ? "text-white" : ""} />
                                                            </div>
                                                            <div className="flex-1">
                                                                <div className={`font-bold text-base mb-1 ${formData.service_items.includes(item.id) ? (item.highlight ? 'text-soosi-wood' : 'text-soosi-green') : 'text-soosi-dark'}`}>{item.title}</div>
                                                                <div className={`text-xs leading-relaxed ${formData.service_items.includes(item.id) ? 'text-gray-600' : 'text-gray-400'}`}>{item.desc}</div>
                                                            </div>
                                                        </div>
<input 
    type="checkbox" 
    className="hidden" 
    disabled={isCustomerMode} // åŠ å…¥é–å®š
    checked={formData.service_items.includes(item.id)} 
    onChange={(e) => {
        if (isCustomerMode) return; // å®‰å…¨ä¿è­·
        if (e.target.checked) {
            setFormData(prev => ({ ...prev, service_items: [...prev.service_items, item.id] }));
        } else {
            setFormData(prev => ({ ...prev, service_items: prev.service_items.filter(id => id !== item.id) }));
        }
    }}
/>
                                                    </label>
                                                ));
                                            })()}
                                        </div>

{/* 2. SPA å‡ç´šé …ç›®å€å¡Š (åç¨±å…¨é¢å‡ç´šç‰ˆ) */}
                                            <div className="bg-white rounded-xl border border-soosi-wood/10 p-4 space-y-3">
                                                <div className="flex items-center gap-2 border-b border-gray-100 pb-2">
                                                    <div className="bg-soosi-accent text-soosi-dark text-[10px] font-black px-2 py-0.5 rounded">HOT</div>
                                                    <h4 className="font-bold text-soosi-wood text-sm">å®¢è£½åŒ– SPA å‡ç´šæ¨è–¦</h4>
                                                </div>
                                                <div className="grid grid-cols-2 gap-2">
                                                    {[
                                                        { id: 'spa_dental', title: 'å£è…”å‡è† ', price: '$100UP' },
                                                        { id: 'spa_oil', title: 'æ½”è†šæ²¹(å±€éƒ¨é«’æ±™)', price: '$100UP' },
                                                        { id: 'spa_ceramide_local', title: 'å±€éƒ¨ç¥ç¶“é†¯èƒºä¿æ¿•å°å…¥', price: '$100UP' },
                                                        { id: 'spa_ceramide_full', title: 'å…¨èº«ç¥ç¶“é†¯èƒºä¿æ¿•å°å…¥', price: '$200UP' },
                                                        { id: 'spa_ear', title: 'æ—¥æœ¬æ¡è€³', price: '$150UP' },
                                                        { id: 'spa_carbon', title: 'æ—¥æœ¬ç”˜è‰æ·¨ç™½ç¢³é…¸æµ´', price: '$300UP' },
                                                        { id: 'spa_bath', title: 'èˆ’æ•å°ˆç§‘å…¥æµ´æ¹¯', price: '$300UP' },
                                                        { id: 'spa_nano', title: 'æ¯›å›Šæ¸…æ½”å¥ˆç±³æµ´SPA', price: '$300UP' },
                                                        { id: 'spa_salt', title: 'æ—¥æœ¬æ™¶ç…¥èˆ’å£“æµ·é¹½æµ´', price: '$300UP' },
                                                        { id: 'spa_mud_exfoliate', title: 'æ—¥æœ¬æœ‰æ©Ÿå»è§’è³ªæ³¥æµ´', price: '$600UP' },
                                                        { id: 'spa_bubble', title: 'ç²‰ç´…æ³¡æ³¡æ°´ç™‚æµ´', price: '$300UP' },
                                                        { id: 'spa_volcano', title: 'æ‘©æ´›å“¥ç«å±±æ³¥æµ´', price: '$300UP' },
                                                    ].map(spa => (
                                                        <label key={spa.id} className={`flex flex-col p-2 rounded-lg border cursor-pointer transition-all ${
                                                            formData.service_items.includes(spa.id) 
                                                            ? 'bg-soosi-wood/5 border-soosi-wood' 
                                                            : 'bg-white border-gray-100 hover:border-soosi-wood/30'
                                                        }`}>
                                                            <div className="flex justify-between items-start mb-1">
                                                                <input 
                                                                    type="checkbox" 
                                                                    disabled={isCustomerMode} // é–å®š
                                                                    className="accent-soosi-wood w-3 h-3 mt-0.5" 
                                                                    checked={formData.service_items.includes(spa.id)}
                                                                    onChange={(e) => {
                                                                        toggleArray('service_items', spa.id);
                                                                    }}
                                                                />
                                                                <span className="text-[10px] font-bold text-soosi-wood bg-soosi-wood/10 px-1 py-0.5 rounded scale-90 origin-right">{spa.price}</span>
                                                            </div>
                                                            <span className={`text-[11px] font-bold ${formData.service_items.includes(spa.id) ? 'text-soosi-dark' : 'text-gray-500'}`}>{spa.title}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        {/* å…¶ä»–æœå‹™é …ç›®èªªæ˜ */}
                                        {formData.service_items.includes('other') && (
                                            <div className="mt-4 animate-in fade-in">
                                                <InputGroup label="è«‹è©³ç´°èªªæ˜å…¶ä»–é …ç›®" required error={errors.service_items_other} id="service_items_other">
                                                    <textarea 
                                                        value={formData.service_items_other || ''} 
                                                        onChange={(e) => handleChange('service_items_other', e.target.value)}
                                                        placeholder="ä¾‹å¦‚ï¼šåªå‰ƒè…³åº•ã€åªå‰ªæŒ‡ç”²..."
                                                        className="w-full cute-input px-4 py-3 resize-none"
                                                        rows="3"
                                                    />
                                                </InputGroup>
                                            </div>
                                        )}
                                    </div>
{/* â˜… é›†é»å¡ (å‚³å…¥æ§åˆ¶åƒæ•¸) â˜… */}
                                    {loyaltyInfo && (
                                        <div className="mb-6">
                                            <LoyaltyProgressCard 
                                                info={loyaltyInfo} 
                                                formData={formData}        // å‚³å…¥è¡¨å–®è³‡æ–™
                                                setFormData={setFormData}  // å‚³å…¥è¨­å®šå‡½æ•¸
                                                isCustomerMode={isCustomerMode} // å‚³å…¥æ˜¯å¦ç‚ºå®¢äººæ¨¡å¼(é–å®š)
                                            />
                                        </div>
                                    )}

{/* é ä¼°é‡‘é¡å€å¡Š (ç¾å®¹å°ˆç”¨) */}
{/* ä¿®æ”¹å¾Œçš„é‡‘é¡è¼¸å…¥å€å¡Šï¼šå¸³å–®æ˜ç´°é¢¨æ ¼ */}
<div className="cute-card p-6 space-y-4 border-2 border-soosi-wood/20">
    <div className="flex items-center justify-between border-b border-soosi-wood/10 pb-2 mb-2">
        <h3 className="font-black text-lg text-soosi-wood flex items-center gap-2">
            <Icon name="wallet" size={20}/> è²»ç”¨æ˜ç´°
        </h3>
        
    </div>    
    <div className="bg-white p-5 rounded-xl border border-soosi-wood/10 shadow-sm space-y-4">
        {/* 1. åŸåƒ¹è¼¸å…¥è¡Œ */}
        <div className="flex items-center justify-between">
            <label className="text-sm font-bold text-gray-500">æœ¬æ¬¡æœå‹™</label>
            <div className="flex items-center gap-2">
                <span className="font-black text-soosi-wood text-lg">$</span>
<input 
    type="number" 
    inputMode="numeric" 
    name="estimated_price"
    disabled={isCustomerMode}
    value={formData.estimated_price || ''} 
    onChange={handleInputChange}
    placeholder="åº—å“¡å ±åƒ¹"
                    className={`w-28 text-right cute-input px-2 py-1.5 text-lg font-mono font-bold text-soosi-wood border-gray-200 focus:ring-1 focus:ring-soosi-wood ${isCustomerMode ? 'bg-gray-50' : ''}`}
                />
            </div>
        </div>

        {/* 2. æŠ˜æ‰£è¡Œ (åªæœ‰å‹¾é¸æ™‚æ‰é¡¯ç¤º) */}
        <div className={`flex items-center justify-between transition-all duration-500 ease-in-out overflow-hidden ${formData.usePromo50 ? 'max-h-10 opacity-100' : 'max-h-0 opacity-0'}`}>
            <label className="text-sm font-bold text-soosi-red flex items-center gap-1">
                <Icon name="sparkles" size={14}/> 50å¤©å›è¨ªå„ªæƒ 
            </label>
            <span className="font-mono font-bold text-soosi-red text-lg">- $200</span>
        </div>

        {/* åˆ†éš”ç·š */}
        <div className="border-t border-dashed border-gray-200 my-1"></div>

        {/* 3. ç¸½è¨ˆè¡Œ (è‡ªå‹•è¨ˆç®—) */}
        <div className="flex items-center justify-between">
            <label className="text-base font-black text-soosi-dark">æ‡‰æ”¶ç¸½é¡</label>
            <div className="flex items-baseline gap-1">
                <span className="text-sm font-bold text-gray-400">NT$</span>
                <span className="text-3xl font-black text-soosi-green tracking-tight">
                    {/* è‡ªå‹•è¨ˆç®—ï¼šå¦‚æœè¼¸å…¥äº†æ•¸å­—ï¼Œå°±æ¸›å»å„ªæƒ (å¦‚æœæœ‰)ï¼Œå¦å‰‡é¡¯ç¤º 0 */}
                    {formData.estimated_price ? (parseInt(formData.estimated_price) - (formData.usePromo50 ? 200 : 0)) : 0}
                </span>
            </div>
        </div>
    </div>

{/* è­¦èªå€å¡Š (è¦–è¦ºå„ªåŒ–ç‰ˆï¼šæ‹†åˆ†ä¸€èˆ¬å‚™è¨»èˆ‡åš´é‡è­¦ç¤º) */}
    <div className="space-y-2 pt-1">
        {/* 1. æµ®å‹•å ±åƒ¹ (æº«å’Œæé†’) */}
        <div className="bg-gray-50 p-3 rounded-xl border border-gray-200 text-[11px] text-gray-500 leading-relaxed flex items-start gap-2">
            <Icon name="info" size={14} className="mt-0.5 shrink-0 text-gray-400"/>
            <div>
                <span className="font-bold text-gray-600">è²»ç”¨èªªæ˜ï¼š</span>
                å¯¦éš›é‡‘é¡ä¾ç¾å ´æ¸¬é‡ã€Œé«”é‡ã€æ¯›é‡ã€å»¢æ¯›ã€ç‚ºæº–ã€‚è‹¥æœ‰åš´é‡æ‰“çµæˆ–æ”»æ“Šè¡Œç‚ºï¼Œå°‡å¦åŠ æ”¶è™•ç†è²»ã€‚
            </div>
        </div>
        {/* 2. åš´é‡è¦ç¯„ (ç´…è‰²è­¦ç¤º) */}
        <div className="bg-red-50 p-3 rounded-xl border border-red-100 text-[11px] text-soosi-red leading-relaxed flex items-start gap-2">
            <Icon name="alert-triangle" size={14} className="mt-0.5 shrink-0"/>
            <div>
                <span className="font-bold">é‡è¦è¦ç¯„ï¼š</span>
                æœ¬åº—ä¸æ¥æœ‰å¯„ç”ŸèŸ²ã€å‚³æŸ“ç–¾ç—…ä¹‹æ¯›å­©ã€‚è‹¥éç¨‹ä¸­ç™¼ç¾ï¼Œå°‡é¡å¤–æ”¶å– <span className="font-black underline">ç’°å¢ƒæ¸…æ½”è²» $1000</span>ã€‚
            </div>
        </div>
    </div>
</div>
                                </div>
                            </section>
                        )}
{/* ä½å®¿å°ˆç”¨è¡¨å–® (å…¶ä»–ç´°ç¯€) */}
                    {isBoarding && (
                        <div className="space-y-8 animate-in fade-in slide-in-from-bottom-8 duration-700">
                            
                            {/* å€å¡Š 2: é£²é£Ÿç¿’æ…£ (å…±é€šé …ç›® - æ–°å¢) */}
                            <div className="bg-white p-6 rounded-3xl shadow-sm border border-soosi-green/10 space-y-6">
                                <h3 className="font-black text-lg text-soosi-green flex items-center gap-2 border-b border-soosi-green/10 pb-2">
                                    <Icon name="utensils" size={20}/> é£²é£Ÿç¿’æ…£èª¿æŸ¥<span className="text-red-500">*</span>
                                </h3>

                                <div className="space-y-4">
                                    {/* ç•°é£Ÿç™– */}
<InputGroup label="æ˜¯å¦æœ‰ç•°é£Ÿç™– (äº‚åƒæ±è¥¿)ï¼Ÿ" required error={errors.pica} id="pica">
                                        <div className="flex gap-3">
                                            <PillBtn active={formData.pica === 'æœ‰'} onClick={()=>handleChange('pica', 'æœ‰')}>æœ‰ (è«‹å‚™è¨»)</PillBtn>
                                            <PillBtn active={formData.pica === 'ç„¡'} onClick={()=>handleChange('pica', 'ç„¡')}>ç„¡</PillBtn>
                                        </div>
                                        {formData.pica === 'æœ‰' && (
                                            <input type="text" placeholder="ä¾‹å¦‚ï¼šæœƒåƒå¸ƒã€å·§æ‹¼ã€å¡‘è† è¢‹..." 
                                                value={formData.pica_note || ''} onChange={e=>handleChange('pica_note', e.target.value)}
                                                className="w-full cute-input px-4 py-3 mt-2" />
                                        )}
                                    </InputGroup>

                                    {/* é£²é£Ÿç¨®é¡ (è¤‡é¸) */}
                                    <div className="space-y-2">
<label className="text-sm font-bold text-soosi-dark ml-1">å¹³æ™‚é£²é£Ÿç¿’æ…£ (å¯è¤‡é¸) <span className="text-red-500">*</span></label>
                                        <div className="flex flex-wrap gap-2">
                                            {['ä¹¾ç³§', 'ç½é ­', 'é®®é£Ÿ', 'ç”Ÿè‚‰', 'å…¶ä»–'].map(opt => (
                                                <button key={opt} type="button" onClick={() => toggleArray('diet_type', opt)}
                                                    className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all ${
                                                        (formData.diet_type || []).includes(opt) 
                                                        ? 'bg-soosi-green text-white border-soosi-green' 
                                                        : 'bg-white text-gray-500 border-gray-200'
                                                    }`}>
                                                    {opt}
                                                </button>
                                            ))}
                                        </div>
                                        {/* ç•¶é¸æ“‡ã€Œå…¶ä»–ã€æ™‚é¡¯ç¤ºè¼¸å…¥æ¡† */}
                                        {(formData.diet_type || []).includes('å…¶ä»–') && (
                                            <div className="animate-in fade-in slide-in-from-top-1 mt-2">
                                                <input 
                                                    type="text" 
                                                    name="diet_type_other"
                                                    value={formData.diet_type_other || ''} 
                                                    onChange={handleInputChange} 
                                                    placeholder="è«‹èªªæ˜å…¶ä»–é£²é£Ÿç¿’æ…£..." 
                                                    className="w-full cute-input px-4 py-3" 
                                                />
                                            </div>
                                        )}
                                    </div>

                                    {/* é¤µé£Ÿé »ç‡èˆ‡ä»½é‡ */}
                                    <InputGroup label="é¤µé£Ÿé »ç‡èˆ‡ä»½é‡èªªæ˜" required error={errors.feeding_plan} id="feeding_plan">
                                        <textarea rows="3" placeholder="ä¾‹å¦‚ï¼šæ—©æ™šå„ä¸€æ¬¡ï¼Œæ¯æ¬¡ä¸€åŒ™ä¹¾ç³§+åŠç½ç½é ­..." 
                                            value={formData.feeding_plan || ''} onChange={e=>handleChange('feeding_plan', e.target.value)}
                                            className="w-full cute-input px-4 py-3 resize-none" />
                                    </InputGroup>
                                </div>
                            </div>
                            
                            {/* å€å¡Š 3: åŸºæœ¬èª¿æŸ¥ (è²“ç‹—åˆ†æµé‚è¼¯) */}
                            <div className="bg-white p-6 rounded-3xl shadow-sm border border-soosi-green/10 space-y-6">                                
                                <h3 className="font-black text-lg text-soosi-green flex items-center gap-2 border-b border-soosi-green/10 pb-2">
                                    <Icon name="clipboard" size={20}/> {formData.pet_type === 'dog' ? 'ç‹—ç‹—' : 'è²“å’ª'}ç”Ÿæ´»èª¿æŸ¥
                                </h3>

{/* 1. è²“ç‹—å…±é€šé¡Œç›® */}
                                <div className="space-y-6">
                                    {/* ä½å®¿ç¶“é©— */}
                                    <div className="space-y-2">
                                        <label className="text-sm font-bold text-soosi-dark ml-1">æœ‰ä½å®¿éçš„ç¶“é©—å— <span className="text-red-500">*</span></label>
                                        <div className="flex gap-4">
                                            {['æœ‰', 'æ²’æœ‰'].map(opt => (
                                                <label key={opt} className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.hasBoardingExp === opt ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                    <input type="radio" name="hasBoardingExp" value={opt} checked={formData.hasBoardingExp === opt} onChange={handleInputChange} className="hidden" />
                                                    <span className="font-bold">{opt}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

{/* ç–«è‹—é¡Œç›® + ä¸Šå‚³åŠŸèƒ½ */}
                                    <div className="space-y-3">
                                        <label className="text-sm font-bold text-soosi-dark ml-1">æ¯å¹´å®šæœŸæ–½æ‰“ç–«è‹— (è«‹æä¾›ç–«è‹—æ‰‹å†Š) <span className="text-red-500">*</span></label>
                                        <div className="flex gap-4">
                                            {['æœ‰', 'æ²’æœ‰'].map(opt => (
                                                <label key={opt} className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.vaccine === opt ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                    <input type="radio" name="vaccine" value={opt} checked={formData.vaccine === opt} onChange={handleInputChange} className="hidden" />
                                                    <span className="font-bold">{opt}</span>
                                                </label>
                                            ))}
                                        </div>
                                        
                                        {/* ç•¶é»é¸ã€Œæœ‰ã€æ™‚ï¼Œé¡¯ç¤ºä¸Šå‚³å€åŸŸ */}
                                        {formData.vaccine === 'æœ‰' && (
                                            <div className="animate-in slide-in-from-top-2">
                                                {formData.vaccine_url ? (
                                                    <div className="flex items-center gap-2 bg-white p-3 rounded-xl border border-green-200 text-green-600 text-xs font-bold shadow-sm">
                                                        <Icon name="check-circle" size={16}/>
                                                        <span>æ‰‹å†Šä¸Šå‚³å®Œç•¢</span>
                                                        <a href={formData.vaccine_url} target="_blank" className="ml-auto text-[10px] bg-green-50 px-2 py-1 rounded">æŸ¥çœ‹</a>
                                                        <button type="button" onClick={()=>setFormData(p=>({...p, vaccine_url: ''}))} className="text-gray-300 p-1"><Icon name="x" size={14}/></button>
                                                    </div>
                                                ) : (
                                                    <div className="relative">
                                                        <input 
                                                            type="file" 
                                                            accept="image/*"
                                                            onChange={handleVaccineUpload}
                                                            disabled={isUploadingVaccine}
                                                            className="block w-full text-xs text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-xl file:border-0 file:text-xs file:font-bold file:bg-soosi-green/10 file:text-soosi-green hover:file:bg-soosi-green/20 transition-all cursor-pointer bg-white rounded-xl border border-gray-200"
                                                        />
                                                        {isUploadingVaccine && (
                                                            <div className="absolute inset-0 bg-white/80 rounded-xl flex items-center justify-center text-xs font-bold text-soosi-green gap-2 backdrop-blur-sm z-10">
                                                                <Icon name="loader-2" className="animate-spin" size={16}/> ä¸Šå‚³æ‰‹å†Šä¸­...
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {errors.vaccine_url && (
                                            <div className="field-error mt-2">
                                                <Icon name="alert-circle" size={12}/>{errors.vaccine_url}
                                            </div>
                                        )}
                                    </div>

{/* é©…èŸ²é é˜² */}
                                    <div className="space-y-2" id="deworm_brand">
                                        <label className="text-sm font-bold text-soosi-dark ml-1">æ¯æœˆå®šæœŸé©…èŸ²é é˜² <span className="text-red-500">*</span></label>
                                        <div className="flex gap-4">
                                            {['æœ‰', 'ç„¡'].map(opt => (
                                                <label key={opt} className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.deworm === opt ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                    <input type="radio" name="deworm" value={opt} checked={formData.deworm === opt} onChange={handleInputChange} className="hidden" />
                                                    <span className="font-bold">{opt}</span>
                                                </label>
                                            ))}
                                        </div>
                                        
                                        {/* ç•¶é¸æ“‡ã€Œæœ‰ã€æ™‚ï¼Œé¡¯ç¤ºç‰Œå­è¼¸å…¥æ¡† */}
                                        {formData.deworm === 'æœ‰' && (
                                            <div className="animate-in slide-in-from-top-2 mt-2">
                                                <input 
                                                    type="text" 
                                                    name="deworm_brand"
                                                    value={formData.deworm_brand || ''} 
                                                    onChange={handleInputChange} 
                                                    placeholder="è«‹è¼¸å…¥é©…èŸ²è—¥ç‰Œå­ (ä¾‹å¦‚ï¼šå…¨èƒ½ç‹—ã€ä¸€éŒ é™¤...)" 
                                                    className={`w-full cute-input px-4 py-3 ${errors.deworm_brand ? 'border-red-400 bg-red-50' : 'bg-white'}`}
                                                />
                                                {errors.deworm_brand && <div className="field-error mt-1"><Icon name="alert-circle" size={12}/>{errors.deworm_brand}</div>}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* 2. ç‹—ç‹—å°ˆå±¬é¡Œç›® */}
                                {formData.pet_type === 'dog' && (
                                    <div className="space-y-6 pt-4 border-t border-dashed border-gray-200 animate-in fade-in">
                                        {[
{ id: 'isBarking', label: 'æœƒå®¹æ˜“å å«å—', required: true, options: ['æœƒ', 'ä¸æœƒ'] },
                                            { id: 'isFoodGuarding', label: 'æœƒè­·é£Ÿå—', required: true, options: ['æœƒ', 'ä¸æœƒ'] },
                                            { id: 'useToiletPad', label: 'æœƒåœ¨å°¿å¸ƒå¢Šä¸Šä¸Šå»æ‰€å—', required: true, options: ['æœƒ', 'ä¸æœƒ'] },
                                            { id: 'isWalking', label: 'æ˜¯å¦è¦å¤–å‡ºæ•£æ­¥', required: true, options: ['æ˜¯', 'å¦'] },
                                        ].map((q, idx) => (
                                            <div key={idx} className="space-y-2">
                                                <label className="text-sm font-bold text-soosi-dark ml-1">{q.label} {q.required && <span className="text-red-500">*</span>}</label>
                                                <div className="flex gap-4">
                                                    {q.options.map(opt => (
                                                        <label key={opt} className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData[q.id] === opt ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                            <input type="radio" name={q.id} value={opt} checked={formData[q.id] === opt} onChange={handleInputChange} className="hidden" />
                                                            <span className="font-bold">{opt}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}

                                        {/* ç± å…§è¨“ç·´ (è¤‡é¸) - åƒ…ç‹— */}
                                        <div className="space-y-3 pt-2">
                                            <label className="text-sm font-bold text-soosi-dark ml-1">ç± å…§è¨“ç·´ç‹€æ³ (å¯è¤‡é¸) <span className="text-red-500">*</span></label>
                                            <div className="bg-orange-50 p-3 rounded-lg text-xs text-orange-800 border border-orange-100 mb-2">
                                                ğŸ’¡ ä½•è¬‚ç± å…§è¨“ç·´ï¼šèƒ½åœ¨åœæ¬„æˆ–æˆ¿é–“å…§ç¨ç«‹ä¼‘æ¯ï¼Œä¸ç„¦æ…®ã€ä¸æŒçºŒå å«ã€ä¸æ¿€å‹•è¡æ’
                                            </div>
                                            <div className="space-y-2">
                                                {[
                                                    'æœ‰ å¹³å¸¸åœ¨å®¶éƒ½æœ‰åœ¨åœæ¬„å…§æˆ–ç± å­ç¡è¦º',
                                                    'æœ‰ ä»¥å‰æœ‰è¨“ç·´é ä½†æ—¥å¸¸æ²’æœ‰ç¶­æŒ',
                                                    'æœ‰ ä½†ä¸ç¢ºèªç¾åœ¨èƒ½ä¸èƒ½é©æ‡‰',
                                                    'æ²’æœ‰ ä½†ä¹‹å‰åœ¨å¤–ä½å®¿ åœ¨æˆ¿é–“å¯ä»¥é©æ‡‰å¾—å¾ˆå¥½',
                                                    'å¾ä¾†æ²’æœ‰'
                                                ].map((opt, i) => (
                                                    <label key={i} className="flex items-start gap-3 p-3 rounded-xl border border-gray-200 hover:bg-gray-50 cursor-pointer transition-colors">
                                                        <input 
                                                            type="checkbox" 
                                                            value={opt} 
                                                            checked={(formData.crateTraining || []).includes(opt)}
                                                            onChange={(e) => handleCheckboxChange(e, 'crateTraining')}
                                                            className="mt-1 w-4 h-4 text-soosi-green border-gray-300 rounded focus:ring-soosi-green" 
                                                        />
                                                        <span className="text-sm text-soosi-dark font-medium leading-relaxed">{opt}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* 3. è²“å’ªå°ˆå±¬é¡Œç›® */}
                                {formData.pet_type === 'cat' && (
                                    <div className="space-y-6 pt-4 border-t border-dashed border-gray-200 animate-in fade-in">
                                        <div className="space-y-2">
                                            <label className="text-sm font-bold text-soosi-dark ml-1">è²“ç ‚ä½¿ç”¨ç¿’æ…£ <span className="text-red-500">*</span></label>
                                            <div className="flex gap-4">
                                                <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.litter_type === 'è‡ªå‚™è²“ç ‚' ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                    <input type="radio" name="litter_type" value="è‡ªå‚™è²“ç ‚" checked={formData.litter_type === 'è‡ªå‚™è²“ç ‚'} onChange={handleInputChange} className="hidden" />
                                                    <span className="font-bold">è‡ªå‚™è²“ç ‚</span>
                                                </label>
                                                <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border cursor-pointer transition-all ${formData.litter_type === 'é¤¨å…§ç¤¦ç ‚' ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
                                                    <input type="radio" name="litter_type" value="é¤¨å…§ç¤¦ç ‚" checked={formData.litter_type === 'é¤¨å…§ç¤¦ç ‚'} onChange={handleInputChange} className="hidden" />
                                                    <span className="font-bold">ä½¿ç”¨é¤¨å…§ç¤¦ç ‚</span>
                                                </label>
                                            </div>
                                            <div className="text-xs text-gray-400 pl-1">â€» è‹¥è²“å’ªå°ç ‚ç¨®æ•æ„Ÿï¼Œå»ºè­°è‡ªå‚™ç¿’æ…£çš„è²“ç ‚ã€‚</div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* å€å¡Š 4: è©³ç´°æ–‡å­—æ•˜è¿° (å…±é€š) */}
                            <div className="bg-white p-6 rounded-3xl shadow-sm border border-soosi-green/10 space-y-6">
                                <h3 className="font-black text-lg text-soosi-green flex items-center gap-2 border-b border-soosi-green/10 pb-2">
                                    <Icon name="message-square" size={20}/> {formData.pet_type === 'dog' ? 'ç‹—ç‹—' : 'è²“å’ª'}æ—¥å¸¸æƒ…å½¢å‚™è¨»
                                </h3>
                                
                                <div className="space-y-1">
                                    <label className="text-sm font-bold text-soosi-dark ml-1">æœ‰å°ä»€éº¼éæ•å— (ä¾‹å¦‚:é›è‚‰æˆ–ç‰›è‚‰)</label>
                                    <input type="text" name="allergies" value={formData.allergies || ''} onChange={handleInputChange} placeholder="è«‹å¡«å¯«éæ•æº..." className="w-full bg-gray-50 border-0 rounded-xl p-3 focus:ring-2 focus:ring-soosi-green/30" />
                                </div>

                                <div className="space-y-1">
                                    <label className="text-sm font-bold text-soosi-dark ml-1">å€‹æ€§å¦‚ä½•å‘¢? æœ‰åˆ†é›¢ç„¦æ…®å—? <span className="text-red-500">*</span></label>
                                    <textarea name="personality" required value={formData.personality || ''} onChange={handleInputChange} rows="3" placeholder="è«‹æè¿°å€‹æ€§ã€æ˜¯å¦è¦ªäººã€åˆ†é›¢ç„¦æ…®ç‹€æ³..." className="w-full bg-gray-50 border-0 rounded-xl p-3 focus:ring-2 focus:ring-soosi-green/30 resize-none"></textarea>
                                </div>

                                <div className="space-y-1">
                                    <label className="text-sm font-bold text-soosi-dark ml-1">æœ‰éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„å—? ä»»ä½•äº‹æƒ…éƒ½å¯ä»¥èªªè¶Šè©³ç´°è¶Šå¥½</label>
                                    <textarea name="specialNotes" value={formData.specialNotes || ''} onChange={handleInputChange} rows="3" placeholder="ä¾‹å¦‚ï¼šå®³æ€•æ‰“é›·ã€ä¸å–œæ­¡è¢«æ‘¸è…³..." className="w-full bg-gray-50 border-0 rounded-xl p-3 focus:ring-2 focus:ring-soosi-green/30 resize-none"></textarea>
                                </div>
                            </div>
                            {/* å€å¡Š 1: ä½å®¿ç¾å®¹æœå‹™ (å®‰è¦ªæ¨¡å¼éš±è—) */}
                            {!formData.isDaycare && (
                            <div className="cute-card p-6 space-y-4 border-2 border-soosi-green/20">
                                <div className="flex items-center gap-2 border-b border-soosi-green/10 pb-2 mb-2">
                                    <h3 className="font-black text-lg text-soosi-green flex items-center gap-2">
                                        <Icon name="scissors" size={20}/> ä½å®¿æœŸé–“ç¾å®¹æœå‹™
                                    </h3>
                                </div>
                                
                                <div className="space-y-4">
                                    {/* çµ±ä¸€æ”¹ç‚º Yes/No é¸æ“‡ */}
                                    <div className="space-y-2">
                                        <label className="text-sm font-bold text-soosi-dark ml-1">
                                            {formData.pet_type === 'dog' ? 'æ˜¯å¦è¦åœ¨æœ¬é¤¨å®‰æ’æ´—æ¾¡ï¼Ÿ' : 'æ˜¯å¦éœ€è¦åœ¨ä½å®¿æœŸé–“å®‰æ’ç¾å®¹ï¼Ÿ'}<span className="text-red-500">*</span>
                                        </label>
                                        <div className="flex gap-3 mb-4">
                                            <PillBtn active={formData.addGrooming === true} onClick={()=>handleChange('addGrooming', true)}>æ˜¯ï¼Œæˆ‘è¦åŠ è³¼</PillBtn>
                                            <PillBtn active={formData.addGrooming === false} onClick={()=>handleChange('addGrooming', false)}>
                                                {formData.pet_type === 'dog' ? 'å¦ (éœ€æä¾›æ´—æ¾¡è­‰æ˜)' : 'å¦ï¼Œç´”ä½å®¿'}
                                            </PillBtn>
                                        </div>
                                    </div>

{/* ç‹—ç‹—é¸ã€Œå¦ã€æ™‚ï¼šé¡¯ç¤ºè­‰æ˜ä¸Šå‚³æˆ–ç¾å ´æä¾›é¸é … */}
                                    {formData.pet_type === 'dog' && formData.addGrooming === false && (
                                        <div className="bg-orange-50 p-5 rounded-2xl border border-orange-200 space-y-4 animate-in fade-in relative overflow-hidden">
                                            <div className="flex items-start gap-2 text-orange-800 text-xs font-bold">
                                                <Icon name="alert-triangle" size={16} className="shrink-0 mt-0.5"/>
                                                <div className="leading-relaxed">
                                                    ç‚ºç¢ºä¿ç’°å¢ƒè¡›ç”Ÿï¼Œè‹¥æœªåœ¨æœ¬é¤¨æ´—æ¾¡ï¼Œ<span className="underline">éœ€æä¾›å…¥ä½å‰ 3 æ—¥å…§ä¹‹æ´—æ¾¡è­‰æ˜</span>ã€‚
                                                </div>
                                            </div>

                                            {/* é¸æ“‡æä¾›æ–¹å¼ */}
                                            <div className="space-y-2">
                                                <label className="text-xs font-bold text-orange-800 ml-1">è«‹é¸æ“‡è­‰æ˜æ–¹å¼ <span className="text-red-500">*</span>ï¼š</label>
                                                <div className="flex gap-3">
                                                    <button type="button" 
                                                        onClick={() => setFormData(p => ({ ...p, proof_type: 'onsite', proof_url: '' }))}
                                                        className={`flex-1 py-3 rounded-xl text-xs font-bold border transition-all flex flex-col items-center gap-1 ${formData.proof_type === 'onsite' ? 'bg-orange-400 text-white border-orange-400 shadow-md' : 'bg-white text-gray-400 border-orange-100 hover:bg-orange-50'}`}>
                                                        <Icon name="clipboard" size={16}/> ç¾å ´æä¾›ç´™æœ¬
                                                    </button>
                                                    <button type="button" 
                                                        onClick={() => setFormData(p => ({ ...p, proof_type: 'upload' }))}
                                                        className={`flex-1 py-3 rounded-xl text-xs font-bold border transition-all flex flex-col items-center gap-1 ${formData.proof_type === 'upload' ? 'bg-orange-400 text-white border-orange-400 shadow-md' : 'bg-white text-gray-400 border-orange-100 hover:bg-orange-50'}`}>
                                                        <Icon name="upload-cloud" size={16}/> ä¸Šå‚³ç…§ç‰‡/æ”¶æ“š
                                                    </button>
                                                </div>

                                                {errors.proof_type && (
                                                    <div className="field-error mt-2">
                                                        <Icon name="alert-circle" size={12}/>{errors.proof_type}
                                                    </div>
                                                )}

                                                {errors.proof_url && (
                                                    <div className="field-error mt-2">
                                                        <Icon name="alert-circle" size={12}/>{errors.proof_url}
                                                    </div>
                                                )}
                                            </div>

                                            {/* ä¾é¸æ“‡é¡¯ç¤ºä¸åŒå…§å®¹ */}
                                            {formData.proof_type === 'onsite' && (
                                                <div className="animate-in fade-in p-3 bg-white/60 rounded-xl text-center text-xs font-bold text-orange-800/70 border border-orange-100">
                                                    è«‹æ–¼å…¥ä½ç•¶å¤©æ”œå¸¶æ”¶æ“šæˆ–ç›¸é—œè­‰æ˜æ–‡ä»¶å‚™æŸ¥ã€‚
                                                </div>
                                            )}

{formData.proof_type === 'upload' && (
                                                <div className="animate-in slide-in-from-top-2">
                                                    {formData.proof_url ? (
                                                        <div className="flex items-center gap-2 bg-white p-3 rounded-xl border border-green-200 text-green-600 text-xs font-bold shadow-sm">
                                                            <div className="bg-green-100 p-1 rounded-full"><Icon name="check" size={14}/></div>
                                                            <span>è­‰æ˜ä¸Šå‚³æˆåŠŸï¼</span>
                                                            <a href={formData.proof_url} target="_blank" className="ml-auto text-xs bg-green-50 px-2 py-1 rounded-md hover:bg-green-100 transition-colors">æŸ¥çœ‹</a>
                                                            <button type="button" onClick={()=>setFormData(p=>({...p, proof_url: ''}))} className="text-gray-300 hover:text-red-400 p-1"><Icon name="x" size={14}/></button>
                                                        </div>
                                                    ) : (
                                                        <div className="relative group">
                                                            <input 
                                                                type="file" 
                                                                accept="image/*"
                                                                onChange={handleFileUpload}
                                                                disabled={isUploading}
                                                                className="block w-full text-xs text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-xl file:border-0 file:text-xs file:font-bold file:bg-orange-100 file:text-orange-700 hover:file:bg-orange-200 transition-all cursor-pointer bg-white rounded-xl border border-orange-100"
                                                            />
                                                            {isUploading && (
                                                                <div className="absolute inset-0 bg-white/80 rounded-xl flex items-center justify-center text-xs font-bold text-orange-600 gap-2 backdrop-blur-sm z-10">
                                                                    <Icon name="loader-2" className="animate-spin" size={16}/> ä¸Šå‚³ä¸­...
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* æœå‹™é¸é …å€åŸŸï¼šåƒ…ç•¶ addGrooming ç‚º true æ™‚é¡¯ç¤º */}
                                    {formData.addGrooming && (
                                        <div className="animate-in fade-in space-y-6 bg-gray-50 p-5 rounded-2xl border border-gray-200 mt-4">
                                            <div className="flex items-center gap-2 border-b border-gray-200 pb-2 mb-2">
                                                <h4 className="font-bold text-soosi-wood text-sm">è«‹å‹¾é¸æœå‹™é …ç›®ï¼š</h4>
                                            </div>

                                            {/* åŸºç¤èˆ‡åŠ è³¼æœå‹™é¸å–® */}
                                            <div className="grid grid-cols-1 gap-3">
                                                {(() => {
                                                    let baseServices = [];
                                                    if (formData.pet_type === 'dog') {
                                                        baseServices = [
                                                            { id: 'basic', title: 'å°ç¾å®¹', desc: 'æ´—æ¾¡ã€å‰ªæŒ‡ç”²ã€å‰ƒè…³åº•æ¯›ã€å±å±æ¯›ã€è‚šå­æ¯›ã€æ“ è‚›é–€è…ºã€æ¸…è€³æœµã€è‡‰éƒ¨å¾®ä¿®', highlight: true, icon: 'droplets' },
                                                            { id: 'full', title: 'å¤§ç¾å®¹', desc: 'åŒ…å«å°ç¾å®¹æ‰€æœ‰é …ç›®ï¼Œå¤–åŠ å…¨èº«é€ å‹ä¿®å‰ª', highlight: true, icon: 'sparkles' },
                                                        ];
                                                    } else {
                                                        baseServices = [
                                                            { id: 'basic', title: 'å°ç¾å®¹', desc: 'æ´—æ¾¡ã€å‰ªæŒ‡ç”²ã€å‰ƒè…³åº•æ¯›ã€å±å±æ¯›ã€æ“ è‚›é–€è…ºã€æ¸…è€³æœµ (ç„¡å‰ƒè‚šæ¯›/ç„¡è‡‰éƒ¨ä¿®å‰ª)', highlight: true, icon: 'droplets' },
                                                            { id: 'full', title: 'å¤§ç¾å®¹', desc: 'åŒ…å«å°ç¾å®¹æ‰€æœ‰é …ç›®ï¼Œå¤–åŠ å…¨èº«å‰ƒæ¯› (ç„¡é€ å‹ä¿®å‰ª)', highlight: true, icon: 'sparkles' },
                                                        ];
                                                    }

                                                    let extraServices = [];
                                                    if (formData.pet_type === 'dog') {
                                                        extraServices = [
                                                            { id: 'local_style', title: 'å±€éƒ¨ä¿®é£¾', desc: 'è²´è³“è‡‰/è…³ $150 / $300', highlight: false, icon: 'scissors' },
                                                            { id: 'special_style', title: 'ç‰¹æ®Šé€ å‹', desc: 'è…³çƒ/è…³æŸ± $400èµ·', highlight: false, icon: 'sparkles' },
                                                            { id: 'scissor_cut', title: 'å…¨èº«æ‰‹å‰ª', desc: 'å…¨èº«æ‰‹å‰ªé€ å‹ $500èµ·', highlight: false, icon: 'scissors' }
                                                        ];
                                                    } else if (formData.pet_type === 'cat') {
                                                        extraServices = [
                                                            { id: 'local_degrease', title: 'å±€éƒ¨å»æ²¹', desc: 'å±€éƒ¨ $200', highlight: false, icon: 'droplets' },
                                                            { id: 'full_degrease', title: 'å…¨èº«å»æ²¹', desc: 'å…¨èº« $800~1000', highlight: false, icon: 'sparkles' }
                                                        ];
                                                    }

                                                    const fixedServices = [
                                                        { id: 'other', title: 'å…¶ä»–é …ç›®', desc: 'è«‹åœ¨ä¸‹æ–¹è¼¸å…¥æ¡†èªªæ˜', highlight: false, icon: 'plus-circle' }
                                                    ];

                                                    const allServices = [...baseServices, ...extraServices, ...fixedServices];

return allServices.map((item) => (
                                                        <label key={item.id} className={`relative p-5 rounded-xl border-2 transition-all group ${
                                                            isCustomerMode ? 'cursor-default' : 'cursor-pointer' // ğŸ”’ é–å®šæ™‚æ»‘é¼ è®Šæ›´
                                                        } ${
                                                            formData.service_items.includes(item.id) 
                                                                ? (item.highlight ? 'border-soosi-wood bg-soosi-wood/10 shadow-lg' : 'border-soosi-green bg-soosi-green/5 shadow-md') 
                                                                : 'border-gray-200 bg-white'
                                                        } ${
                                                            isCustomerMode && !formData.service_items.includes(item.id) ? 'opacity-50 grayscale' : '' // ğŸ”’ æ²’é¸åˆ°çš„é …ç›®è®Šæ·¡
                                                        }`}>
                                                            <div className="flex items-start gap-3">
                                                                <div className={`mt-0.5 w-10 h-10 rounded-full flex items-center justify-center transition-colors ${
                                                                    formData.service_items.includes(item.id) 
                                                                        ? (item.highlight ? 'bg-soosi-wood text-white' : 'bg-soosi-green text-white') 
                                                                        : 'bg-gray-100 text-gray-400'
                                                                }`}>
                                                                    <Icon name={item.icon} size={20} className={formData.service_items.includes(item.id) ? "text-white" : ""} />
                                                                </div>
                                                                <div className="flex-1">
                                                                    <div className={`font-bold text-base mb-1 ${formData.service_items.includes(item.id) ? (item.highlight ? 'text-soosi-wood' : 'text-soosi-green') : 'text-soosi-dark'}`}>{item.title}</div>
                                                                    <div className={`text-xs leading-relaxed ${formData.service_items.includes(item.id) ? 'text-gray-600' : 'text-gray-400'}`}>{item.desc}</div>
                                                                </div>
                                                            </div>
                                                            {/* ğŸ”’ é—œéµä¿®æ”¹ï¼šåŠ å…¥ disabled å±¬æ€§ */}
                                                            <input 
                                                                type="checkbox" 
                                                                className="hidden" 
                                                                disabled={isCustomerMode} 
                                                                checked={formData.service_items.includes(item.id)} 
                                                                onChange={(e) => {
                                                                    if (isCustomerMode) return;
                                                                    if (e.target.checked) {
                                                                        setFormData(prev => ({ ...prev, service_items: [...prev.service_items, item.id] }));
                                                                    } else {
                                                                        setFormData(prev => ({ ...prev, service_items: prev.service_items.filter(id => id !== item.id) }));
                                                                    }
                                                                }}
                                                            />
                                                        </label>
                                                    ));
                                                })()}
                                            </div>

                                            {/* SPA å‡ç´šé …ç›®å€å¡Š */}
                                            <div className="bg-white rounded-xl border border-soosi-wood/10 p-4 space-y-3">
                                                <div className="flex items-center gap-2 border-b border-gray-100 pb-2">
                                                    <div className="bg-soosi-accent text-soosi-dark text-[10px] font-black px-2 py-0.5 rounded">HOT</div>
                                                    <h4 className="font-bold text-soosi-wood text-sm">å®¢è£½åŒ– SPA å‡ç´š</h4>
                                                </div>
                                                <div className="grid grid-cols-2 gap-2">
                                                    {[
                                                        { id: 'spa_dental', title: 'å£è…”å‡è† ', price: '$100UP' },
                                                        { id: 'spa_oil', title: 'æ½”è†šæ²¹(å±€éƒ¨)', price: '$100UP' },
{ id: 'spa_ceramide_local', title: 'å±€éƒ¨ä¿æ¿•', price: '$100UP' },
                                                        { id: 'spa_ceramide_full', title: 'å…¨èº«ä¿æ¿•', price: '$200UP' },
                                                        { id: 'spa_ear', title: 'æ—¥æœ¬æ¡è€³', price: '$150UP' },
                                                        { id: 'spa_carbon', title: 'æ—¥æœ¬ç¢³é…¸æµ´', price: '$300UP' },
                                                        { id: 'spa_bath', title: 'èˆ’æ•å…¥æµ´æ¹¯', price: '$300UP' },
                                                        { id: 'spa_nano', title: 'å¥ˆç±³æµ´SPA', price: '$300UP' },
                                                        { id: 'spa_salt', title: 'èˆ’å£“æµ·é¹½æµ´', price: '$300UP' },
                                                        { id: 'spa_mud_exfoliate', title: 'å»è§’è³ªæ³¥æµ´', price: '$600UP' },
                                                        { id: 'spa_bubble', title: 'ç²‰ç´…æ³¡æ³¡æµ´', price: '$300UP' },
                                                        { id: 'spa_volcano', title: 'æ‘©æ´›å“¥ç«å±±æ³¥', price: '$300UP' },
].map(spa => (
                                                        <label key={spa.id} className={`flex flex-col p-2 rounded-lg border transition-all ${
                                                            isCustomerMode ? 'cursor-default' : 'cursor-pointer' // ğŸ”’ é–å®šæ¸¸æ¨™
                                                        } ${
                                                            formData.service_items.includes(spa.id) 
                                                            ? 'bg-soosi-wood/5 border-soosi-wood' 
                                                            : 'bg-white border-gray-100'
                                                        } ${
                                                            isCustomerMode && !formData.service_items.includes(spa.id) ? 'opacity-40' : '' // ğŸ”’ æ²’é¸åˆ°çš„è®Šæ·¡
                                                        }`}>
                                                            <div className="flex justify-between items-start mb-1">
                                                                {/* ğŸ”’ é—œéµä¿®æ”¹ï¼šåŠ å…¥ disabled */}
                                                                <input 
                                                                    type="checkbox" 
                                                                    disabled={isCustomerMode}
                                                                    className="accent-soosi-wood w-3 h-3 mt-0.5" 
                                                                    checked={formData.service_items.includes(spa.id)}
                                                                    onChange={(e) => {
                                                                        if (isCustomerMode) return;
                                                                        toggleArray('service_items', spa.id);
                                                                    }}
                                                                />
                                                                <span className="text-[10px] font-bold text-soosi-wood bg-soosi-wood/10 px-1 py-0.5 rounded scale-90 origin-right">{spa.price}</span>
                                                            </div>
                                                            <span className={`text-[11px] font-bold ${formData.service_items.includes(spa.id) ? 'text-soosi-dark' : 'text-gray-500'}`}>{spa.title}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* å…¶ä»–é …ç›®è¼¸å…¥æ¡† */}
{formData.service_items.includes('other') && (
                                            <div className="mt-4 animate-in fade-in">
                                                <InputGroup label="è«‹è©³ç´°èªªæ˜å…¶ä»–é …ç›®" required error={errors.service_items_other} id="service_items_other">
                                                    <textarea 
                                                        value={formData.service_items_other || ''} 
                                                        disabled={isCustomerMode} // ğŸ”’ é–å®š
                                                        onChange={(e) => handleChange('service_items_other', e.target.value)}
                                                        placeholder="ä¾‹å¦‚ï¼šåªå‰ƒè…³åº•ã€åªå‰ªæŒ‡ç”²..."
                                                        className={`w-full cute-input px-4 py-3 resize-none ${isCustomerMode ? 'bg-gray-100 text-gray-500' : ''}`}
                                                        rows="3"
                                                    />
                                                </InputGroup>
                                            </div>
                                        )}
                                        </div>
                                    )}
                                </div>
                            </div>
                            )}

{/* â˜… é›†é»å¡ï¼šç¾å®¹æ¨¡å¼æ°¸é é¡¯ç¤ºï¼›ä½å®¿æ¨¡å¼åªæœ‰åœ¨ã€ŒåŠ è³¼æ´—æ¾¡ã€æ™‚æ‰é¡¯ç¤º â˜… */}
{loyaltyInfo && (!isBoarding || formData.addGrooming) && (
    <div className="mb-6">
        <LoyaltyProgressCard 
            info={loyaltyInfo} 
            formData={formData}        
            setFormData={setFormData}  
            isCustomerMode={isCustomerMode} 
        />
    </div>
)}

{/* æ–°å¢ï¼šæœ¬æ¬¡æœå‹™é‡‘é¡ (ç¨ç«‹å€å¡Šï¼Œæ°¸é é¡¯ç¤º) */}
                            <div className="cute-card p-6 space-y-4 border-2 border-soosi-wood/20">
                                <div className="flex items-center justify-between border-b border-soosi-wood/10 pb-2 mb-2">
                                    <h3 className="font-black text-lg text-soosi-wood flex items-center gap-2">
                                        <Icon name="wallet" size={20}/> æœ¬æ¬¡{formData.isDaycare ? 'å®‰è¦ª' : 'ä½å®¿'}é‡‘é¡
                                    </h3>
                                </div>
                                
                                <div className="bg-white p-5 rounded-xl border border-soosi-wood/10 shadow-sm space-y-4">
                                    {formData.isDaycare ? (
                                        <div className="flex flex-col gap-1 animate-in fade-in">
                                            <label className="text-xs font-bold text-gray-400">å®‰è¦ªæœå‹™å ±åƒ¹</label>
                                            <div className="flex items-center gap-2">
                                                <span className="font-black text-soosi-wood text-xl">$</span>
                                                <input 
                                                    type="number" 
                                                    disabled={isCustomerMode}
                                                    value={formData.estimated_price || ''} 
                                                    onChange={handleInputChange}
                                                    name="estimated_price"
                                                    placeholder="è«‹è¼¸å…¥ç¸½é¡" 
                                                    className="w-full cute-input px-3 py-3 text-2xl font-mono font-bold text-soosi-wood"
                                                />
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                    
{/* 1. ä½å®¿è²»è¼¸å…¥ (åŒä½) */}
                                    <div className="flex flex-col gap-1">
                                        <label className="text-xs font-bold text-gray-400">A. æ¯æ™šæˆ¿å‹å–®åƒ¹ (åŒä½)</label>
                                        <div className="flex items-center gap-2">
                                            <span className="font-black text-soosi-wood">$</span>
                                            <input 
                                                type="number" 
                                                disabled={isCustomerMode} // é–å®š
                                                value={formData.price_per_night || ''} 
                                                // ğŸŒŸ ä¿®æ”¹ï¼šä½¿ç”¨åŒæ­¥å‡½å¼ï¼Œæ”¹ä¸€éš»å…¨æ”¹
                                                onChange={(e) => handleSharedPriceChange('price_per_night', e.target.value)}
                                                placeholder="è¼¸å…¥æ¯æ™šé‡‘é¡" 
                                                className="w-full cute-input px-3 py-2 text-lg font-mono font-bold text-soosi-wood"
                                            />
                                        </div>
                                    </div>

                                    {/* 2. åœ‹å®šå‡æ—¥/ç‰¹æ®ŠåŠ åƒ¹ (å…±ç”¨) */}
                                    <div className="flex flex-col gap-1 animate-in fade-in">
                                        <label className="text-xs font-bold text-gray-400 flex items-center gap-1">
                                            B. åœ‹å®šå‡æ—¥/ç‰¹æ®ŠåŠ åƒ¹ <span className="text-[10px] text-red-400">(ä¸åˆ—å…¥æŠ˜æ‰£)</span>
                                        </label>
                                        <div className="flex items-center gap-2">
                                            <span className="font-black text-soosi-red">$</span>
                                            <input 
                                                type="number" 
                                                disabled={isCustomerMode} // é–å®š
                                                value={formData.holiday_surcharge || ''} 
                                                // ğŸŒŸ ä¿®æ”¹ï¼šä½¿ç”¨åŒæ­¥å‡½å¼
                                                onChange={(e) => handleSharedPriceChange('holiday_surcharge', e.target.value)}
                                                placeholder="ä¾‹å¦‚: 100 (ç„¡å‰‡ç•™ç©º)" 
                                                className="w-full cute-input px-3 py-2 text-lg font-mono font-bold text-soosi-red border-red-200 focus:bg-red-50"
                                            />
                                        </div>
                                    </div>

                                    {/* 3. ç¾å®¹è²»è¼¸å…¥ (è‡ªå‹•åˆ—å‡ºæ‰€æœ‰éœ€è¦ç¾å®¹çš„æ¯›å­©ï¼Œä¸éœ€åˆ‡æ› Tab) */}
                                    {allPetsCurrentState.map((pet, idx) => {
                                        if (pet.addGrooming) {
                                            return (
                                                <div key={idx} className="flex flex-col gap-1 animate-in fade-in slide-in-from-top-2 border-t border-dashed border-gray-200 pt-2 mt-2">
                                                    <label className="text-xs font-bold text-gray-400">C. ç¾å®¹/SPA è²»ç”¨ ({pet.pet_name || `å¯µç‰©${idx+1}`})</label>
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-black text-soosi-green">$</span>
                                                        <input 
                                                            type="number" 
                                                            disabled={isCustomerMode} 
                                                            value={pet.boarding_grooming_price || ''} 
                                                            onChange={(e) => {
                                                                const val = e.target.value;
                                                                // å¦‚æœæ˜¯ç•¶å‰ç·¨è¼¯çš„å¯µç‰©ï¼Œæ›´æ–° formData
                                                                if (idx === currentPetIdx) {
                                                                    setFormData(p => ({ ...p, boarding_grooming_price: val }));
                                                                } else {
                                                                    // å¦‚æœæ˜¯åˆ—è¡¨ä¸­çš„å…¶ä»–å¯µç‰©ï¼Œæ›´æ–° petList
                                                                    setPetList(prev => {
                                                                        const newList = [...prev];
                                                                        newList[idx] = { ...newList[idx], boarding_grooming_price: val };
                                                                        return newList;
                                                                    });
                                                                }
                                                            }}
                                                            placeholder={`è¼¸å…¥ ${pet.pet_name || 'ç¾å®¹'} é‡‘é¡`} 
                                                            className="w-full cute-input px-3 py-2 text-lg font-mono font-bold text-soosi-green border-soosi-green/30 focus:bg-soosi-green/5"
                                                        />
                                                    </div>
                                                </div>
                                            );
                                        }
                                        return null;
                                    })}
                                    {/* 4. è¨ˆç®—éç¨‹é¡¯ç¤º (ğŸŒŸ ä¿®æ”¹ç‰ˆï¼šåˆ—å‡ºæ‰€æœ‰å¯µç‰©çš„ç¾å®¹è²») */}
                                    {stayDuration && formData.price_per_night && (
                                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-100 space-y-2 text-xs animate-in fade-in">
                                            {/* A. ä½å®¿ç´°é … (åªç®—ä¸€æ¬¡) */}
                                            <div className="flex justify-between">
                                                <span>ğŸ  ä½å®¿è²»ç”¨ ({stayDuration} æ™š)</span>
                                                <span className="font-bold">${parseInt(formData.price_per_night) * stayDuration}</span>
                                            </div>
                                            
                                            {/* é•·ä½æŠ˜æ‰£ */}
                                            {stayDuration >= 6 && (
                                                <div className="flex justify-between text-soosi-green">
                                                    <span className="flex items-center gap-1">
                                                        <Icon name="gift" size={12}/> 
                                                        {stayDuration >= 15 ? 'é•·ä½å„ªæƒ  (15æ™šä»¥ä¸Š 85æŠ˜)' : 'é•·ä½å„ªæƒ  (6æ™šä»¥ä¸Š 95æŠ˜)'}
                                                    </span>
                                                    <span className="font-bold">
                                                        {stayDuration >= 15 ? '-15%' : '-5%'}
                                                    </span>
                                                </div>
                                            )}

                                            {/* B. å‡æ—¥åŠ åƒ¹ */}
                                            {formData.holiday_surcharge && (
                                                <div className="flex justify-between text-soosi-red">
                                                    <span>+ åœ‹å®šå‡æ—¥/åŠ åƒ¹</span>
                                                    <span className="font-bold">${formData.holiday_surcharge}</span>
                                                </div>
                                            )}

                                            <div className="border-t border-dashed border-gray-200 my-2"></div>

                                            {/* C. ğŸŒŸ å‹•æ…‹åˆ—å‡ºæ¯ä¸€éš»å¯µç‰©çš„ç¾å®¹è²»ç”¨ */}
                                            {allPetsCurrentState.map((pet, idx) => {
                                                if (pet.addGrooming && pet.boarding_grooming_price) {
                                                    return (
                                                        <div key={idx} className="space-y-1">
                                                            <div className="flex justify-between text-soosi-green font-bold">
                                                                <span className="flex items-center gap-1">
                                                                    <Icon name="scissors" size={12}/> 
                                                                    {pet.pet_name || `å¯µç‰©${idx+1}`} ç¾å®¹/SPA
                                                                </span>
                                                                <span>+ ${pet.boarding_grooming_price}</span>
                                                            </div>
                                                            {/* è©²å¯µç‰©çš„å„ªæƒ æŠ˜æŠµ */}
                                                            {pet.usePromo50 && (
                                                                <div className="flex justify-between text-soosi-red pl-4 text-[10px]">
                                                                    <span className="flex items-center gap-1">
                                                                        <Icon name="sparkles" size={10}/> 50å¤©å›è¨ªå„ªæƒ 
                                                                    </span>
                                                                    <span>- $200</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                }
                                                return null;
                                            })}
                                            
                                            <div className="border-t border-gray-300 my-2"></div>
                                            
{/* ç¸½é‡‘é¡è¨ˆç®— (å·²å„ªåŒ–ï¼šç›´æ¥ä½¿ç”¨è¨ˆç®—å¥½çš„è®Šæ•¸) */}
                                            <div className="flex justify-between items-center">
                                                <span className="font-bold text-soosi-dark text-sm">ç¸½é‡‘é¡ (å«ç¨…)</span>
                                                <span className="text-2xl font-black text-soosi-wood">
                                                    ${calculatedTotalPrice}
                                                </span>
                                            </div>

                                            {/* Hidden Input: ç¢ºä¿æäº¤çµ¦å¾Œç«¯çš„é‡‘é¡èˆ‡é¡¯ç¤ºçš„ä¸€è‡´ */}
                                            <input type="hidden" name="estimated_price" value={calculatedTotalPrice} />
                                        </div>
                                    )}
                                    </>
                                    )}

                                    {/* å‚™è¨»èˆ‡æ³¨æ„äº‹é … */}
                                    <div className="w-full space-y-2 pt-2">
                                        <div className="text-[11px] text-soosi-wood font-bold leading-snug bg-soosi-wood/5 p-3 rounded-lg border border-soosi-wood/10 flex items-start gap-2">
                                            <Icon name="info" size={14} className="mt-0.5 shrink-0" />
                                            <span>å‚™è¨»ï¼šæ­¤é‡‘é¡ç‚ºåŸºç¤å ±åƒ¹ï¼Œè‹¥ç¾å®¹æ™‚æœ‰åš´é‡æ‰“çµã€è·³èš¤ã€æ”»æ“Šè¡Œç‚ºç­‰...ï¼Œå°‡å¦åŠ æ”¶è™•ç†è²»ã€‚</span>
                                        </div>
                                        <div className="text-[11px] text-soosi-red font-bold leading-snug bg-red-50 p-3 rounded-lg border border-red-100 flex items-start gap-2">
                                            <Icon name="alert-triangle" size={14} className="mt-0.5 shrink-0" />
                                            <span>æ³¨æ„ï¼šæœ¬åº—ä¸æ¥æœ‰å¯„ç”ŸèŸ²ã€å‚³æŸ“ç–¾ç—…ã€é»´èŒä¹‹é¡çš„æ¯›å­©ã€‚è‹¥éç¨‹ä¸­ç™¼ç¾ï¼Œå°‡é¡å¤–æ”¶å–ç’°å¢ƒæ¸…æ½”è²» $1000ã€‚</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Legal & Signature */}
                        <section className="cute-card p-8 space-y-8">
                            <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <span className="text-2xl">ğŸ“</span>
                                <h3 className="text-lg font-black text-soosi-dark">æ³•å¾‹æ¢æ¬¾èˆ‡æ•¸ä½ç°½ç½²</h3>
                            </div>

                            {/* ä¹™æ–¹è³‡è¨Š */}
{/* ä¹™æ–¹è³‡è¨Š */}
                            <div className="bg-[#F9F7F2] p-5 rounded-2xl border border-soosi-wood/10 text-xs text-soosi-wood space-y-2">
                                <h4 className="font-bold border-b border-soosi-wood/10 pb-2 mb-2">ä¹™æ–¹ï¼ˆåº—å®¶ï¼‰è³‡è¨Š</h4>
                                <div className="grid grid-cols-2 gap-2">
                                    <div><span className="opacity-60 block">åº—å®¶åç¨±</span><span className="font-bold">å®¿æ´—å¯µç‰©å·¥ä½œå®¤</span></div>
                                    <div><span className="opacity-60 block">è² è²¬äºº</span><span className="font-bold">æå®¥å„€</span></div>
                                    <div><span className="opacity-60 block">ç‰¹å¯µæ¥­å­—è™Ÿ</span><span className="font-bold">S1140030è™Ÿ</span></div>
                                    <div><span className="opacity-60 block">è¯çµ¡é›»è©±</span><span className="font-bold">0981-775-553</span></div>
                                    <div><span className="opacity-60 block">ç‡Ÿæ¥­æ™‚é–“</span><span className="font-bold">10:00-20:00</span></div>
                                    <div className="col-span-2"><span className="opacity-60 block">ç‡Ÿæ¥­åœ°å€</span><span className="font-bold">å°ä¸­å¸‚æ¸…æ°´å€æ–°èˆˆè·¯142-1è™Ÿ</span></div>
                                </div>
                            </div>
{/* ğŸŒŸ æ–°å¢ï¼šå½±åƒä½¿ç”¨æˆæ¬Š */}
<div id="image_auth" className={`cute-card p-5 border-2 bg-white transition-all ${errors.image_auth ? 'border-red-400 bg-red-50 ring-4 ring-red-50' : 'border-soosi-wood/20'}`}>
    <label className="text-sm font-bold text-soosi-dark flex items-start gap-2 mb-3">
        <Icon name="camera" size={18} className="text-soosi-wood mt-0.5"/>
        <div>
å½±åƒä½¿ç”¨æˆæ¬Š <span className="text-red-500">*</span>
            <p className="text-[10px] text-gray-400 font-normal mt-1">
                æ˜¯å¦åŒæ„å°‡æ¯›å­©ç…§ç‰‡/å½±ç‰‡ä¸Šå‚³è‡³ç¤¾ç¾¤ç¶²ç«™(FB/IG)ä¸¦æ¨™è¨˜åå­—ï¼Ÿ
            </p>
        </div>
    </label>
    <div className="flex gap-3">
        <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.image_auth === 'agree' ? 'bg-soosi-green text-white border-soosi-green shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
            <input type="radio" name="image_auth" value="agree" checked={formData.image_auth === 'agree'} onChange={() => handleChange('image_auth', 'agree')} className="hidden" />
            <Icon name="check" size={16}/> <span className="font-bold">åŒæ„</span>
        </label>
        <label className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.image_auth === 'disagree' ? 'bg-gray-500 text-white border-gray-500 shadow-md' : 'bg-white border-gray-200 text-gray-400 hover:bg-gray-50'}`}>
            <input type="radio" name="image_auth" value="disagree" checked={formData.image_auth === 'disagree'} onChange={() => handleChange('image_auth', 'disagree')} className="hidden" />
            <Icon name="x" size={16}/> <span className="font-bold">ä¸åŒæ„</span>
        </label>
    </div>
    {errors.image_auth && <div className="field-error mt-2"><Icon name="alert-circle" size={12}/>{errors.image_auth}</div>}
</div>
                            {/* æ¢æ¬¾æŒ‰éˆ•å€å¡Š */}
<div className="space-y-4">
{/* 1. ç¾å®¹æ¢æ¬¾ (ä¿®æ”¹ï¼šä½å®¿ä¸”æ²’åŠ è³¼ç¾å®¹æ™‚éš±è—) */}
                                {(!isBoarding || (isBoarding && hasAnyGrooming)) && (
                                    <button type="button" onClick={() => setActiveModal('grooming')}
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all ${termsRead.grooming ? 'bg-soosi-green/10 border-soosi-green' : 'bg-white border-soosi-green/30 hover:border-soosi-green'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.grooming ? 'bg-soosi-green text-white' : 'bg-[#E8F1EB] text-soosi-green'}`}><Icon name={termsRead.grooming ? "check" : "scissors"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm text-soosi-dark`}>ã€çŠ¬ã€è²“ç¾å®¹å¥‘ç´„æ¢æ¬¾ã€‘</div>
                                                {!termsRead.grooming && <div className="text-xs text-gray-400">é»æ“Šé–±è®€</div>}
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.grooming ? 'bg-soosi-green text-white' : 'bg-gray-100 text-gray-400'}`}>{termsRead.grooming ? 'å·²å®Œæˆ' : 'å¾…é–±è®€'}</div>
                                    </button>
                                )}

                                {/* 2. ä½å®¿æ¢æ¬¾ (åƒ…ä½å®¿é¡¯ç¤º) */}
                                {isBoarding && (
                                    <button type="button" onClick={() => setActiveModal('boarding')} 
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all animate-in fade-in ${termsRead.boarding ? 'bg-soosi-wood/10 border-soosi-wood' : 'bg-white border-soosi-wood/30 hover:border-soosi-wood'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.boarding ? 'bg-soosi-wood text-white' : 'bg-[#F5EFE9] text-soosi-wood'}`}><Icon name={termsRead.boarding ? "check" : "home"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm text-soosi-dark`}>ã€çŠ¬ã€è²“ä½å®¿å¥‘ç´„æ¢æ¬¾ã€‘</div>
                                                {!termsRead.boarding && <div className="text-xs text-gray-400">é»æ“Šé–±è®€</div>}
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.boarding ? 'bg-soosi-wood text-white' : 'bg-gray-100 text-gray-400'}`}>{termsRead.boarding ? 'å·²å®Œæˆ' : 'å¾…é–±è®€'}</div>
                                    </button>
                                )}

                                {/* 3. é«˜é¢¨éšªç¾å®¹ (è‹¥ç¬¦åˆé¢¨éšªï¼Œç„¡è«–ç¾å®¹æˆ–ä½å®¿éƒ½é¡¯ç¤º) */}
                                {isHighRisk && (
                                    <button type="button" onClick={() => setActiveModal('highRiskGrooming')} 
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all animate-in fade-in ${termsRead.highRiskGrooming ? 'bg-soosi-green/10 border-soosi-green' : 'bg-white border-red-200 hover:border-red-400'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.highRiskGrooming ? 'bg-soosi-green text-white' : 'bg-red-50 text-red-500'}`}><Icon name={termsRead.highRiskGrooming ? "check" : "alert-triangle"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm ${termsRead.highRiskGrooming ? 'text-soosi-green' : 'text-red-600'}`}>ã€é«˜é¢¨éšªã€‘ç¾å®¹æœå‹™é¢¨éšªå‘ŠçŸ¥</div>
                                                <div className="text-xs text-gray-400 font-bold">
                                                    {riskType === 'senior' ? 'æª¢æ¸¬åˆ°æ¯›å­©å·²æ»¿ 8 æ­²' : riskType === 'puppy' ? 'æª¢æ¸¬åˆ°æ¯›å­©æœªæ»¿ 5 å€‹æœˆ' : 'æª¢æ¸¬åˆ°æ¯›å­©æœ‰éå¾€ç—…å²'}ï¼Œè«‹å‹™å¿…è©³é–±
                                                </div>
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.highRiskGrooming ? 'bg-soosi-green text-white' : 'bg-red-100 text-red-600'}`}>{termsRead.highRiskGrooming ? 'å·²åŒæ„' : 'å‹™å¿…è©³é–±'}</div>
                                    </button>
                                )}

                                {/* 4. é«˜é¢¨éšªä½å®¿ (åƒ…ä½å®¿ + ç¬¦åˆé¢¨éšªé¡¯ç¤º) */}
                                {isBoarding && isHighRisk && (
                                    <button type="button" onClick={() => setActiveModal('highRiskBoarding')} 
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all animate-in fade-in ${termsRead.highRiskBoarding ? 'bg-soosi-wood/10 border-soosi-wood' : 'bg-white border-red-200 hover:border-red-400'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.highRiskBoarding ? 'bg-soosi-wood text-white' : 'bg-red-50 text-red-500'}`}><Icon name={termsRead.highRiskBoarding ? "check" : "alert-triangle"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm ${termsRead.highRiskBoarding ? 'text-soosi-wood' : 'text-red-600'}`}>ã€é«˜é¢¨éšªã€‘ä½å®¿æœå‹™é¢¨éšªå‘ŠçŸ¥</div>
                                                <div className="text-xs text-gray-400 font-bold">
                                                    é‡å°é«˜é½¡ã€å¹¼é½¡æˆ–ç—…å²å¯µç‰©ä¹‹ä½å®¿ç‰¹åˆ¥ç´„å®š
                                                </div>
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.highRiskBoarding ? 'bg-soosi-wood text-white' : 'bg-red-100 text-red-600'}`}>{termsRead.highRiskBoarding ? 'å·²åŒæ„' : 'å‹™å¿…è©³é–±'}</div>
                                    </button>
                                )}

{/* ç§»é™¤æ‰‹å‹•å‹¾é¸æ¡†ï¼Œç›´æ¥ç”±æ¢æ¬¾é–±è®€ç‹€æ…‹æ§åˆ¶ç°½åæ¿è§£é– */}
                        </div>

{/* Signature - ä¾è³´æ¢æ¬¾é–±è®€ç‹€æ…‹ (allTermsRead) */}
                        <div className="space-y-3" id="signature">
                            <div className="flex justify-between items-center">
                                <label className="text-sm font-bold text-soosi-wood flex items-center gap-2"><Icon name="pen-tool" size={16}/> æ•¸ä½ç°½å</label>
                                {realtimeSig && <button onClick={()=>setRealtimeSig(null)} className="text-xs text-red-400 font-bold flex items-center gap-1 bg-red-50 px-2 py-1 rounded-full"><Icon name="trash-2" size={12}/> é‡ç°½</button>}
                            </div>
                            
                            {realtimeSig ? (
                                <div className="space-y-3 animate-in fade-in">
                                    <div className="bg-white rounded-2xl border-2 border-soosi-wood/20 p-6 flex justify-center items-center min-h-[180px] shadow-inner relative overflow-hidden">
                                        <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#8E6E53_1px,transparent_1px)] [background-size:12px_12px]"></div>
                                        <img src={realtimeSig} alt="æ‚¨çš„ç°½å" className="max-h-[150px] object-contain relative z-10" />
                                    </div>
                                    <div className="flex items-center justify-end gap-3">
                                        <div className="bg-soosi-green/10 text-soosi-green px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 shadow-sm border border-soosi-green/20">
                                            <Icon name="check-circle" size={14}/> å·²ç°½ç½²
                                        </div>
                                        <div className="text-xs text-gray-400 font-bold">
                                            ç°½ç½²æ™‚é–“ï¼š{new Date().toLocaleString('zh-TW', { hour12: false, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <button onClick={() => { if(allTermsRead) setShowFullSig(true); else alert('è«‹å…ˆå®Œæˆä¸Šæ–¹æ‰€æœ‰å¥‘ç´„æ¢æ¬¾é–±è®€'); }} 
                                    className={`w-full h-36 border-2 border-dashed rounded-2xl flex flex-col items-center justify-center gap-3 transition-all group ${allTermsRead ? 'border-soosi-green bg-white hover:bg-soosi-green/5 cursor-pointer' : 'border-gray-200 bg-gray-50 cursor-not-allowed opacity-70'}`}>
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center transition-all ${allTermsRead ? 'bg-soosi-green text-white group-hover:scale-110 shadow-md' : 'bg-gray-200 text-gray-400'}`}>
                                        <Icon name={allTermsRead ? "pen-tool" : "lock"} size={20}/>
                                    </div>
                                    <div className="text-center">
                                        <div className={`text-sm font-bold ${allTermsRead ? 'text-soosi-dark' : 'text-gray-400'}`}>{allTermsRead ? "é»æ“Šæ­¤è™•é–‹å§‹ç°½å" : "è«‹å…ˆå®Œæˆä¸Šæ–¹æ¢æ¬¾é–±è®€"}</div>
                                        <div className="text-xs text-gray-400 mt-1">{allTermsRead ? "é–‹å•Ÿå…¨è¢å¹•æ‰‹å¯«æ¿" : "é–±è®€ä¸¦åŒæ„å¾Œè§£é–"}</div>
                                    </div>
                                </button>
                            )}
                            {errors.signature && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.signature}</div>}
                        </div>

{/* æäº¤æŒ‰éˆ• */}
<button onClick={handleSubmit} disabled={isSubmitting || !realtimeSig} className="w-full py-5 bg-gradient-to-r from-soosi-green to-[#5a7a63] text-white rounded-[2rem] font-black text-lg shadow-lg shadow-soosi-green/20 hover:shadow-xl hover:-translate-y-1 active:scale-[0.98] transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:transform-none">
    {isSubmitting ? <Icon name="loader-2" className="animate-spin"/> : <Icon name="send" size={20} />}
    {isSubmitting ? 'æäº¤ä¸­...' : 'ç¢ºèªä¸¦æäº¤æ•¸ä½å¥‘ç´„'}
</button>

                        {/* åº—å®¶ç®¡ç†å·¥å…·ï¼šç”¢ç”Ÿé€£çµ (åƒ…éå®¢äººæ¨¡å¼é¡¯ç¤º) */}
                        {!isCustomerMode && (
                            <div className="pt-6 border-t border-gray-200 mt-6 animate-in fade-in duration-700">
                                <button 
onClick={handleRequestLink}
                                    className="w-full py-3 bg-white border-2 border-soosi-green text-soosi-green rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-soosi-green/5 transition-all active:scale-95"
                                >
                                    <Icon name="link" size={18}/> ç”¢ç”Ÿé–å®šé‡‘é¡é€£çµ (å‚³çµ¦å®¢äºº)
                                </button>
                                <p className="text-center text-[10px] text-gray-400 mt-2 font-medium">
                                    ğŸ’¡ åº—å®¶å°æé†’ï¼šå…ˆå¡«å¥½æ—¥æœŸèˆ‡é‡‘é¡å¾Œé»æ“Šæ­¤è™•ï¼Œå¯ç”¢ç”Ÿå°ˆå±¬é€£çµç™¼é€çµ¦å®¢äººã€‚
                                </p>
                            </div>
                        )}
                        </section>
                    </main>
                    {showHistoryModal && (
                        <HistoryModal 
                            records={historyRecords} 
                            onClose={() => setShowHistoryModal(false)} 
                            onSelect={handleApplyHistory} 
                        />
                    )}

<PasswordModal isOpen={showPwdModal} onClose={() => setShowPwdModal(false)} onConfirm={onPasswordVerified} />
    <DiscountModal 
                        isOpen={showDiscountModal} 
                        message={discountMessage} 
                        onClose={() => setShowDiscountModal(false)} 
                    />
                    {/* Fullscreen Signature Modal */}
                    {showFullSig && (
                        <div className="fullscreen-signature flex flex-col animate-in fade-in duration-200">
                            <div className="bg-soosi-wood text-white p-4 flex justify-between items-center shadow-md shrink-0">
                                <div className="font-bold flex items-center gap-2"><Icon name="pen-tool"/> è«‹ç°½å</div>
                                <button onClick={()=>setShowFullSig(false)}><Icon name="x"/></button>
                            </div>
                            <div className="flex-1 bg-[#F9F7F2] relative touch-none cursor-crosshair overflow-hidden">
                                <canvas ref={sigCanvasRef} className="w-full h-full block"></canvas>
                            </div>
                            <div className="p-4 bg-white border-t flex gap-3 safe-area-bottom shrink-0">
                                <button onClick={()=>{padInstance.current?.clear()}} className="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-bold">é‡å¯«</button>
                                <button onClick={()=>{
                                    if(!padInstance.current?.isEmpty()) {
                                        setRealtimeSig(padInstance.current.toDataURL());
                                        setShowFullSig(false);
                                        if(errors.signature) setErrors(p=>({...p, signature:null}));
                                    } else alert("è«‹å…ˆç°½å");
                                }} className="flex-[2] py-3 bg-soosi-green text-white rounded-xl font-bold shadow-lg">ç¢ºèªç°½å</button>
                            </div>
                        </div>
                    )}

                    {/* Terms Modals */}
<TermsModal isOpen={activeModal === 'grooming'} onClose={()=>setActiveModal(null)} title="ç¾å®¹æœå‹™å¥‘ç´„æ¢æ¬¾" onAgree={()=>setTermsRead(p=>({...p, grooming:true}))}>
                        <div className="space-y-6 text-sm text-soosi-dark leading-relaxed">
                            {/* Intro */}
                            <div className="bg-soosi-green/10 p-4 rounded-xl border border-soosi-green/20">
                                <h4 className="font-black text-soosi-green mb-2 text-base">ç¾å®¹æœå‹™åŒæ„æ›¸</h4>
                                <p className="text-xs font-bold text-soosi-dark/80">ç‚ºä¿éšœå¯µç‰©å®‰å…¨åŠæœå‹™å“è³ªï¼Œé ç´„å‰è«‹è©³é–±ã€‚ç•¶æ‚¨é ç´„ï¼Œå³è¦–ç‚ºå·²å……åˆ†äº†è§£ä¸¦åŒæ„éµå®ˆä»¥ä¸‹æ‰€æœ‰è¦å®šã€‚</p>
                            </div>

                            {/* ä¸€ã€å…±é€šæ¢æ¬¾ */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">ä¸€ã€å…±é€šæ¢æ¬¾</h5>
                                <ul className="list-decimal pl-5 space-y-2 marker:text-soosi-wood marker:font-bold">
                                    <li><span className="font-bold">æœå‹™å…¬ç´„èˆ‡ä»˜æ¬¾ï¼š</span>é£¼ä¸»åŒæ„éµå®ˆæœ¬å·¥ä½œå®¤ä¹‹å…¬ç´„ã€è¨ˆè²»æ–¹å¼åŠç›¸é—œè¦å‰‡ï¼Œä¸¦å¦‚å¯¦ä»˜æ¬¾ã€‚</li>
                                    <li><span className="font-bold">è¯çµ¡è³‡æ–™æ­£ç¢ºæ€§ï¼š</span>ç¢ºä¿æœå‹™æœŸé–“ï¼ˆ10:00-20:00ï¼‰è¯ç¹«æš¢é€šã€‚å› è³‡è¨ŠéŒ¯èª¤é€ æˆä¹‹æå¤±ç”±é£¼ä¸»è² è²¬ã€‚</li>
                                    <li><span className="font-bold text-soosi-red">å¥åº·ç‹€æ³èª å¯¦ç”³å ±ï¼š</span>å‹™å¿…å‘ŠçŸ¥ç‰¹æ®Šç—…å²ã€éæ•ã€è¿‘æœŸæ‰‹è¡“æˆ–æ”»æ“Šæ€§ã€‚å› éš±çé€ æˆä¹‹æå®³ï¼Œé£¼ä¸»é ˆè² å…¨è²¬ã€‚</li>
                                    <li><span className="font-bold">æ½›åœ¨é¢¨éšªèªçŸ¥ï¼š</span>æœå‹™æœŸé–“æˆ–è¿”å®¶ä¸ƒæ—¥å…§ç™¼ç”Ÿä¹‹ç–¾ç—…ï¼Œæœ¬å·¥ä½œå®¤ä¸è² ç›¸é—œè²¬ä»»ã€‚</li>
                                    <li><span className="font-bold">å°±è¨ºé†«é™¢è³‡è¨Šï¼š</span>è«‹æä¾›å¯µç‰©å›ºå®šå°±è¨ºé†«é™¢ä»¥åˆ©å¿…è¦æ™‚æŸ¥è©¢ç—…æ­·ã€‚</li>
                                    <li><span className="font-bold">æœå‹™æ‹’çµ•æ¬Šåˆ©ï¼š</span>è‹¥æ‚£æœ‰å‚³æŸ“ç—…ã€åš´é‡æ”»æ“Šæ€§æˆ–éœ€ç‰¹æ®Šç…§è­·æœªå‘ŠçŸ¥ï¼Œä¿æœ‰æ‹’çµ•æœå‹™æ¬Šåˆ©ã€‚</li>
                                    <li><span className="font-bold">è³‡æ–™è®Šæ›´é€šçŸ¥ï¼š</span>è³‡æ–™è®Šæ›´å¾Œä¸‰æ—¥å…§éœ€ä¸»å‹•ä»¥LINEé€šçŸ¥ã€‚</li>
                                </ul>
                            </div>

                            {/* äºŒã€æœå‹™é …ç›®èˆ‡æ”¶è²» */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">äºŒã€æœå‹™é …ç›®èˆ‡æ”¶è²»</h5>
                                <div className="space-y-3">
                                    <p>1. æ”¶è²»ä¾é«”å‹æ¯›é‡ç¾å ´å ±åƒ¹ã€‚è‹¥ç™¼ç¾è·³èš¤å£è¨ï¼Œå°‡æ”¶å–ç’°å¢ƒæ¸…æ½”è²» <span className="text-soosi-red font-black">$1,000</span>ã€‚æ‰“çµèˆ‡å»¢æ¯›è™•ç†è²»å¦è¨ˆï¼ˆæ‹†çµ <span className="font-bold">$200èµ·</span>ã€å»¢æ¯› <span className="font-bold">$100èµ·</span>ï¼‰ã€‚</p>
                                    <p>2. ç¾å®¹æœå‹™å®Œæˆå¾Œæ•ä¸æ¥å—ç•°è­°ã€é€€æ¬¾ï¼Œè²»ç”¨é ˆæ–¼ç•¶æ—¥æ”¯ä»˜å®Œæˆã€‚</p>
                                    <p>3. è‹¥éç¨‹æƒ…ç·’éæ–¼ç·Šå¼µæˆ–æœ‰æ”»æ“Šè¡Œç‚ºï¼Œå°‡ç«‹å³çµ‚æ­¢æœå‹™ä¸”ä¸äºˆæ”¶è²»ã€‚</p>
                                    <p>4. è‹¥éœ€é¡å¤–å”åŠ©å®‰æ’«ï¼Œå°‡é…Œæ”¶æƒ…ç·’ç®¡ç†è²» <span className="font-bold">$300-$500</span>ã€‚</p>
                                    
                                    <div className="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                        <p className="font-bold text-soosi-wood mb-1">5. é€¾æ™‚å®‰è¦ªè²» (é€šçŸ¥å¾Œ2å°æ™‚æœªæ¥å›)ï¼š</p>
                                        <ul className="list-disc pl-4 text-xs space-y-1 text-gray-600">
                                            <li>å°å‹çŠ¬ï¼š$90/æ™‚</li>
                                            <li>ä¸­å‹çŠ¬ï¼š$100/æ™‚</li>
                                            <li>å¤§å‹çŠ¬ï¼š$120/æ™‚</li>
                                            <li>è²“å’ªï¼š$90/æ™‚</li>
                                        </ul>
                                    </div>

                                    <div className="bg-soosi-accent/10 border border-soosi-accent/30 p-4 rounded-xl space-y-2 relative overflow-hidden">
                                        <div className="absolute top-0 right-0 bg-soosi-accent text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg">å„ªæƒ æ–¹æ¡ˆ</div>
                                        <p className="font-black text-soosi-wood">â˜… äº”æ¬¡ç¾å®¹é€£çºŒå›è¨ªå„ªæƒ æ–¹æ¡ˆ</p>
                                        <ul className="list-disc pl-4 text-xs space-y-1 text-soosi-dark/90">
                                            <li><span className="font-bold">æ¢ä»¶ï¼š</span>é¦–æ¬¡èµ· 35æ—¥å…§ å®Œæˆç¬¬1è‡³4æ¬¡ç¾å®¹ã€‚</li>
                                            <li><span className="font-bold">æŠ˜æ‰£ï¼š</span>ç¬¬4æ¬¡å¾Œ 15æ—¥å…§ å›è¨ªç¬¬5æ¬¡ï¼Œäº« <span className="font-bold text-soosi-red">$200 æŠ˜æŠµ</span>ã€‚</li>
                                            <li>åƒ…é™åŒä¸€æ¯›å­©ï¼Œä¸å¾—è½‰è®“ã€æ‹†åˆ†æˆ–å…Œç¾ã€‚é€¾æœŸè¦–åŒæ”¾æ£„ã€‚</li>
                                            <li>è‹¥æ¯›å­©å¥åº·ç‹€æ³ä¸é©åˆç¹¼çºŒç¾å®¹ï¼Œé›™æ–¹å¾—å¦è¡Œå”è­°ã€‚</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            {/* ä¸‰ã€å¥åº·èˆ‡æ¥å¾…è¦å®š */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">ä¸‰ã€å¥åº·èˆ‡æ¥å¾…è¦å®š</h5>
                                <div className="space-y-3">
                                    <div className="bg-red-50 p-3 rounded-lg border border-red-100 text-soosi-red text-xs font-bold space-y-2">
                                        <div className="flex items-center gap-2 text-sm"><Icon name="x-circle" size={16}/> <span>æˆ‘å€‘ç„¡æ³•æ¥å¾…ï¼š</span></div>
                                        <ul className="list-disc pl-5 space-y-1 text-soosi-dark">
                                            <li>æœªæ»¿3å€‹æœˆã€æœªæ‰“å®Œä¸‰åŠ‘ç–«è‹—ã€æ¥ç¨®ç–«è‹—ä¸€å‘¨å…§ä¹‹å¹¼çŠ¬è²“ã€‚</li>
                                            <li>èº«ä¸Šæœ‰æ´»é«”å¯„ç”ŸèŸ²ã€‚</li>
                                            <li>æ‚£æœ‰å¿ƒè‡Ÿç—…ã€ç™²ç™‡ã€å‚³æŸ“ç—…ï¼ˆè²“ç˜Ÿ/FIV/FeLV/é»´èŒç­‰ï¼‰ã€åš´é‡å‘¼å¸é“æˆ–è…è‡Ÿç–¾ç—…ã€‚</li>
                                        </ul>
                                    </div>
                                    <p className="text-xs">2. è‹¥ç¾å ´ç™¼ç¾ä¸Šè¿°ç‹€æ³ï¼ˆå¦‚å¯„ç”ŸèŸ²ã€æ‰“å™´åšã€é»´èŒï¼‰ï¼Œå°‡é€€å›ä¸¦æ”¶å–ç’°å¢ƒæ¸…æ½”è²» <span className="text-soosi-red font-bold">$1,000</span>ã€‚</p>
                                    <p className="text-xs">3. è‹¥æ•…æ„éš±çæ”»æ“Šè¡Œç‚ºå°è‡´äººå“¡å—å‚·ï¼Œé£¼ä¸»é ˆè² è²¬ç›¸é—œé†«ç™‚è²»ç”¨ã€‚</p>
                                </div>
                            </div>

                            {/* å››ã€å…¶ä»–æ¢æ¬¾ (åŸä¸‰) */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">å››ã€å…¶ä»–æ¢æ¬¾</h5>
                                <ul className="list-decimal pl-5 space-y-2">
                                    <li><span className="font-bold">è¼•å¾®å—å‚·è™•ç½®ï¼š</span>å› ä¸å¯æŠ—åŠ›å°è‡´å°æ–¼1å…¬åˆ†ä¹‹æ·ºè¡¨å‚·å£ï¼Œå·¥ä½œå®¤å°‡æ¶ˆæ¯’æ¸…æ½”ã€‚é£¼ä¸»å›å¾Œ24å°æ™‚å…§ç„¡ç•°è­°è¦–åŒæ¥å—ã€‚</li>
                                    <li className="bg-gray-50 p-3 rounded-lg -ml-2">
                                        <span className="font-bold block mb-1">æ„å¤–äº‹æ•…èˆ‡è³ å„Ÿæ¨™æº–ï¼š</span>
                                        <span className="text-xs text-gray-600 block mb-2">è‹¥å› å·¥ä½œå®¤é‡å¤§ç–å¤±å°è‡´å—å‚·æˆ–å¾€ç”Ÿï¼Œç¶“ä¿éšªå¯©æ ¸æœªç†è³ æ™‚ï¼Œä¾ä»¥ä¸‹æ¨™æº–è£œå„Ÿï¼š</span>
                                        <div className="flex gap-2">
                                            <span className="bg-white border px-2 py-1 rounded text-xs font-bold text-soosi-dark">å—å‚·é†«ç™‚ä¸Šé™ $2,000</span>
                                            <span className="bg-white border px-2 py-1 rounded text-xs font-bold text-soosi-dark">æ„å¤–å¾€ç”Ÿæ…°æ’«é‡‘ä¸Šé™ $5,000</span>
                                        </div>
                                        <span className="text-[10px] text-gray-400 mt-1 block">è¶…éä¸Šè¿°é‡‘é¡éƒ¨åˆ†ï¼Œä¸å¦è² æ“”è³ å„Ÿè²¬ä»»ã€‚</span>
                                    </li>
                                    <li><span className="font-bold">ç·Šæ€¥å°±é†«ï¼š</span>çªç™¼ç‹€æ³ç„¡æ³•å³æ™‚è¯çµ¡æ™‚ï¼Œæˆæ¬Šåº—å®¶é€é†«è™•ç½®ï¼Œè²»ç”¨ç”±é£¼ä¸»è² æ“”ã€‚è‹¥éåº—å®¶ç–å¤±ï¼ˆå¦‚éš±çç—…æƒ…ï¼‰ï¼Œä¸è² è³ å„Ÿè²¬ä»»ã€‚</li>
                                    <li>æœ¬å·¥ä½œå®¤éå‹•ç‰©é†«é™¢ï¼Œä¸æä¾›é†«ç™‚è¡Œç‚ºã€‚é€¾ä¸‰æ—¥æœªæ¥å›ä¾å‹•ä¿æ³•é€šå ±ã€‚</li>
                                </ul>
                            </div>

                            {/* äº”~å…«ã€æ³•å¾‹èˆ‡å€‹è³‡ (åˆä½µé¡¯ç¤ºä»¥ç¯€çœç©ºé–“ï¼Œä½†ä¿ç•™å®Œæ•´æ„ç¾©) */}
                            <div className="bg-[#F9F7F2] p-4 rounded-xl border border-soosi-wood/10 space-y-4 text-xs text-gray-600">
                                <div>
                                    <h6 className="font-bold text-soosi-wood text-sm mb-1">äº”ã€å€‹äººè³‡æ–™èˆ‡å½±åƒæˆæ¬Š</h6>
                                    <p>åŒæ„å€‹è³‡ç”¨æ–¼æœå‹™è¯ç¹«èˆ‡è¡ŒéŠ·ã€‚åŒæ„ç„¡å„Ÿæˆæ¬Šå¯µç‰©å½±åƒç”¨æ–¼å®˜æ–¹å®£å‚³ï¼Œè‹¥ä¸åŒæ„è«‹æå‰å‘ŠçŸ¥ï¼Œå°‡ä¸æœƒä¸Šå‚³ã€‚</p>
                                </div>
                                <div>
                                    <h6 className="font-bold text-soosi-wood text-sm mb-1">å…­ã€çˆ­è­°è™•ç†èˆ‡ç®¡è½„</h6>
                                    <p>æœå‹™çˆ­è­°é ˆæ–¼7æ—¥å…§ç”³è¨´ï¼Œä»¥ç¸é†«è¨ºæ–·ç‚ºæº–ã€‚é›™æ–¹åŒæ„ä»¥è‡ºç£æ²™é¹¿åœ°æ–¹æ³•é™¢ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</p>
                                </div>
                                <div>
                                    <h6 className="font-bold text-soosi-wood text-sm mb-1">ä¸ƒã€ç›£è¦–å™¨èª¿é–±</h6>
                                    <p>äº‹æ•…ç™¼ç”Ÿå¾Œ3æ—¥å…§å¯ç”³è«‹èª¿é–±ç›¸é—œç‰‡æ®µã€‚é¦–æ¬¡å…è²»ï¼Œå†æ¬¡ç”³è«‹é…Œæ”¶è¡Œæ”¿è²» $200/æ¬¡ã€‚</p>
                                </div>
                                <div>
                                    <h6 className="font-bold text-soosi-wood text-sm mb-1">å…«ã€æ¢æ¬¾æ•ˆåŠ›èˆ‡ä¿®æ”¹</h6>
                                    <p>æœ¬åŒæ„æ›¸ç°½ç½²å³å…·æ°¸ä¹…æ•ˆåŠ›ã€‚å·¥ä½œå®¤ä¿æœ‰ä¿®è¨‚æ¬Šåˆ©ï¼Œå…¬å‘Šæ–¼å®˜æ–¹LINEå³ç”Ÿæ•ˆã€‚</p>
                                </div>
                            </div>
                            
                            <div className="text-center text-xs text-soosi-wood/40 mt-6 font-bold tracking-widest">
                                --- é–±è®€å®Œç•¢è«‹å‘ä¸‹æ»‘å‹•ä»¥è§£é–åŒæ„æŒ‰éˆ• ---
                            </div>
                        </div>
                    </TermsModal>

                    {/* 2. ä½å®¿æ¢æ¬¾ Modal */}

<TermsModal isOpen={activeModal === 'boarding'} onClose={()=>setActiveModal(null)} title="ä½å®¿å®‰è¦ªå¥‘ç´„æ¢æ¬¾" onAgree={()=>setTermsRead(p=>({...p, boarding:true}))}>
                        <div className="space-y-6 text-sm text-soosi-dark leading-relaxed">
                            {/* Intro */}
                            <div className="bg-soosi-wood/10 p-4 rounded-xl border border-soosi-wood/20">
                                <h4 className="font-black text-soosi-wood mb-2 text-base">ä½å®¿æœå‹™åŒæ„æ›¸</h4>
                                <p className="text-xs font-bold text-soosi-dark/80">ç‚ºä¿éšœå¯µç‰©å®‰å…¨ï¼Œè«‹è©³é–±ã€‚é ç´„å³è¦–ç‚ºåŒæ„éµå®ˆä»¥ä¸‹è¦å®šã€‚ä½å®¿æœŸé–“åŒ…å«åŸºæœ¬ç¾å®¹æœå‹™ï¼Œæ•…éœ€åŒæ™‚åŒæ„ç¾å®¹æ¢æ¬¾ã€‚</p>
                            </div>

                            {/* ä¸€ã€åŸºæœ¬æ¢æ¬¾ */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">ä¸€ã€åŸºæœ¬æ¢æ¬¾</h5>
                                <ul className="list-decimal pl-5 space-y-2 marker:text-soosi-wood marker:font-bold">
                                    <li><span className="font-bold">æœå‹™æ‰¿è«¾ï¼š</span>é£¼ä¸»åŒæ„éµå®ˆå…¬ç´„ã€è¨ˆè²»æ–¹å¼ä¸¦å¦‚å¯¦ä»˜æ¬¾ã€‚</li>
                                    <li><span className="font-bold">è¯çµ¡æš¢é€šï¼š</span>æœå‹™æœŸé–“ï¼ˆ10:00-20:00ï¼‰è«‹ä¿æŒè¯ç¹«ã€‚è‹¥è³‡è¨ŠéŒ¯èª¤å°è‡´æå¤±ç”±é£¼ä¸»è² è²¬ã€‚</li>
                                    <li><span className="font-bold text-soosi-red">èª å¯¦ç”³å ±ï¼š</span>é ˆå‘ŠçŸ¥ç‰¹æ®Šç—…å²ã€éæ•ã€è¿‘æœŸæ‰‹è¡“æˆ–æ”»æ“Šæ€§ã€‚éš±çé€ æˆä¹‹æå®³é ˆè² å…¨è²¬ã€‚</li>
                                    <li><span className="font-bold">é¢¨éšªèªçŸ¥ï¼š</span>æœå‹™æœŸé–“æˆ–è¿”å®¶ä¸ƒæ—¥å…§ç™¼ç”Ÿä¹‹ç–¾ç—…ï¼Œæœ¬å…¬å¸ä¸è² ç›¸é—œè²¬ä»»ã€‚</li>
                                    <li><span className="font-bold">æ‹’çµ•æ¬Šåˆ©ï¼š</span>è‹¥æ‚£æœ‰å‚³æŸ“ç—…ã€åš´é‡æ”»æ“Šæ€§æˆ–æœªå‘ŠçŸ¥ä¹‹ç‰¹æ®Šç…§è­·éœ€æ±‚ï¼Œä¿æœ‰æ‹’çµ•æœå‹™æ¬Šã€‚</li>
                                </ul>
                            </div>

                            {/* äºŒã€å…¥ä½é ˆçŸ¥èˆ‡å¥åº·è¦ç¯„ */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">äºŒã€å…¥ä½é ˆçŸ¥èˆ‡å¥åº·è¦ç¯„</h5>
                                <div className="space-y-3">
                                    <p>1. <span className="font-bold">æ™‚é–“ï¼š</span>ä»¥ã€Œæ™šã€è¨ˆåƒ¹ï¼Œå…¥é€€æˆ¿æ™‚é–“ <span className="font-bold">10:00-20:00</span>ã€‚é€¾æ™‚éœ€éš”æ—¥æ¥å›ä¸¦æ”¯ä»˜éå¤œè²»ã€‚</p>
                                    <p>2. <span className="font-bold">å»ºæª”ï¼š</span>éœ€æä¾›èº«åˆ†è­‰æ­£åé¢å»ºæª”ä»¥é˜²æ£„é¤Šã€‚</p>
                                    <div className="bg-red-50 p-3 rounded-lg border border-red-100 space-y-2">
                                        <p className="font-bold text-soosi-red text-xs">âš ï¸ ç–«è‹—èˆ‡é©…èŸ²è¦æ±‚</p>
                                        <ul className="list-disc pl-5 text-xs text-soosi-dark space-y-1">
                                            <li>æœªæ¥ç¨®/éæœŸç–«è‹—è€…ï¼Œé£¼ä¸»é ˆæ‰¿æ“”å‚³æŸ“é¢¨éšªã€‚</li>
                                            <li>é ˆå®Œæˆé«”å…§å¤–é©…èŸ²ã€‚è‹¥ç™¼ç¾å¯„ç”ŸèŸ²ä¸”ç„¡æ³•æä¾›è­‰æ˜ï¼Œå°‡ä»£ç‚ºé€é†«ä¸¦æ”¶å–è²»ç”¨ <span className="font-bold text-soosi-red">$500èµ·</span>ã€‚</li>
                                        </ul>
                                    </div>
<p>4. ç‚ºç¢ºä¿ç’°å¢ƒè¡›ç”Ÿèˆ‡è²¬ä»»é‡æ¸…ï¼Œ<span className="font-bold text-soosi-red">ç‹—ç‹—å…¥ä½å‰ 3 æ—¥å…§é ˆæœ‰æ´—æ¾¡è¨˜éŒ„</span>ï¼ˆå¯æ–¼æœ¬é¤¨é ç´„æˆ–æä¾›ä»–åº—æ”¶æ“šè­‰æ˜ï¼‰ã€‚è²“å’ªä¸å¼·è¿«ã€‚</p>
                                    <p>5. ç‹—ç‹—é ˆå®Œæˆ2å°æ™‚å®‰è¦ªæ¸¬è©¦ï¼ˆä¸å¯èˆ‡ä½å®¿åŒæ—¥ï¼‰ï¼›è²“å’ªå…å®‰è¦ªï¼Œä½†å…·å¼·çƒˆæ”»æ“Š/ç„¦æ…®è€…ä¸æ¥å¾…ã€‚</p>
                                </div>
                            </div>

                            {/* ä¸‰ã€ä½å®¿èˆ‡ç…§è­·å®‰æ’ (ä¿®æ­£ç·¨è™Ÿ) */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">ä¸‰ã€ä½å®¿èˆ‡ç…§è­·å®‰æ’</h5>
                                <ul className="list-decimal pl-5 space-y-2">
                                    <li><span className="font-bold">æ”¾é¢¨ï¼š</span>æ¯æ—¥2æ¬¡ã€‚è‹¥ä¸å¸Œæœ›åƒèˆ‡ã€æˆ–å¯µç‰©æœ‰å¥åº·ç–‘æ…®ï¼Œè«‹ä¸»å‹•å‘ŠçŸ¥ã€‚</li>
                                    <li><span className="font-bold">é£²é£Ÿï¼š</span>ç‰¹æ®Šé£²é£Ÿç…§è­·æ¯æ—¥åŠ æ”¶ <span className="font-bold">$100-$500</span>ã€‚è‹¥è‡ªå‚™é£Ÿç‰©ä¸è¶³ï¼Œä»£è³¼è²»ç”¨å¦è¨ˆã€‚</li>
                                    <li><span className="font-bold">ç‰©å“ï¼š</span>è«‹è‡ªå‚™ç†Ÿæ‚‰ç‰©å“ã€‚æŠ¬è…³å°¿å°¿ç‹—ç‹—å°‡ç©¿æˆ´ç¦®è²Œå¸¶ã€‚</li>
                                    <li><span className="font-bold">æå£è³ å„Ÿï¼š</span>è‹¥å¯µç‰©ç ´å£è¨­æ–½ï¼Œé£¼ä¸»é ˆç…§åƒ¹è³ å„Ÿã€‚</li>
                                </ul>
                            </div>

                            {/* å››ã€ç·Šæ€¥ç‹€æ³èˆ‡é€é†« (ä¿®æ­£ç·¨è™Ÿ) */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">å››ã€ç·Šæ€¥ç‹€æ³èˆ‡é€é†«</h5>
                                <div className="space-y-2">
                                    <p>è‹¥èº«é«”ä¸é©å°‡ç«‹å³é€šçŸ¥ä¸¦é€é†«ã€‚åˆä½œé†«é™¢ç‚º <span className="font-bold">æ³°çˆ¾å‹•ç‰©é†«é™¢</span>ã€‚</p>
                                    <p>è‹¥éœ€ä»£è¾¦é€é†«ï¼Œæ¯æ¬¡é…Œæ”¶ <span className="font-bold">$500</span> è»Šé¦¬è²»ï¼ˆä¸å«è¨ºç™‚è²»ï¼‰ã€‚</p>
                                    <p className="text-xs text-gray-500">â€» è‹¥å› éš±çç—…æ³å°è‡´æ„å¤–ï¼Œç¶“åˆ¤å®šç„¡ç–å¤±ï¼Œåº—å®¶ä¸è² è³ å„Ÿè²¬ä»»ã€‚</p>
                                </div>
                            </div>

                            {/* äº”ã€é ç´„èˆ‡å–æ¶ˆ (ä¿®æ­£ç·¨è™Ÿ) */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">äº”ã€é ç´„èˆ‡å–æ¶ˆæ¢æ¬¾</h5>
                                <p>è¨‚æˆ¿é ˆä»˜50%å®šé‡‘ï¼Œå…¥ä½ç¹³æ¸…ã€‚æå‰é€€å®¿ä¸é€€è²»ã€‚</p>
                                <div className="overflow-hidden rounded-xl border border-gray-200">
                                    <table className="w-full text-xs text-left">
                                        <thead className="bg-gray-100 text-gray-600 font-bold">
                                            <tr><th className="p-2">å–æ¶ˆæ™‚é–“</th><th className="p-2">é€€è²»æ¯”ä¾‹</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            <tr><td className="p-2">15å¤©å‰</td><td className="p-2 text-soosi-green font-bold">å…¨é¡é€€è²»</td></tr>
                                            <tr><td className="p-2">10-14å¤©å‰</td><td className="p-2">é€€ 70%</td></tr>
                                            <tr><td className="p-2">7-9å¤©å‰</td><td className="p-2">é€€ 50%</td></tr>
                                            <tr><td className="p-2">å°‘æ–¼7å¤©</td><td className="p-2 text-soosi-red font-bold">ä¸é€€å®šé‡‘</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p className="text-[10px] text-gray-400">â€» æ˜¥ç¯€è¦å®šå¦è¨‚ã€‚éæŒ‡å®šéŠ€è¡Œé€€æ¬¾æ‰£æ‰‹çºŒè²»ã€‚</p>
                            </div>

                            {/* å…­ã€å…¶ä»–èˆ‡è²¬ä»» (ä¿®æ­£ç·¨è™Ÿ) */}
                            <div className="space-y-3">
                                <h5 className="font-black text-lg text-soosi-wood border-b-2 border-soosi-wood/10 pb-2">å…­ã€å…¶ä»–èˆ‡è²¬ä»»æ­¸å±¬</h5>
                                
                                <div className="bg-soosi-red/10 border border-soosi-red/20 p-3 rounded-xl">
                                    <p className="font-black text-soosi-red mb-1 text-xs">â›” æ£„é¤Šè™•ç½®</p>
                                    <p className="text-xs text-soosi-dark">é€¾æœŸä¸‰æ—¥æœªé ˜å›ä¸”å¤±è¯è€…ï¼Œè¦–ç‚ºæƒ¡æ„æ£„é¤Šã€‚å°‡äº¤ç”±å‹•ä¿æ©Ÿæ§‹è™•ç†ä¸¦è¿½å„Ÿæ³•å¾‹è²¬ä»»ã€‚</p>
                                </div>

                                <ul className="list-decimal pl-5 space-y-2">
                                    <li><span className="font-bold">ä»£é ˜è¦å®šï¼š</span>éœ€äº‹å…ˆLINEå‘ŠçŸ¥ä»£é ˜äººè³‡è¨Šï¼Œå–å›æ™‚æŸ¥æ ¸è­‰ä»¶ã€‚</li>
                                    <li className="bg-gray-50 p-3 rounded-lg -ml-2">
                                        <span className="font-bold block mb-1">æ„å¤–äº‹æ•…èˆ‡è³ å„Ÿæ¨™æº–ï¼š</span>
                                        <span className="text-xs text-gray-600 block mb-2">è‹¥å› å·¥ä½œå®¤é‡å¤§ç–å¤±å°è‡´å—å‚·æˆ–å¾€ç”Ÿï¼Œç¶“ä¿éšªå¯©æ ¸æœªç†è³ æ™‚ï¼Œä¾ä»¥ä¸‹æ¨™æº–è£œå„Ÿï¼š</span>
                                        <div className="flex gap-2">
                                            <span className="bg-white border px-2 py-1 rounded text-xs font-bold text-soosi-dark">å—å‚·é†«ç™‚ä¸Šé™ $2,000</span>
                                            <span className="bg-white border px-2 py-1 rounded text-xs font-bold text-soosi-dark">æ„å¤–å¾€ç”Ÿæ…°æ’«é‡‘ä¸Šé™ $5,000</span>
                                        </div>
                                        <span className="text-[10px] text-gray-400 mt-1 block">è¶…éä¸Šè¿°é‡‘é¡éƒ¨åˆ†ï¼Œä¸å¦è² æ“”è³ å„Ÿè²¬ä»»ã€‚</span>
                                    </li>
                                </ul>
                            </div>

                            {/* ä¸ƒ~åã€æ³•å¾‹èˆ‡å€‹è³‡ (åˆä½µé¡¯ç¤º) */}
                            <div className="bg-[#F9F7F2] p-4 rounded-xl border border-soosi-wood/10 space-y-4 text-xs text-gray-600">
                                <div>
                                    <h6 className="font-bold text-soosi-wood text-sm mb-1">ä¸ƒã€æ³•å¾‹èˆ‡å€‹è³‡è²æ˜</h6>
                                    <ul className="list-disc pl-4 space-y-1">
                                        <li>åŒæ„å€‹è³‡ç”¨æ–¼æœå‹™è¯ç¹«èˆ‡è¡ŒéŠ·ï¼›åŒæ„ç„¡å„Ÿæˆæ¬Šå½±åƒç”¨æ–¼å®˜æ–¹å®£å‚³ã€‚</li>
                                        <li>æœå‹™çˆ­è­°é ˆæ–¼7æ—¥å…§ç”³è¨´ã€‚é›™æ–¹åŒæ„ä»¥è‡ºç£æ²™é¹¿åœ°æ–¹æ³•é™¢ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</li>
                                        <li>äº‹æ•…ç™¼ç”Ÿå¾Œ3æ—¥å…§å¯ç”³è«‹èª¿é–±ç›£è¦–å™¨ã€‚é¦–æ¬¡å…è²»ï¼Œå†æ¬¡ç”³è«‹é…Œæ”¶è¡Œæ”¿è²» $200/æ¬¡ã€‚</li>
                                        <li>æœ¬åŒæ„æ›¸ç°½ç½²å³å…·æ°¸ä¹…æ•ˆåŠ›ã€‚æ¢æ¬¾ä¿®è¨‚å…¬å‘Šæ–¼å®˜æ–¹LINEå³ç”Ÿæ•ˆã€‚</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div className="text-center text-xs text-soosi-wood/40 mt-6 font-bold tracking-widest">
                                --- é–±è®€å®Œç•¢è«‹å‘ä¸‹æ»‘å‹•ä»¥è§£é–åŒæ„æŒ‰éˆ• ---
                            </div>
                        </div>
                    </TermsModal>

                    <TermsModal isOpen={activeModal === 'senior'} onClose={()=>setActiveModal(null)} title="é«˜é¢¨éšªå¯µç‰©æœå‹™é¢¨éšªå‘ŠçŸ¥" onAgree={()=>setTermsRead(p=>({...p, senior:true}))}>
                         <div className="space-y-4 border-2 border-red-100 rounded-xl p-4 bg-red-50">
                             <h4 className="font-bold text-center text-lg text-soosi-red border-b border-red-200 pb-2 mb-2">ã€é«˜é¢¨éšªå¯µç‰©åŒæ„æ›¸ã€‘</h4>
                             <p className="font-bold text-soosi-dark">
                                 é‡å° {riskType === 'senior' ? 'é«˜é½¡çŠ¬ (8æ­²ä»¥ä¸Š)' : riskType === 'puppy' ? 'å¹¼çŠ¬ (5å€‹æœˆä»¥ä¸‹)' : 'æ‚£æœ‰éå¾€ç—…å²ä¹‹å¯µç‰©'} ä¹‹ç‰¹åˆ¥ç´„å®šï¼š
                             </p>
                             <ul className="list-disc pl-5 space-y-1 mt-2">
                                <li>æœ¬äººçŸ¥æ‚‰é«˜é½¡/å¹¼é½¡/ç”Ÿç—…å¯µç‰©åœ¨ç¾å®¹æˆ–ä½å®¿éç¨‹ä¸­ï¼Œå› ç·Šè¿«å¯èƒ½å°è‡´æ½›åœ¨ç–¾ç—…ç™¼ä½œã€‚</li>
                                <li>è‹¥å› å¯µç‰©è‡ªèº«å› ç´ ï¼ˆå¦‚å¿ƒè‡Ÿç—…ç™¼ã€ä¼‘å…‹ã€ç™²ç™‡ï¼‰å°è‡´ä¹‹ä¸å¯æŠ—åŠ›æ„å¤–ï¼ŒåŒæ„ä¸è¿½ç©¶åº—å®¶è²¬ä»»ã€‚</li>
                             </ul>
                         </div>
                    </TermsModal>
{/* 3. é«˜é¢¨éšªç¾å®¹ Modal */}
<TermsModal isOpen={activeModal === 'highRiskGrooming'} onClose={()=>setActiveModal(null)} title="é«˜é¢¨éšªç¾å®¹æœå‹™é¢¨éšªå‘ŠçŸ¥" onAgree={()=>setTermsRead(p=>({...p, highRiskGrooming:true}))}>
                        <div className="space-y-5 text-sm text-soosi-dark leading-relaxed">
                            {/* Header Alert */}
                            <div className="bg-red-50 p-4 rounded-xl border border-red-200 text-center shadow-sm">
                                <h4 className="font-black text-soosi-red text-base border-b border-red-200 pb-2 mb-2">ã€é«˜é¢¨éšªå¯µç‰©ç¾å®¹åŒæ„è²æ˜ã€‘</h4>
                                <p className="text-xs font-bold text-red-700">é‡å°é«˜é½¡ã€å¹¼é½¡ã€éå¾€ç—…å²æˆ–è¡Œç‚ºæ•æ„Ÿå¯µç‰©ä¹‹ç‰¹åˆ¥ç´„å®šã€‚</p>
                            </div>

                            {/* ä¸€ã€èª å¯¦å‘ŠçŸ¥ */}
                            <div className="space-y-2">
                                <h5 className="font-black text-soosi-wood border-l-4 border-soosi-wood pl-2">ä¸€ã€é£¼ä¸»èª å¯¦å‘ŠçŸ¥ç¾©å‹™</h5>
                                <p className="text-xs">é£¼ä¸»ç¢ºèªå·²å¦‚å¯¦å‘ŠçŸ¥å¯µç‰©ç‹€æ³ï¼ˆå¹´é½¡ã€å¿ƒè‡Ÿç—…/ç™²ç™‡ç­‰ç—…å²ã€æ‡·å­•ã€éæ•ã€æ”»æ“Šç´€éŒ„ç­‰ï¼‰ã€‚</p>
                                <p className="text-xs font-bold text-soosi-red">â€» è‹¥å› æœªå‘ŠçŸ¥æˆ–æä¾›ä¸å¯¦è³‡è¨Šï¼Œå°è‡´åº—å®¶ç„¡æ³•é è¦‹ä¹‹é¢¨éšªç™¼ç”Ÿï¼Œè²¬ä»»ç”±é£¼ä¸»è‡ªè² ã€‚</p>
                            </div>

                            {/* äºŒã€é«˜é¢¨éšªå‘ŠçŸ¥ (é‡é») */}
                            <div className="bg-red-50/50 p-3 rounded-lg border border-red-100 space-y-2">
                                <h5 className="font-black text-soosi-red border-l-4 border-soosi-red pl-2">äºŒã€é«˜é½¡èˆ‡ç‰¹æ®Šå¥åº·ç‹€æ³é¢¨éšª</h5>
                                <ul className="list-disc pl-5 space-y-1 text-xs text-soosi-dark">
                                    <li><span className="font-bold">é¢¨éšªèªçŸ¥ï¼š</span>é«˜é½¡ã€å¹¼é½¡æˆ–æ…¢æ€§ç—…å¯µç‰©ï¼Œå°å£“åŠ›è€å—åº¦è¼ƒä½ã€‚</li>
                                    <li><span className="font-bold">çªç™¼ç‹€æ³ï¼š</span>ç¾å®¹éç¨‹å¯èƒ½å› ç·Šå¼µèª˜ç™¼ä¼‘å…‹ã€èˆŠç–¾å¾©ç™¼æˆ–ä¸å¯é æœŸä¹‹é¢¨éšªã€‚</li>
                                    <li><span className="font-bold text-red-700">å…è²¬è²æ˜ï¼š</span>è‹¥éå› åº—å®¶æ•…æ„æˆ–é‡å¤§éå¤±ï¼Œè€Œæ˜¯æºæ–¼å¯µç‰©è‡ªèº«å¥åº·å°è‡´ä¹‹ä¸åˆ©çµæœï¼Œæœ¬å·¥ä½œå®¤ä¸è² æå®³è³ å„Ÿè²¬ä»»ã€‚</li>
                                </ul>
                            </div>

                            {/* ä¸‰ã€æ”»æ“Šæ€§é˜²è­· */}
                            <div className="space-y-2">
                                <h5 className="font-black text-soosi-wood border-l-4 border-soosi-wood pl-2">ä¸‰ã€æ”»æ“Šæ€§èˆ‡è¡Œç‚ºå®‰å…¨é˜²è­·</h5>
                                <p className="text-xs">è‹¥å¯µç‰©å‡ºç¾æ”»æ“Šæˆ–éåº¦èºå‹•ï¼Œæˆæ¬Šåº—å®¶æ¡å–å¿…è¦é˜²è­·ï¼ˆå¦‚æˆ´å˜´å¥—ã€ä¿å®šï¼‰ã€‚è‹¥ç¶“åˆ¤æ–·å±åŠå®‰å…¨ï¼Œå¾—éš¨æ™‚ä¸­æ­¢æœå‹™ï¼Œè²»ç”¨ä¾é€²åº¦æ”¶å–ã€‚</p>
                            </div>

                            {/* å››ã€ç·Šæ€¥é†«ç™‚ */}
                            <div className="space-y-2">
                                <h5 className="font-black text-soosi-wood border-l-4 border-soosi-wood pl-2">å››ã€ç·Šæ€¥é†«ç™‚è™•ç½®</h5>
                                <p className="text-xs">ç™¼ç”Ÿç·Šæ€¥ç‹€æ³æ™‚ï¼ŒåŒæ„åº—å®¶å„ªå…ˆé€å¾€æŒ‡å®šæˆ–å°±è¿‘å‹•ç‰©é†«é™¢ï¼Œç›¸é—œè²»ç”¨ç”±é£¼ä¸»è² æ“”ã€‚</p>
                            </div>

                            <div className="text-center text-xs text-gray-400 mt-4 font-bold border-t border-dashed pt-4">
                                æˆ‘å·²è©³é–±ä¸¦å……åˆ†ç†è§£ä¸Šè¿°å…§å®¹ï¼ŒåŒæ„å°‡å¯µç‰©äº¤ä»˜æœå‹™ã€‚
                            </div>
                        </div>
                    </TermsModal>

                    {/* 4. é«˜é¢¨éšªä½å®¿ Modal */}
<TermsModal isOpen={activeModal === 'highRiskBoarding'} onClose={()=>setActiveModal(null)} title="é«˜é¢¨éšªä½å®¿æœå‹™é¢¨éšªå‘ŠçŸ¥" onAgree={()=>setTermsRead(p=>({...p, highRiskBoarding:true}))}>
                        <div className="space-y-5 text-sm text-soosi-dark leading-relaxed">
                            {/* Warning Box - æœ€é‡è¦çš„ç„¡24H */}
                            <div className="bg-soosi-red text-white p-4 rounded-xl shadow-md text-center">
                                <h4 className="font-black text-lg mb-1">âš ï¸ é‡è¦å‘ŠçŸ¥ï¼šç„¡ 24 å°æ™‚ç…§è­·</h4>
                                <p className="text-xs font-bold opacity-90">ä½å®¿æœŸé–“æ™šä¸Šç„¡äººé§åº—ï¼Œè‹¥ç™¼ç”Ÿçªç™¼ç‹€æ³åº—å®¶ç„¡æ³•å³æ™‚è™•ç½®ã€‚</p>
                            </div>

                            {/* ä¸€ã€å¥åº·é¢¨éšªå…è²¬ */}
                            <div className="space-y-2">
                                <h5 className="font-black text-soosi-wood border-l-4 border-soosi-wood pl-2">ä¸€ã€å¥åº·èˆ‡éºå‚³é¢¨éšªå…è²¬</h5>
                                <div className="text-xs space-y-2">
                                    <p>è‹¥å› ä»¥ä¸‹å› ç´ å°è‡´å¯µç‰©ç–¾ç—…ç™¼ä½œã€æ„å¤–ä¼‘å…‹æˆ–æ­»äº¡ï¼Œ<span className="font-bold text-soosi-red">æ¦‚èˆ‡æœ¬å·¥ä½œå®¤ç„¡é—œ</span>ï¼š</p>
                                    <ul className="list-disc pl-5 text-gray-600">
                                        <li>åŸºå› æˆ–éºå‚³å•é¡Œã€‚</li>
                                        <li>å¤©ç”Ÿç—…å²ã€é«˜é½¡çŠ¬è²“æˆ–å¹¼çŠ¬è²“ã€‚</li>
                                        <li>é£¼ä¸»éš±çç—…æƒ…æˆ–å·²çŸ¥é¢¨éšªä»å …æŒä½å®¿ã€‚</li>
                                    </ul>
                                </div>
                            </div>

                            {/* äºŒã€ç·Šæ€¥é€é†«èˆ‡è²»ç”¨ */}
                            <div className="space-y-2">
                                <h5 className="font-black text-soosi-wood border-l-4 border-soosi-wood pl-2">äºŒã€ç·Šæ€¥é€é†«èˆ‡è²»ç”¨</h5>
                                <p className="text-xs">è‹¥ç™¼ç”Ÿä¸Šè¿°æ„å¤–ï¼Œå·¥ä½œå®¤å°‡ç«‹å³é€å¾€é™„è¿‘å‹•ç‰©é†«é™¢æ•‘æ²»ã€‚é€é†«é€”ä¸­æˆ–æ²»ç™‚æ‰€ç”¢ç”Ÿä¹‹æ‰€æœ‰è²»ç”¨ï¼Œçš†ç”±é£¼ä¸»å…¨é¡è² æ“”ã€‚</p>
                            </div>

                            {/* ä¸‰ã€å¤œé–“ç„¡äººèˆ‡æƒ…ç·’é¢¨éšª (å†æ¬¡å¼·èª¿) */}
                            <div className="bg-red-50 p-3 rounded-lg border border-red-100 space-y-2">
                                <h5 className="font-black text-soosi-red text-xs">â›” å¤œé–“èˆ‡æƒ…ç·’é¢¨éšªç‰¹åˆ¥è²æ˜</h5>
                                <ul className="list-disc pl-5 text-xs text-soosi-dark">
                                    <li>é£¼ä¸»å·²çŸ¥æœ¬å·¥ä½œå®¤<span className="font-bold">ç„¡ 24 å°æ™‚æœå‹™</span>ã€‚</li>
                                    <li>å¤œé–“ç„¡äººç…§è­·æ™‚ï¼Œè‹¥å› å¯µç‰©æœ¬èº«ç„¦æ…®ã€æƒ…ç·’ä¸ç©©å°è‡´è‡ªæ®˜æˆ–å—å‚·ï¼Œæˆ–å› æ€¥ç—…ç„¡æ³•å³æ™‚æ•‘æ²»ï¼Œ<span className="font-bold">èˆ‡æœ¬å·¥ä½œå®¤ç„¡é—œ</span>ã€‚</li>
                                </ul>
                            </div>

                            {/* å››ã€æ³•å¾‹æ•ˆåŠ› */}
                            <div className="text-xs text-gray-500 bg-gray-50 p-3 rounded-lg">
                                <span className="font-bold">æ³•å¾‹æ•ˆåŠ›ç¢ºèªï¼š</span>
                                å€˜è‹¥ç™¼ç”Ÿæ³•å¾‹ç³¾ç´›æˆ–è¨´è¨Ÿï¼Œæœ¬åˆ‡çµæ›¸å°‡ä½œç‚ºé›™æ–¹æ¬Šåˆ©ç¾©å‹™ä¹‹é‡è¦ä¾æ“šï¼Œä¸¦å‘ˆäº¤ç›¸é—œæ³•å¾‹éƒ¨é–€ä½è­‰ã€‚
                            </div>
                        </div>
                    </TermsModal>
                    {/* 6. ä½å®¿åƒ¹ç›®è¡¨ Modal (åœ–ç‰‡ç‰ˆ) */}
                    <BoardingPriceModal isOpen={activeModal === 'boardingPrice'} onClose={()=>setActiveModal(null)} />
                </div>
            );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
