<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">

    <title>å®¿æ´—å¯µç‰© Soosi Pet | æ•¸ä½å¥‘ç´„ç³»çµ±</title>
    
    <link rel="icon" type="image/png" href="nav.png">
    <meta name="theme-color" content="#6A8D73"> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        soosi: {
                            green: '#6A8D73',      // ä¸»è‰²ï¼šç¶ è‰²
                            wood: '#8E6E53',       // å‰¯è‰²ï¼šæœ¨é ­è‰²
                            dark: '#3F3F3F',       // æ–‡å­—ï¼šæ·±ç°
                            light: '#F9F7F2',      // èƒŒæ™¯ï¼šç±³ç™½
                            accent: '#E6C66D',     // é»ç¶´ï¼šé‡‘é»ƒ
                            red: '#D67D7D'         // è­¦ç¤ºï¼šæŸ”å’Œç´…
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', '"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest" defer></script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

<style>
        :root {
            --brand-primary: #6A8D73;
            --brand-secondary: #8E6E53;
            --brand-bg: #F9F7F2;
            --brand-text: #3F3F3F;
        }

        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: var(--brand-bg);
            color: var(--brand-text);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        /* é¦–é  Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(106, 141, 115, 0.1);
            border-radius: 2rem;
            transition: all 0.3s ease;
        }

        /* å…§é  Cute Card */
        .cute-card {
            background: #FFFDF9;
            border: 2px solid #F0ECE6;
            border-radius: 1.5rem;
            box-shadow: 3px 3px 0px 0px rgba(142, 110, 83, 0.1);
            position: relative;
            overflow: hidden;
        }

        .dashed-divider {
            border-bottom: 2px dashed #EBE9E4;
            margin: 1.5rem 0;
        }

        /* è¼¸å…¥æ¡† */
        .cute-input {
            background: #ffffff;
            border: 2px solid #EBE9E4;
            border-radius: 1rem;
            color: var(--brand-text);
            transition: all 0.3s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        .cute-input:focus {
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 4px rgba(106, 141, 115, 0.15);
            outline: none;
            transform: translateY(-1px);
        }
        .cute-input.input-error {
            border-color: #D67D7D;
            background-color: #FFF5F5;
        }

        /* æŒ‰éˆ•æ¨£å¼ Pill */
        .pill-button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        .pill-button.active {
            background-color: var(--brand-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(106, 141, 115, 0.3);
            border-color: var(--brand-primary);
        }
        .pill-button.inactive {
            background-color: white;
            color: #8E6E53;
            border-color: #EBE9E4;
        }
        .pill-button.inactive:hover {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
        }

        /* ç°½åæ¿å…¨è¢å¹• */
        .fullscreen-signature {
            position: fixed;
            inset: 0;
            z-index: 200;
            touch-action: none;
            background-color: #F9F7F2;
            display: flex;
            flex-direction: column;
        }

        .bg-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
        }

        .field-error {
            color: #D67D7D;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        /* LINE åœ–ç‰‡ä¿®æ­£ */
        .line-img-fix {
            object-fit: contain;
            display: block;
        }
    </style>
</head>

<body>
    <div id="root"></div>

<script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        
        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (typeof window.lucide !== 'undefined' && iconRef.current) {
                    window.lucide.createIcons({
                        root: iconRef.current,
                        attrs: { "stroke-width": 2.5, class: className },
                        name: name
                    });
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"><i data-lucide={name} style={{ width: size, height: size }}></i></span>;
        };

// Modal Component (å¼·åˆ¶é–±è®€åˆ°åº•)
        const TermsModal = ({ isOpen, onClose, title, children, onAgree }) => {
            const contentRef = useRef(null);
            const [canAgree, setCanAgree] = useState(false);

            useEffect(() => {
                if (isOpen) {
                    setCanAgree(false);
                    document.body.style.overflow = 'hidden';
                    // å…§å®¹å°‘çš„æ™‚å€™ç›´æ¥å…è¨±
                    setTimeout(() => {
                        if (contentRef.current && contentRef.current.scrollHeight <= contentRef.current.clientHeight + 50) setCanAgree(true);
                    }, 500);
                } else {
                    document.body.style.overflow = '';
                }
            }, [isOpen]);

            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollHeight - scrollTop - clientHeight < 50) setCanAgree(true);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[150] bg-soosi-dark/40 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 animate-in fade-in duration-200">
                    <div className="w-full max-w-lg bg-white sm:rounded-3xl rounded-t-3xl shadow-2xl max-h-[90vh] flex flex-col overflow-hidden animate-in slide-in-from-bottom-10">
                        <div className="px-6 py-4 bg-soosi-green text-white flex justify-between items-center shrink-0">
                            <h3 className="text-lg font-black tracking-wider flex items-center gap-2"><Icon name="file-text" size={18}/> {title}</h3>
                            <button onClick={onClose} className="p-1 hover:bg-white/20 rounded-full transition-colors"><Icon name="x" size={20} /></button>
                        </div>
                        <div ref={contentRef} onScroll={handleScroll} className="flex-1 overflow-y-auto p-6 text-sm leading-relaxed text-soosi-dark space-y-4 bg-[#F9F7F2]">
                            {children}
                            <div className="h-10"></div>
                        </div>
                        <div className="p-5 bg-white border-t-2 border-dashed border-gray-100 shrink-0">
                            {!canAgree && <div className="text-center text-xs font-bold text-soosi-red mb-3 animate-pulse">ğŸ‘‡ è«‹æ»‘å‹•å·è»¸è‡³æœ€åº•éƒ¨ä»¥å•Ÿç”¨æŒ‰éˆ•</div>}
                            <button onClick={() => { if(canAgree) { onAgree && onAgree(); onClose(); }}} disabled={!canAgree}
                                className={`w-full py-4 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all ${canAgree ? 'bg-soosi-wood text-white shadow-lg hover:bg-[#7A5E47]' : 'bg-gray-100 text-gray-400 cursor-not-allowed'}`}>
                                <Icon name={canAgree ? "check-circle" : "lock"} size={20} />
                                {canAgree ? "æˆ‘å·²è©³é–±ä¸¦åŒæ„" : "è«‹é–±è®€å®Œç•¢"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('entry'); 
            const [isBoarding, setIsBoarding] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [errors, setErrors] = useState({});
            const [lineConfirmed, setLineConfirmed] = useState(false);
            
            // Signature State
            const [showFullSig, setShowFullSig] = useState(false);
            const [realtimeSig, setRealtimeSig] = useState(null);
            const sigCanvasRef = useRef(null);
            const padInstance = useRef(null);

            // Terms State
const [activeModal, setActiveModal] = useState(null);
            const [termsRead, setTermsRead] = useState({ 
                grooming: false, 
                boarding: false, 
                highRiskGrooming: false, 
                highRiskBoarding: false 
            });

            const [formData, setFormData] = useState({
                email: '', owner_name: '', phone: '', owner_id: '', address: '',
                emergency_name: '', emergency_phone: '',
                pet_name: '', breed: '', weight: '', 
                age: '', age_months: '', is_under_one: false,
                sex: '', fix: '', 
                social_aggression: '', social_play: '', // æ‹†åˆ†ç¤¾äº¤æ¬„ä½
                grooming_temperament: '',
                chip_status: '', chip_id: '', preferred_clinic: '',
                medical_status: '', medical_history: [], medical_history_other: '',
                service_type: '', service_type_other: '', legal_agree: false
            });

            // Routing
            useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash;
                    if (hash === '#grooming') {
                        setView('form'); setIsBoarding(false); window.scrollTo(0, 0);
                    } else if (hash === '#boarding') {
                        setView('form'); setIsBoarding(true); window.scrollTo(0, 0);
                    } else {
                        setView('entry');
                        if(window.location.hash) history.replaceState(null, null, ' ');
                    }
                };
                handleHashChange(); 
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            const goHome = () => { window.location.hash = ''; };
            const goGrooming = () => { window.location.hash = 'grooming'; };
            const goBoarding = () => { window.location.hash = 'boarding'; };

            // Logic Helpers
            const actualAge = useMemo(() => {
                if (formData.is_under_one && formData.age_months) return parseFloat(formData.age_months) / 12;
                return parseFloat(formData.age) || 0;
            }, [formData.age, formData.age_months, formData.is_under_one]);

            // é«˜é¢¨éšªåˆ¤å®šï¼šå¹´é½¡ OR æœ‰ç—…å²
            const isHighRisk = useMemo(() => {
                const ageRisk = actualAge >= 8 || (actualAge > 0 && actualAge < 0.42);
                const medicalRisk = formData.medical_status === 'æœ‰';
                return ageRisk || medicalRisk;
            }, [actualAge, formData.medical_status]);

            const riskType = useMemo(() => {
                if (formData.medical_status === 'æœ‰') return 'medical';
                if (actualAge >= 8) return 'senior';
                if (actualAge > 0 && actualAge < 0.42) return 'puppy';
                return null;
            }, [actualAge, formData.medical_status]);
            
// æ¢æ¬¾å®Œæˆæª¢æŸ¥ (é‚è¼¯æ›´æ–°ï¼šä½å®¿éœ€åŒæ™‚å®Œæˆ4é …ï¼Œç¾å®¹éœ€å®Œæˆ2é …)
            const allTermsRead = useMemo(() => {
                // 1. åŸºç¤ç¾å®¹æ¢æ¬¾ (æ‰€æœ‰äººå¿…è®€)
                if (!termsRead.grooming) return false;
                
                // 2. ä½å®¿æ¢æ¬¾ (ä½å®¿å®¢å¿…è®€)
                if (isBoarding && !termsRead.boarding) return false;
                
                // 3. é«˜é¢¨éšªåˆ¤å®š
                if (isHighRisk) {
                    // é«˜é¢¨éšªç¾å®¹ (é«˜é¢¨éšªå¿…è®€)
                    if (!termsRead.highRiskGrooming) return false;
                    
                    // é«˜é¢¨éšªä½å®¿ (ä½å®¿ + é«˜é¢¨éšªå¿…è®€)
                    if (isBoarding && !termsRead.highRiskBoarding) return false;
                }
                
                return true;
            }, [isBoarding, isHighRisk, termsRead]);

            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                if (errors[field]) setErrors(prev => ({ ...prev, [field]: null }));
            };

            const toggleArray = (field, value) => {
                setFormData(prev => {
                    const arr = prev[field] || [];
                    const newArr = arr.includes(value) ? arr.filter(i => i !== value) : [...arr, value];
                    return { ...prev, [field]: newArr };
                });
            };

            // ç°½åæ¿åˆå§‹åŒ– (ä¿®å¾© Canvas å¤§å°å•é¡Œ)
            useEffect(() => {
                if (showFullSig && sigCanvasRef.current) {
                    // ä½¿ç”¨ setTimeout ç¢ºä¿ DOM æ¸²æŸ“å®Œæˆ
                    setTimeout(() => {
                        const canvas = sigCanvasRef.current;
                        if(canvas) {
                             const ratio = Math.max(window.devicePixelRatio || 1, 1);
                             canvas.width = canvas.offsetWidth * ratio;
                             canvas.height = canvas.offsetHeight * ratio;
                             const ctx = canvas.getContext("2d");
                             ctx.scale(ratio, ratio);
                             // ç¢ºä¿ç­†è·¡æ¸…æ¥š
                             padInstance.current = new window.SignaturePad(canvas, { 
                                 minWidth: 2, 
                                 maxWidth: 4, 
                                 penColor: "#3F3F3F",
                                 backgroundColor: 'rgba(0,0,0,0)'
                             });
                        }
                    }, 100);
                }
            }, [showFullSig]);

            const handleSubmit = () => {
                const newErrors = {};
                const required = ['email', 'owner_name', 'phone', 'address', 'emergency_name', 'emergency_phone', 'pet_name', 'breed', 'weight', 'sex', 'fix', 'grooming_temperament', 'chip_status', 'medical_status', 'social_aggression', 'social_play'];
                
                required.forEach(f => { if(!formData[f]) newErrors[f] = 'æ­¤æ¬„ä½ç‚ºå¿…å¡«'; });
                if(formData.chip_status === 'æœ‰æ™¶ç‰‡' && !formData.chip_id) newErrors.chip_status = 'è«‹è¼¸å…¥æ™¶ç‰‡è™Ÿç¢¼';
                
if(!lineConfirmed) newErrors.line = 'è«‹ç¢ºèªå·²åŠ å…¥ LINE';
if(!allTermsRead) newErrors.signature = 'è«‹å…ˆå®Œæˆä¸Šæ–¹æ‰€æœ‰å¥‘ç´„æ¢æ¬¾é–±è®€';
if(!realtimeSig) newErrors.signature = 'è«‹å®Œæˆç°½å';
                
                if (Object.keys(newErrors).length > 0) {
                    setErrors(newErrors);
                    const firstError = Object.keys(newErrors)[0];
                    const el = document.getElementById(firstError);
                    if(el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    else alert("è«‹æª¢æŸ¥å¿…å¡«æ¬„ä½");
                    return;
                }
                setIsSubmitting(true);
                // æ¨¡æ“¬é€å‡º
                setTimeout(() => { alert("æäº¤æˆåŠŸï¼"); setIsSubmitting(false); window.location.reload(); }, 1500);
            };

            const PillBtn = ({ active, onClick, children, className = "" }) => (
                <button type="button" onClick={onClick} 
                    className={`pill-button flex-1 py-3 px-4 rounded-xl font-bold text-sm flex items-center justify-center gap-2 ${active ? 'active' : 'inactive'} ${className}`}>
                    {children}
                </button>
            );

            const InputGroup = ({ label, error, id, children, required = false }) => (
                <div className="space-y-1.5" id={id}>
                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1">
                        {required && <span className="text-soosi-red text-xs">â—</span>}
                        {label}
                    </label>
                    {children}
                    {error && <div className="field-error"><Icon name="alert-circle" size={12}/>{error}</div>}
                </div>
            );

            // --- 1. é¦–é  View ---
            if (view === 'entry') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
                        <div className="bg-blob w-96 h-96 bg-soosi-green/20 top-[-10%] left-[-10%]"></div>
                        <div className="bg-blob w-80 h-80 bg-soosi-wood/10 bottom-[-10%] right-[-10%]"></div>

                        <div className="w-full max-w-lg mx-auto relative z-10 flex flex-col items-center">
                            <div className="mb-10 relative group cursor-default">
                                <div className="absolute inset-0 bg-white/40 rounded-full blur-2xl transform scale-110"></div>
                                <img src="logo.png" alt="å®¿æ´— Soosi Pet" className="w-56 md:w-64 h-auto relative z-10 drop-shadow-sm transform group-hover:scale-105 transition-transform duration-500" />
                                <div className="absolute -right-4 -top-2 bg-soosi-accent text-soosi-dark text-xs font-black px-3 py-1 rounded-full rotate-12 shadow-sm">ç‰¹å¯µæ¥­å­—ç¬¬ S1140030è™Ÿ</div>
                            </div>
                            <div className="text-center mb-10 space-y-2">
                                <h1 className="text-2xl font-black text-soosi-dark tracking-wide">å®¿æ´—å¯µç‰© <span className="text-soosi-green">Soosi Pet</span></h1>
                                <p className="text-soosi-wood font-medium text-sm tracking-widest">ç¾å®¹ | æ—…é¤¨ | å®‰è¦ª | é¸å“</p>
                            </div>
                            
                            <div className="grid grid-cols-1 w-full gap-5">
                                <button onClick={goGrooming} 
                                    className="glass-card p-6 flex items-center gap-5 group hover:bg-white/90 active:scale-[0.98] border-l-8 border-soosi-green transition-all relative overflow-hidden">
                                    <div className="absolute right-0 top-0 opacity-10 transform translate-x-1/4 -translate-y-1/4"><Icon name="scissors" size={120} className="text-soosi-green"/></div>
                                    <div className="w-16 h-16 rounded-2xl bg-soosi-green/10 flex items-center justify-center text-soosi-green group-hover:bg-soosi-green group-hover:text-white transition-colors shadow-sm z-10">
                                        <Icon name="scissors" size={32} />
                                    </div>
                                    <div className="text-left flex-1 z-10">
                                        <h3 className="text-xl font-black text-soosi-dark mb-1">ç¾å®¹å®‰è¦ª</h3>
                                        <p className="text-xs text-gray-500 font-medium">Grooming Service</p>
                                    </div>
                                    <div className="text-soosi-green z-10"><Icon name="arrow-right" /></div>
                                </button>

                                <button onClick={goBoarding} 
                                    className="glass-card p-6 flex items-center gap-5 group hover:bg-white/90 active:scale-[0.98] border-l-8 border-soosi-wood transition-all relative overflow-hidden">
                                    <div className="absolute right-0 top-0 opacity-10 transform translate-x-1/4 -translate-y-1/4"><Icon name="home" size={120} className="text-soosi-wood"/></div>
                                    <div className="w-16 h-16 rounded-2xl bg-soosi-wood/10 flex items-center justify-center text-soosi-wood group-hover:bg-soosi-wood group-hover:text-white transition-colors shadow-sm z-10">
                                        <Icon name="home" size={32} />
                                    </div>
                                    <div className="text-left flex-1 z-10">
                                        <h3 className="text-xl font-black text-soosi-dark mb-1">å¯µç‰©ä½å®¿</h3>
                                        <p className="text-xs text-gray-500 font-medium">Pet Boarding</p>
                                    </div>
                                    <div className="text-soosi-wood z-10"><Icon name="arrow-right" /></div>
                                </button>
                            </div>

                            <footer className="mt-12 text-center space-y-5">
                                <div className="flex items-center justify-center gap-8 text-soosi-wood/70">
                                    <a href="https://www.instagram.com/soosi.studio/" target="_blank" className="hover:text-soosi-green hover:scale-110 transition-all flex flex-col items-center gap-1">
                                        <Icon name="instagram" size={24}/>
                                        <span className="text-[10px] font-bold">Instagram</span>
                                    </a>
                                    <a href="https://www.facebook.com/soosistudio/?rdid=4JTN13dweC8vLijB" target="_blank" className="hover:text-soosi-green hover:scale-110 transition-all flex flex-col items-center gap-1">
                                        <Icon name="facebook" size={24}/>
                                        <span className="text-[10px] font-bold">Facebook</span>
                                    </a>
                                    <a href="http://lin.ee/nfGjHryU" target="_blank" className="hover:text-soosi-green hover:scale-110 transition-all flex flex-col items-center gap-1">
                                        <img src="line.png" className="w-6 h-6 grayscale opacity-70 hover:grayscale-0 hover:opacity-100 transition-all line-img-fix"/>
                                        <span className="text-[10px] font-bold">LINE</span>
                                    </a>
                                </div>
                                <div>
                                    <a href="https://maps.app.goo.gl/Y2sQnyWPW5Dysezg6" target="_blank" 
                                       className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/50 border border-white/60 hover:bg-white/80 transition-all text-soosi-wood text-xs font-bold shadow-sm backdrop-blur-sm">
                                        <Icon name="map-pin" size={14} className="text-soosi-red" />
                                        å°ä¸­å¸‚æ¸…æ°´å€æ–°èˆˆè·¯142-1è™Ÿ
                                    </a>
                                </div>
                                <p className="text-[10px] text-gray-400 font-medium tracking-wider">
                                    Â© 2026 Soosi Pet. All Rights Reserved.
                                </p>
                            </footer>
                        </div>
                    </div>
                );
            }

            // --- 2. è¡¨å–® View ---
            return (
                <div className="min-h-screen pb-32">
                    {/* Nav: Logo æ”¾å¤§ */}
                    <nav className="fixed top-0 w-full z-40 bg-white/90 backdrop-blur-xl border-b border-soosi-green/10 shadow-sm transition-all">
                        <div className="px-6 py-3 flex justify-between items-center max-w-3xl mx-auto">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={goHome}>
                                <img src="nav.png" alt="Logo" className="w-12 h-12 object-contain" />
                                <div className="font-black text-lg text-soosi-dark tracking-wide">å®¿æ´— Soosi</div>
                            </div>
                            <button onClick={goHome} className="text-xs font-bold text-soosi-wood hover:bg-soosi-wood/10 px-3 py-1.5 rounded-full transition-colors flex items-center gap-1">
                                <Icon name="arrow-left" size={14}/> è¿”å›é¦–é 
                            </button>
                        </div>
                    </nav>

                    <main className="pt-28 px-4 max-w-3xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <div className="text-center space-y-2 pb-2">
                            <div className={`inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider ${isBoarding ? 'bg-soosi-wood/10 text-soosi-wood' : 'bg-soosi-green/10 text-soosi-green'}`}>
                                {isBoarding ? "Hotel Service" : "Grooming Service"}
                            </div>
                            <h2 className="text-3xl font-black text-soosi-dark tracking-tight">
                                {isBoarding ? "ä½å®¿æœå‹™è³‡æ–™å¡«å¯«" : "ç¾å®¹æœå‹™è³‡æ–™å¡«å¯«"}
                            </h2>
                        </div>

                        {/* LINE Section (é‡è¨­è¨ˆ) */}
                        <div className="cute-card p-6 space-y-4" id="line">
                            <div className="text-center space-y-1">
                                <div className="inline-block bg-[#06C755] text-white px-3 py-0.5 rounded-full text-[10px] font-black shadow-sm mb-1">STEP 1</div>
                                <h3 className="text-lg font-black text-soosi-wood flex items-center justify-center gap-2">
                                    åŠ å…¥å®˜æ–¹ LINE
                                </h3>
                                <p className="text-xs text-gray-400 font-bold">ID: @610ijdjr</p>
                            </div>
                            
                            <div className="bg-white border-2 border-dashed border-gray-200 rounded-2xl p-4 flex flex-col md:flex-row items-center gap-4">
<div className="flex-1 w-full">
                                    <a href="http://lin.ee/nfGjHryU" target="_blank" className="w-full bg-[#06C755]/5 border border-[#06C755]/20 hover:bg-[#06C755]/10 text-[#06C755] rounded-xl p-3 flex items-center justify-center gap-2 transition-all active:scale-95">
                                        <img src="line.png" className="w-6 h-6 line-img-fix" /> 
                                        <span className="font-bold">1. é»æ“ŠåŠ å…¥å¥½å‹</span>
                                    </a>
                                
                                </div>
                                <div className="hidden md:block text-gray-300 font-black"><Icon name="arrow-right" size={24}/></div>
                                <div className="flex-1 w-full bg-red-50 text-soosi-red border border-red-100 rounded-xl p-3 flex items-center justify-center gap-2">
                                    <Icon name="message-circle" size={18}/>
                                    <span className="font-bold">2. å‹™å¿…å‚³é€è²¼åœ–</span>
                                </div>
                            </div>
                            
                            <label className={`w-full flex items-center justify-center gap-3 p-4 rounded-xl border-2 transition-all cursor-pointer select-none ${lineConfirmed ? 'bg-[#06C755]/10 border-[#06C755] text-[#06C755]' : 'bg-white border-gray-200 text-gray-400 hover:border-[#06C755]/50'}`}>
                                <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${lineConfirmed ? 'bg-[#06C755] border-[#06C755]' : 'border-gray-300'}`}>
                                    {lineConfirmed && <Icon name="check" size={12} className="text-white"/>}
                                </div>
                                <input type="checkbox" className="hidden" checked={lineConfirmed} onChange={()=>setLineConfirmed(!lineConfirmed)}/>
                                <span className="font-bold text-sm">æˆ‘å·²å®ŒæˆåŠ å…¥å¥½å‹ä¸¦å‚³é€è²¼åœ–</span>
                            </label>
                            {errors.line && <div className="field-error justify-center"><Icon name="alert-circle" size={12}/>{errors.line}</div>}
                        </div>

                        {/* Owner Info */}
                        <section className="cute-card p-8 space-y-6">
                            <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <span className="text-2xl">ğŸ‘¤</span>
                                <h3 className="text-lg font-black text-soosi-dark">é£¼ä¸»åŸºæœ¬è³‡æ–™</h3>
                            </div>
                            <div className="grid md:grid-cols-2 gap-5">
                                <InputGroup label="é›»å­éƒµä»¶" required error={errors.email} id="email">
                                    <input type="email" value={formData.email} onChange={e=>handleChange('email', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.email ? 'input-error' : ''}`} placeholder="å¯„é€å¥‘ç´„å‰¯æœ¬ç”¨" />
                                </InputGroup>
                                <InputGroup label="ä¸»äººå§“å" required error={errors.owner_name} id="owner_name">
                                    <input type="text" value={formData.owner_name} onChange={e=>handleChange('owner_name', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.owner_name ? 'input-error' : ''}`} placeholder="è«‹è¼¸å…¥å…¨å" />
                                </InputGroup>
                                <InputGroup label="é€£çµ¡é›»è©±" required error={errors.phone} id="phone">
                                    <div className="flex gap-2">
                                        <input type="tel" value={formData.phone} onChange={e=>handleChange('phone', e.target.value)} className={`w-full cute-input px-4 py-3 flex-1 ${errors.phone ? 'input-error' : ''}`} placeholder="0912345678" />
                                        <button className="px-4 bg-soosi-wood text-white rounded-xl font-bold text-sm shadow-md hover:bg-[#7a5e47] flex items-center gap-1 whitespace-nowrap"><Icon name="search" size={14}/> èˆŠå®¢</button>
                                    </div>
                                </InputGroup>
                                <InputGroup label="èº«åˆ†è­‰å­—è™Ÿ " required error={errors.id}  id="owner_id">
                                    <input type="text" value={formData.owner_id} onChange={e=>handleChange('owner_id', e.target.value)} className="w-full cute-input px-4 py-3" placeholder="ä¾‹å¦‚: A123456789" />
                                </InputGroup>
                                <div className="md:col-span-2">
                                    <InputGroup label="é€šè¨Šåœ°å€" required error={errors.address} id="address">
                                        <input type="text" value={formData.address} onChange={e=>handleChange('address', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.address ? 'input-error' : ''}`} placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€" />
                                    </InputGroup>
                                </div>
                                <div className="md:col-span-2 dashed-divider"></div>
                                <InputGroup label="ç·Šæ€¥è¯çµ¡äººå§“å" required error={errors.emergency_name} id="emergency_name">
                                    <input type="text" value={formData.emergency_name} onChange={e=>handleChange('emergency_name', e.target.value)} className={`w-full cute-input px-4 py-3 border-red-100 bg-red-50/20 ${errors.emergency_name ? 'input-error' : ''}`} />
                                </InputGroup>
                                <InputGroup label="ç·Šæ€¥é€£çµ¡é›»è©±" required error={errors.emergency_phone} id="emergency_phone">
                                    <input type="tel" value={formData.emergency_phone} onChange={e=>handleChange('emergency_phone', e.target.value)} className={`w-full cute-input px-4 py-3 border-red-100 bg-red-50/20 ${errors.emergency_phone ? 'input-error' : ''}`} />
                                </InputGroup>
                            </div>
                        </section>

                        {/* Pet Info */}
                        <section className="cute-card p-8 space-y-6">
                            <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <span className="text-2xl">ğŸ¾</span>
                                <h3 className="text-lg font-black text-soosi-dark">å¯µç‰©è©³ç´°è³‡æ–™</h3>
                            </div>
                            <div className="grid md:grid-cols-2 gap-5">
                                <InputGroup label="å¯µç‰©åå­—" required error={errors.pet_name} id="pet_name">
                                    <input type="text" value={formData.pet_name} onChange={e=>handleChange('pet_name', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.pet_name ? 'input-error' : ''}`} />
                                </InputGroup>
                                <InputGroup label="å“ç¨®" required error={errors.breed} id="breed">
                                    <input type="text" value={formData.breed} onChange={e=>handleChange('breed', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.breed ? 'input-error' : ''}`} />
                                </InputGroup>
                                <InputGroup label="é«”é‡ (kg)" required error={errors.weight} id="weight">
                                    <input type="number" step="0.1" value={formData.weight} onChange={e=>handleChange('weight', e.target.value)} className={`w-full cute-input px-4 py-3 ${errors.weight ? 'input-error' : ''}`} />
                                </InputGroup>
                                
                                {/* ä¿®æ”¹å¹´é½¡é‚è¼¯ï¼šåˆ‡æ›æ™‚æ¸…ç©ºå¦ä¸€é‚Šçš„æ•¸å€¼ */}
                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> å¹´é½¡</label>
                                    <div className="flex gap-2">
                                        <PillBtn active={!formData.is_under_one} onClick={()=>setFormData(p=>({...p, is_under_one:false, age_months:''}))}>ä¸€æ­²ä»¥ä¸Š</PillBtn>
                                        <PillBtn active={formData.is_under_one} onClick={()=>setFormData(p=>({...p, is_under_one:true, age:''}))}>ä¸€æ­²ä»¥ä¸‹</PillBtn>
                                    </div>
                                    {formData.is_under_one ? (
                                        <select value={formData.age_months} onChange={e=>handleChange('age_months', e.target.value)} className="w-full cute-input px-4 py-3">
                                            <option value="">è«‹é¸æ“‡æœˆé½¡</option>
                                            {[1,2,3,4,5,6,7,8,9,10,11].map(m=><option key={m} value={m}>{m} å€‹æœˆ</option>)}
                                        </select>
                                    ) : (
                                        <input type="number" placeholder="è«‹è¼¸å…¥å¹´é½¡ (æ­²)" value={formData.age} onChange={e=>handleChange('age', e.target.value)} className="w-full cute-input px-4 py-3" />
                                    )}
                                </div>

                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> æ€§åˆ¥</label>
                                    <div className="flex gap-2">
                                        <PillBtn active={formData.sex === 'å…¬'} onClick={()=>handleChange('sex', 'å…¬')}>å…¬</PillBtn>
                                        <PillBtn active={formData.sex === 'æ¯'} onClick={()=>handleChange('sex', 'æ¯')}>æ¯</PillBtn>
                                    </div>
                                    {errors.sex && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.sex}</div>}
                                </div>

                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> çµç´®</label>
                                    <div className="flex gap-2">
                                        <PillBtn active={formData.fix === 'æ˜¯'} onClick={()=>handleChange('fix', 'æ˜¯')}>æ˜¯</PillBtn>
                                        <PillBtn active={formData.fix === 'å¦'} onClick={()=>handleChange('fix', 'å¦')}>å¦</PillBtn>
                                    </div>
                                    {errors.fix && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.fix}</div>}
                                </div>

                                {/* ç¤¾äº¤ç‹€æ³ï¼šæ”¹ç‚ºäºŒé¸ä¸€çš„å…©çµ„é¡Œç›® */}
                                <div className="md:col-span-2 space-y-4" id="social_aggression">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> æ”»æ“Šæ€§</label>
                                    <div className="flex gap-3">
                                        <PillBtn active={formData.social_aggression === 'æœ‰æ”»æ“Šæ€§'} onClick={()=>handleChange('social_aggression', 'æœ‰æ”»æ“Šæ€§')}>æœ‰æ”»æ“Šæ€§</PillBtn>
                                        <PillBtn active={formData.social_aggression === 'ç„¡æ”»æ“Šæ€§'} onClick={()=>handleChange('social_aggression', 'ç„¡æ”»æ“Šæ€§')}>ç„¡æ”»æ“Šæ€§</PillBtn>
                                    </div>
                                    {errors.social_aggression && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.social_aggression}</div>}
                                </div>

                                <div className="md:col-span-2 space-y-4" id="social_play">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> èˆ‡ç‹—ç›¸è™•</label>
                                    <div className="flex gap-3">
                                        <PillBtn active={formData.social_play === 'å¯èˆ‡ç‹—ç©'} onClick={()=>handleChange('social_play', 'å¯èˆ‡ç‹—ç©')}>å¯èˆ‡ç‹—æœ‹å‹ç©</PillBtn>
                                        <PillBtn active={formData.social_play === 'ä¸å¯èˆ‡ç‹—ç©'} onClick={()=>handleChange('social_play', 'ä¸å¯èˆ‡ç‹—ç©')}>ä¸èƒ½èˆ‡ç‹—æœ‹å‹ç©</PillBtn>
                                    </div>
                                    {errors.social_play && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.social_play}</div>}
                                </div>


                                <div className="md:col-span-2 space-y-2" id="grooming_temperament">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> ç¾å®¹æ€§æƒ…èˆ‡æ”»æ“Šæ€§è©•ä¼°</label>
                                    <div className="space-y-2">
                                        {[
                                            {v: 'å¤©ä½¿å¯¶å¯¶', l: 'ğŸ˜‡ å¤©ä½¿å¯¶å¯¶ï¼šå€‹æ€§æº«å’Œï¼Œç„¡ä»»ä½•æ”»æ“Šç´€éŒ„ï¼Œä¹Ÿä¸æ€•ç”Ÿã€‚'},
                                            {v: 'æœ‰é»ç·Šå¼µ', l: 'ğŸ˜“ æœ‰é»ç·Šå¼µï¼šè†½å°æ€•ç”Ÿï¼Œå¯èƒ½æœƒä½å¼æˆ–é–ƒèº²ï¼Œä½†æœªæ›¾å’¬äººã€‚'},
                                            {v: 'æ°åŒ—åŒ—/è­·ä¸»', l: <span className="text-red-500">ğŸ¤¬ æ°åŒ—åŒ—/è­·ä¸»ï¼šç‰¹å®šéƒ¨ä½æ•æ„Ÿæˆ–æ›¾æœ‰æ”»æ“Šç´€éŒ„ (è«‹å‹™å¿…å‘ŠçŸ¥)ã€‚</span>}
                                        ].map(item => (
                                            <button key={item.v} type="button" onClick={()=>handleChange('grooming_temperament', item.v)}
                                                className={`w-full pill-button px-4 py-3 rounded-xl text-left font-bold text-sm ${formData.grooming_temperament === item.v ? 'active' : 'inactive'}`}>
                                                {item.l}
                                            </button>
                                        ))}
                                    </div>
                                    {errors.grooming_temperament && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.grooming_temperament}</div>}
                                </div>

                                <div className="md:col-span-2 space-y-2">
                                    <label className="text-sm font-bold text-soosi-wood ml-1 flex items-center gap-1"><span className="text-soosi-red text-xs">â—</span> æ™¶ç‰‡ç‹€æ…‹</label>
                                    <div className="flex gap-2 flex-wrap">
                                        {['æœ‰æ™¶ç‰‡','æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)','ç„¡æ™¶ç‰‡'].map(s => (
                                            <PillBtn key={s} active={formData.chip_status===s} onClick={()=>handleChange('chip_status', s)}>{s}</PillBtn>
                                        ))}
                                    </div>
                                    {formData.chip_status === 'æœ‰æ™¶ç‰‡' && (
                                        <input type="text" value={formData.chip_id} onChange={e=>handleChange('chip_id', e.target.value)} className="w-full cute-input px-4 py-3 mt-2" placeholder="è«‹è¼¸å…¥æ™¶ç‰‡è™Ÿç¢¼" />
                                    )}
                                    {errors.chip_status && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.chip_status}</div>}
                                </div>

                                <div className="md:col-span-2">
                                    <InputGroup label="æŒ‡å®šå°±é†«è¨ºç™‚æ©Ÿæ§‹ (è‹¥æœªå¡«å¯«ï¼Œå‰‡é€å¾€ç‰¹ç´„é†«é™¢)" id="preferred_clinic">
                                        <input type="text" value={formData.preferred_clinic} onChange={e=>handleChange('preferred_clinic', e.target.value)} className="w-full cute-input px-4 py-3" />
                                        <div className="mt-2 p-3 rounded-xl bg-soosi-green/5 border border-soosi-green/20 flex items-center gap-3">
                                            <div className="bg-soosi-green p-2 rounded-full text-white"><Icon name="hospital" size={16}/></div>
                                            <div>
                                                <div className="text-xs font-bold text-gray-400">ç‰¹ç´„é†«é™¢</div>
                                                <div className="font-bold text-soosi-wood text-sm">å¾…ç¢ºèª</div>
                                            </div>
                                        </div>
                                    </InputGroup>
                                </div>

{/* éå¾€ç—…å²å€å¡Šï¼šé è¨­ç´…åº•ä¸¦å°‡æé†’ç·Šè²¼æ¨™é¡Œ */}
                                <div className="md:col-span-2 p-5 rounded-2xl border bg-red-50 border-red-100 transition-all" id="medical_status">
                                    <div className="flex items-center gap-2 mb-4">
                                        <label className="text-sm font-bold text-soosi-wood ml-1">
                                            éå¾€ç—…å²
                                        </label>
                                        <div className="flex items-center gap-1 text-soosi-red text-[10px] font-black bg-white px-2 py-0.5 rounded-full shadow-sm animate-pulse border border-red-100 shrink-0">
                                            <Icon name="alert-circle" size={14}/> è«‹å‹™å¿…å¦‚å¯¦å‘ŠçŸ¥
                                        </div>
                                    </div>

                                    <div className="flex gap-3 mb-4">
                                        <PillBtn active={formData.medical_status === 'æœ‰'} onClick={() => handleChange('medical_status', 'æœ‰')} className={formData.medical_status === 'æœ‰' ? 'bg-soosi-red border-soosi-red' : 'bg-white'}>æœ‰</PillBtn>
                                        <PillBtn active={formData.medical_status === 'ç„¡'} onClick={() => handleChange('medical_status', 'ç„¡')} className={formData.medical_status === 'ç„¡' ? '' : 'bg-white'}>ç„¡</PillBtn>
                                    </div>
                                    
                                    {errors.medical_status && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.medical_status}</div>}

                                    {formData.medical_status === 'æœ‰' && (
                                        <div className="space-y-3 mt-4 pt-4 border-t border-red-200/50 animate-in fade-in">
                                            <div className="flex flex-wrap gap-2">
                                                {['å¿ƒè‡Ÿç—…','æ°£å–˜','æ°£ç®¡å¡Œé™·','ç™½å…§éšœ','ç™²ç™‡','å¿ƒçµ²èŸ²','çš®è†šç—…','å…¶ä»–'].map(v => (
                                                    <button key={v} type="button" onClick={() => toggleArray('medical_history', v)}
                                                        className={`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${formData.medical_history.includes(v) ? 'bg-soosi-wood text-white border-soosi-wood' : 'bg-white text-gray-500 border-gray-200'}`}>
                                                        {v}
                                                    </button>
                                                ))}
                                            </div>
                                            {formData.medical_history.includes('å…¶ä»–') && <textarea className="w-full cute-input px-4 py-2 mt-2" placeholder="è«‹èªªæ˜å…¶ä»–ç—…å²..." value={formData.medical_history_other} onChange={e => handleChange('medical_history_other', e.target.value)} />}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </section>

                        {/* Legal & Signature */}
                        <section className="cute-card p-8 space-y-8">
                            <div className="flex items-center gap-3 border-b-2 border-dashed border-soosi-wood/10 pb-4">
                                <span className="text-2xl">ğŸ“</span>
                                <h3 className="text-lg font-black text-soosi-dark">æ³•å¾‹æ¢æ¬¾èˆ‡æ•¸ä½ç°½ç½²</h3>
                            </div>

                            {/* ä¹™æ–¹è³‡è¨Š */}
                            <div className="bg-[#F9F7F2] p-5 rounded-2xl border border-soosi-wood/10 text-xs text-soosi-wood space-y-2">
                                <h4 className="font-bold border-b border-soosi-wood/10 pb-2 mb-2">ä¹™æ–¹ï¼ˆåº—å®¶ï¼‰è³‡è¨Š</h4>
                                <div className="grid grid-cols-2 gap-2">
                                    <div><span className="opacity-60 block">åº—å®¶åç¨±</span><span className="font-bold">å®¿æ´— Soosi Pet</span></div>
                                    <div><span className="opacity-60 block">è² è²¬äºº</span><span className="font-bold">å¾…ç¢ºèª</span></div>
                                    <div><span className="opacity-60 block">ç‰¹å¯µæ¥­å­—è™Ÿ</span><span className="font-bold">S1140030è™Ÿ</span></div>
                                    <div><span className="opacity-60 block">è¯çµ¡é›»è©±</span><span className="font-bold">å¾…ç¢ºèª</span></div>
                                    <div><span className="opacity-60 block">ç‡Ÿæ¥­æ™‚é–“</span><span className="font-bold">å¾…ç¢ºèª</span></div>
                                    <div className="col-span-2"><span className="opacity-60 block">ç‡Ÿæ¥­åœ°å€</span><span className="font-bold">å°ä¸­å¸‚æ¸…æ°´å€æ–°èˆˆè·¯142-1è™Ÿ</span></div>
                                </div>
                            </div>

<div className="space-y-4">
                                {/* 1. ç¾å®¹æ¢æ¬¾ (æ°¸é é¡¯ç¤ºï¼Œå› ç‚ºä½å®¿ä¹ŸåŒ…å«ç¾å®¹) */}
                                <button type="button" onClick={() => setActiveModal('grooming')} 
                                    className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all ${termsRead.grooming ? 'bg-soosi-green/10 border-soosi-green' : 'bg-white border-soosi-green/30 hover:border-soosi-green'}`}>
                                    <div className="flex items-center gap-3 text-left">
                                        <div className={`p-2 rounded-lg ${termsRead.grooming ? 'bg-soosi-green text-white' : 'bg-[#E8F1EB] text-soosi-green'}`}><Icon name={termsRead.grooming ? "check" : "scissors"} size={20}/></div>
                                        <div>
                                            <div className={`font-bold text-sm text-soosi-dark`}>ã€çŠ¬ã€è²“ç¾å®¹å¥‘ç´„æ¢æ¬¾ã€‘</div>
                                            {!termsRead.grooming && <div className="text-xs text-gray-400">é»æ“Šé–±è®€</div>}
                                        </div>
                                    </div>
                                    <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.grooming ? 'bg-soosi-green text-white' : 'bg-gray-100 text-gray-400'}`}>{termsRead.grooming ? 'å·²å®Œæˆ' : 'å¾…é–±è®€'}</div>
                                </button>

                                {/* 2. ä½å®¿æ¢æ¬¾ (åƒ…ä½å®¿é¡¯ç¤º) */}
                                {isBoarding && (
                                    <button type="button" onClick={() => setActiveModal('boarding')} 
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all animate-in fade-in ${termsRead.boarding ? 'bg-soosi-wood/10 border-soosi-wood' : 'bg-white border-soosi-wood/30 hover:border-soosi-wood'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.boarding ? 'bg-soosi-wood text-white' : 'bg-[#F5EFE9] text-soosi-wood'}`}><Icon name={termsRead.boarding ? "check" : "home"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm text-soosi-dark`}>ã€çŠ¬ã€è²“ä½å®¿å¥‘ç´„æ¢æ¬¾ã€‘</div>
                                                {!termsRead.boarding && <div className="text-xs text-gray-400">é»æ“Šé–±è®€</div>}
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.boarding ? 'bg-soosi-wood text-white' : 'bg-gray-100 text-gray-400'}`}>{termsRead.boarding ? 'å·²å®Œæˆ' : 'å¾…é–±è®€'}</div>
                                    </button>
                                )}

                                {/* 3. é«˜é¢¨éšªç¾å®¹ (è‹¥ç¬¦åˆé¢¨éšªï¼Œç„¡è«–ç¾å®¹æˆ–ä½å®¿éƒ½é¡¯ç¤º) */}
                                {isHighRisk && (
                                    <button type="button" onClick={() => setActiveModal('highRiskGrooming')} 
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all animate-in fade-in ${termsRead.highRiskGrooming ? 'bg-soosi-green/10 border-soosi-green' : 'bg-white border-red-200 hover:border-red-400'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.highRiskGrooming ? 'bg-soosi-green text-white' : 'bg-red-50 text-red-500'}`}><Icon name={termsRead.highRiskGrooming ? "check" : "alert-triangle"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm ${termsRead.highRiskGrooming ? 'text-soosi-green' : 'text-red-600'}`}>ã€é«˜é¢¨éšªã€‘ç¾å®¹æœå‹™é¢¨éšªå‘ŠçŸ¥</div>
                                                <div className="text-xs text-gray-400 font-bold">
                                                    {riskType === 'senior' ? 'æª¢æ¸¬åˆ°æ¯›å­©å·²æ»¿ 8 æ­²' : riskType === 'puppy' ? 'æª¢æ¸¬åˆ°æ¯›å­©æœªæ»¿ 5 å€‹æœˆ' : 'æª¢æ¸¬åˆ°æ¯›å­©æœ‰éå¾€ç—…å²'}ï¼Œè«‹å‹™å¿…è©³é–±
                                                </div>
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.highRiskGrooming ? 'bg-soosi-green text-white' : 'bg-red-100 text-red-600'}`}>{termsRead.highRiskGrooming ? 'å·²åŒæ„' : 'å‹™å¿…è©³é–±'}</div>
                                    </button>
                                )}

                                {/* 4. é«˜é¢¨éšªä½å®¿ (åƒ…ä½å®¿ + ç¬¦åˆé¢¨éšªé¡¯ç¤º) */}
                                {isBoarding && isHighRisk && (
                                    <button type="button" onClick={() => setActiveModal('highRiskBoarding')} 
                                        className={`w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all animate-in fade-in ${termsRead.highRiskBoarding ? 'bg-soosi-wood/10 border-soosi-wood' : 'bg-white border-red-200 hover:border-red-400'}`}>
                                        <div className="flex items-center gap-3 text-left">
                                            <div className={`p-2 rounded-lg ${termsRead.highRiskBoarding ? 'bg-soosi-wood text-white' : 'bg-red-50 text-red-500'}`}><Icon name={termsRead.highRiskBoarding ? "check" : "alert-triangle"} size={20}/></div>
                                            <div>
                                                <div className={`font-bold text-sm ${termsRead.highRiskBoarding ? 'text-soosi-wood' : 'text-red-600'}`}>ã€é«˜é¢¨éšªã€‘ä½å®¿æœå‹™é¢¨éšªå‘ŠçŸ¥</div>
                                                <div className="text-xs text-gray-400 font-bold">
                                                    é‡å°é«˜é½¡ã€å¹¼é½¡æˆ–ç—…å²å¯µç‰©ä¹‹ä½å®¿ç‰¹åˆ¥ç´„å®š
                                                </div>
                                            </div>
                                        </div>
                                        <div className={`text-xs font-bold px-3 py-1 rounded-full ${termsRead.highRiskBoarding ? 'bg-soosi-wood text-white' : 'bg-red-100 text-red-600'}`}>{termsRead.highRiskBoarding ? 'å·²åŒæ„' : 'å‹™å¿…è©³é–±'}</div>
                                    </button>
                                )}

{/* ç§»é™¤æ‰‹å‹•å‹¾é¸æ¡†ï¼Œç›´æ¥ç”±æ¢æ¬¾é–±è®€ç‹€æ…‹æ§åˆ¶ç°½åæ¿è§£é– */}
                        </div>

{/* Signature - ä¾è³´æ¢æ¬¾é–±è®€ç‹€æ…‹ (allTermsRead) */}
                        <div className="space-y-3" id="signature">
                            <div className="flex justify-between items-center">
                                {/* ä¿®æ”¹è™•ï¼šç§»é™¤äº† <span className="text-soosi-red text-xs">â—</span> */}
                                <label className="text-sm font-bold text-soosi-wood flex items-center gap-2"><Icon name="pen-tool" size={16}/> æ•¸ä½ç°½å</label>
                                {realtimeSig && <button onClick={()=>setRealtimeSig(null)} className="text-xs text-red-400 font-bold flex items-center gap-1 bg-red-50 px-2 py-1 rounded-full"><Icon name="trash-2" size={12}/> é‡ç°½</button>}
                            </div>
                            
                            {realtimeSig ? (
                                <div className="space-y-3 animate-in fade-in">
                                    <div className="bg-white rounded-2xl border-2 border-soosi-wood/20 p-6 flex justify-center items-center min-h-[180px] shadow-inner relative overflow-hidden">
                                        <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#8E6E53_1px,transparent_1px)] [background-size:12px_12px]"></div>
                                        <img src={realtimeSig} alt="æ‚¨çš„ç°½å" className="max-h-[150px] object-contain relative z-10" />
                                    </div>
                                    <div className="flex items-center justify-end gap-3">
                                        <div className="bg-soosi-green/10 text-soosi-green px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 shadow-sm border border-soosi-green/20">
                                            <Icon name="check-circle" size={14}/> å·²ç°½ç½²
                                        </div>
                                        <div className="text-xs text-gray-400 font-bold">
                                            ç°½ç½²æ™‚é–“ï¼š{new Date().toLocaleString('zh-TW', { hour12: false, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <button onClick={() => { if(allTermsRead) setShowFullSig(true); else alert('è«‹å…ˆå®Œæˆä¸Šæ–¹æ‰€æœ‰å¥‘ç´„æ¢æ¬¾é–±è®€'); }} 
                                    className={`w-full h-36 border-2 border-dashed rounded-2xl flex flex-col items-center justify-center gap-3 transition-all group ${allTermsRead ? 'border-soosi-green bg-white hover:bg-soosi-green/5 cursor-pointer' : 'border-gray-200 bg-gray-50 cursor-not-allowed opacity-70'}`}>
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center transition-all ${allTermsRead ? 'bg-soosi-green text-white group-hover:scale-110 shadow-md' : 'bg-gray-200 text-gray-400'}`}>
                                        <Icon name={allTermsRead ? "pen-tool" : "lock"} size={20}/>
                                    </div>
                                    <div className="text-center">
                                        <div className={`text-sm font-bold ${allTermsRead ? 'text-soosi-dark' : 'text-gray-400'}`}>{allTermsRead ? "é»æ“Šæ­¤è™•é–‹å§‹ç°½å" : "è«‹å…ˆå®Œæˆä¸Šæ–¹æ¢æ¬¾é–±è®€"}</div>
                                        <div className="text-xs text-gray-400 mt-1">{allTermsRead ? "é–‹å•Ÿå…¨è¢å¹•æ‰‹å¯«æ¿" : "é–±è®€ä¸¦åŒæ„å¾Œè§£é–"}</div>
                                    </div>
                                </button>
                            )}
                            {errors.signature && <div className="field-error"><Icon name="alert-circle" size={12}/>{errors.signature}</div>}
                        </div>

                        {/* Submit */}
                        <button onClick={handleSubmit} disabled={isSubmitting || !realtimeSig} className="w-full py-5 bg-soosi-dark text-white rounded-[2rem] font-black text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 active:scale-[0.98] transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:transform-none">
                            {isSubmitting ? <Icon name="loader-2" className="animate-spin"/> : <Icon name="send" />}
                            {isSubmitting ? 'æäº¤ä¸­...' : 'ç¢ºèªä¸¦æäº¤æ•¸ä½å¥‘ç´„'}
                        </button>
                        </section>
                    </main>

                    {/* Fullscreen Signature Modal */}
                    {showFullSig && (
                        <div className="fullscreen-signature flex flex-col animate-in fade-in duration-200">
                            <div className="bg-soosi-wood text-white p-4 flex justify-between items-center shadow-md shrink-0">
                                <div className="font-bold flex items-center gap-2"><Icon name="pen-tool"/> è«‹ç°½å</div>
                                <button onClick={()=>setShowFullSig(false)}><Icon name="x"/></button>
                            </div>
                            <div className="flex-1 bg-[#F9F7F2] relative touch-none cursor-crosshair overflow-hidden">
                                <canvas ref={sigCanvasRef} className="w-full h-full block"></canvas>
                            </div>
                            <div className="p-4 bg-white border-t flex gap-3 safe-area-bottom shrink-0">
                                <button onClick={()=>{padInstance.current?.clear()}} className="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-bold">é‡å¯«</button>
                                <button onClick={()=>{
                                    if(!padInstance.current?.isEmpty()) {
                                        setRealtimeSig(padInstance.current.toDataURL());
                                        setShowFullSig(false);
                                        if(errors.signature) setErrors(p=>({...p, signature:null}));
                                    } else alert("è«‹å…ˆç°½å");
                                }} className="flex-[2] py-3 bg-soosi-green text-white rounded-xl font-bold shadow-lg">ç¢ºèªç°½å</button>
                            </div>
                        </div>
                    )}

                    {/* Terms Modals */}
                    <TermsModal isOpen={activeModal === 'grooming'} onClose={()=>setActiveModal(null)} title="ç¾å®¹æœå‹™å¥‘ç´„æ¢æ¬¾" onAgree={()=>setTermsRead(p=>({...p, grooming:true}))}>
                         <div className="space-y-4">
                             <div className="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-xs text-yellow-800 font-bold mb-2">
                                 ğŸ’¡ æœ¬æ¢æ¬¾é©ç”¨æ–¼æ‰€æœ‰ç¾å®¹æœå‹™é …ç›®ã€‚
                             </div>
                             <div className="space-y-2">
                                <h5 className="font-black text-base text-soosi-wood">ä¸€ã€å¥åº·èˆ‡å®‰å…¨å‘ŠçŸ¥</h5>
                                <p>1. é£¼ä¸»æ‡‰èª å¯¦å‘ŠçŸ¥å¯µç‰©èº«é«”ç‹€æ³ï¼ˆå¦‚å¿ƒè‡Ÿç—…ã€ç™²ç™‡ã€æ”»æ“Šæ€§ç­‰ï¼‰ã€‚è‹¥éš±çå°è‡´æ„å¤–ï¼Œé£¼ä¸»é ˆè‡ªè¡Œè² è²¬ã€‚</p>
                                <p>2. è‹¥ç™¼ç¾å¯„ç”ŸèŸ²ï¼ˆè·³èš¤å£è¨ï¼‰ï¼Œå°‡å¼·åˆ¶åŸ·è¡Œé™¤èŸ²èˆ‡ç’°å¢ƒæ¸…æ½”è²»ã€‚</p>
                             </div>
                             <div className="space-y-2">
                                <h5 className="font-black text-base text-soosi-wood">äºŒã€ç·Šæ€¥é†«ç™‚</h5>
                                <p>è‹¥ç™¼ç”Ÿç·Šæ€¥ç‹€æ³ï¼Œåº—å®¶å°‡å„ªå…ˆé€å¾€ç‰¹ç´„é†«é™¢ï¼Œç›¸é—œé†«ç™‚è²»ç”¨ç”±é£¼ä¸»è² æ“”ã€‚</p>
                             </div>
                         </div>
                    </TermsModal>

                    <TermsModal isOpen={activeModal === 'boarding'} onClose={()=>setActiveModal(null)} title="ä½å®¿å®‰è¦ªå¥‘ç´„æ¢æ¬¾" onAgree={()=>setTermsRead(p=>({...p, boarding:true}))}>
                         <div className="space-y-4">
                             <div className="bg-blue-50 p-3 rounded-lg border border-blue-200 text-xs text-blue-800 font-bold mb-2">
                                 ğŸ’¡ ä½å®¿æœŸé–“åŒ…å«åŸºæœ¬ç¾å®¹æœå‹™ï¼Œæ•…éœ€åŒæ™‚åŒæ„ç¾å®¹æ¢æ¬¾ã€‚
                             </div>
                             <div className="space-y-2">
                                <h5 className="font-black text-base text-soosi-wood">ä¸€ã€ä½å®¿è¦ç¯„</h5>
                                <p>1. å…¥ä½å‰éœ€ç¢ºèªå·²æ–½æ‰“æ ¸å¿ƒç–«è‹—ï¼ˆç‹‚çŠ¬ç—…ã€å¤šåˆä¸€ï¼‰ã€‚</p>
                                <p>2. ä½å®¿ä»¥ 24 å°æ™‚åˆ¶è¨ˆç®—ï¼Œè¶…æ™‚å°‡åŠ æ”¶å®‰è¦ªè²»ç”¨ã€‚</p>
                             </div>
                             <div className="space-y-2">
                                <h5 className="font-black text-base text-soosi-wood">äºŒã€é£²é£Ÿèˆ‡ä½œæ¯</h5>
                                <p>å»ºè­°è‡ªå‚™é£¼æ–™ä»¥é¿å…è…¸èƒƒä¸é©ï¼Œè‹¥éœ€åº—å®¶æä¾›å°‡å¦æ”¶è²»ç”¨ã€‚</p>
                             </div>
                         </div>
                    </TermsModal>

                    <TermsModal isOpen={activeModal === 'senior'} onClose={()=>setActiveModal(null)} title="é«˜é¢¨éšªå¯µç‰©æœå‹™é¢¨éšªå‘ŠçŸ¥" onAgree={()=>setTermsRead(p=>({...p, senior:true}))}>
                         <div className="space-y-4 border-2 border-red-100 rounded-xl p-4 bg-red-50">
                             <h4 className="font-bold text-center text-lg text-soosi-red border-b border-red-200 pb-2 mb-2">ã€é«˜é¢¨éšªå¯µç‰©åŒæ„æ›¸ã€‘</h4>
                             <p className="font-bold text-soosi-dark">
                                 é‡å° {riskType === 'senior' ? 'é«˜é½¡çŠ¬ (8æ­²ä»¥ä¸Š)' : riskType === 'puppy' ? 'å¹¼çŠ¬ (5å€‹æœˆä»¥ä¸‹)' : 'æ‚£æœ‰éå¾€ç—…å²ä¹‹å¯µç‰©'} ä¹‹ç‰¹åˆ¥ç´„å®šï¼š
                             </p>
                             <ul className="list-disc pl-5 space-y-1 mt-2">
                                <li>æœ¬äººçŸ¥æ‚‰é«˜é½¡/å¹¼é½¡/ç”Ÿç—…å¯µç‰©åœ¨ç¾å®¹æˆ–ä½å®¿éç¨‹ä¸­ï¼Œå› ç·Šè¿«å¯èƒ½å°è‡´æ½›åœ¨ç–¾ç—…ç™¼ä½œã€‚</li>
                                <li>è‹¥å› å¯µç‰©è‡ªèº«å› ç´ ï¼ˆå¦‚å¿ƒè‡Ÿç—…ç™¼ã€ä¼‘å…‹ã€ç™²ç™‡ï¼‰å°è‡´ä¹‹ä¸å¯æŠ—åŠ›æ„å¤–ï¼ŒåŒæ„ä¸è¿½ç©¶åº—å®¶è²¬ä»»ã€‚</li>
                             </ul>
                         </div>
                    </TermsModal>
{/* 3. é«˜é¢¨éšªç¾å®¹ Modal */}
                    <TermsModal isOpen={activeModal === 'highRiskGrooming'} onClose={()=>setActiveModal(null)} title="é«˜é¢¨éšªç¾å®¹æœå‹™é¢¨éšªå‘ŠçŸ¥" onAgree={()=>setTermsRead(p=>({...p, highRiskGrooming:true}))}>
                         <div className="space-y-4 border-2 border-red-100 rounded-xl p-4 bg-red-50">
                             <h4 className="font-bold text-center text-lg text-soosi-red border-b border-red-200 pb-2 mb-2">ã€é«˜é¢¨éšªç¾å®¹åŒæ„æ›¸ã€‘</h4>
                             <p className="font-bold text-soosi-dark text-sm">
                                 é‡å° {riskType === 'senior' ? 'é«˜é½¡çŠ¬ (8æ­²ä»¥ä¸Š)' : riskType === 'puppy' ? 'å¹¼çŠ¬ (5å€‹æœˆä»¥ä¸‹)' : 'æ‚£æœ‰éå¾€ç—…å²ä¹‹å¯µç‰©'} ä¹‹ç¾å®¹ç‰¹åˆ¥ç´„å®šï¼š
                             </p>
                             <ul className="list-disc pl-5 space-y-2 mt-2 text-sm text-soosi-dark">
                                <li>æœ¬äººçŸ¥æ‚‰é«˜é½¡/å¹¼é½¡/ç”Ÿç—…å¯µç‰©åœ¨æ´—æ¾¡ã€å¹æ•´éç¨‹ä¸­ï¼Œå› ç·Šè¿«å¯èƒ½å°è‡´æ½›åœ¨ç–¾ç—…ç™¼ä½œï¼ˆå¦‚ä¼‘å…‹ã€ç™²ç™‡ï¼‰ã€‚</li>
                                <li>ç¾å®¹å¸«å°‡ç›¡åŠ›æ¡å–æº«å’Œæ‰‹æ®µï¼Œè‹¥å¯µç‰©ç„¡æ³•è² è·å°‡éš¨æ™‚ä¸­æ­¢æœå‹™ã€‚</li>
                                <li>è‹¥ç™¼ç”Ÿä¸å¯æŠ—åŠ›ä¹‹æ„å¤–ï¼ˆéäººç‚ºè“„æ„å‚·å®³ï¼‰ï¼ŒåŒæ„ä¸è¿½ç©¶åº—å®¶è²¬ä»»ã€‚</li>
                             </ul>
                             <p className="text-xs text-gray-500 mt-2 text-center">-- å®Œæ•´æ¢æ¬¾å¾…è£œ --</p>
                         </div>
                    </TermsModal>

                    {/* 4. é«˜é¢¨éšªä½å®¿ Modal */}
                    <TermsModal isOpen={activeModal === 'highRiskBoarding'} onClose={()=>setActiveModal(null)} title="é«˜é¢¨éšªä½å®¿æœå‹™é¢¨éšªå‘ŠçŸ¥" onAgree={()=>setTermsRead(p=>({...p, highRiskBoarding:true}))}>
                         <div className="space-y-4 border-2 border-red-100 rounded-xl p-4 bg-red-50">
                             <h4 className="font-bold text-center text-lg text-soosi-red border-b border-red-200 pb-2 mb-2">ã€é«˜é¢¨éšªä½å®¿åŒæ„æ›¸ã€‘</h4>
                             <p className="font-bold text-soosi-dark text-sm">
                                 é‡å° {riskType === 'senior' ? 'é«˜é½¡çŠ¬ (8æ­²ä»¥ä¸Š)' : riskType === 'puppy' ? 'å¹¼çŠ¬ (5å€‹æœˆä»¥ä¸‹)' : 'æ‚£æœ‰éå¾€ç—…å²ä¹‹å¯µç‰©'} ä¹‹ä½å®¿ç‰¹åˆ¥ç´„å®šï¼š
                             </p>
                             <ul className="list-disc pl-5 space-y-2 mt-2 text-sm text-soosi-dark">
                                <li>æœ¬äººçŸ¥æ‚‰å¤œé–“ç„¡äººç…§è­·æ™‚æ®µï¼Œè‹¥å¯µç‰©å› è‡ªèº«ç–¾ç—…ç™¼ä½œï¼ˆå¦‚å¿ƒè‡Ÿç—…ã€å˜”åçª’æ¯ï¼‰å°è‡´æ„å¤–ï¼Œåº—å®¶ç„¡æ³•å³æ™‚è™•ç½®ã€‚</li>
                                <li>åŒæ„æˆæ¬Šåº—å®¶æ–¼ç·Šæ€¥æ™‚åˆ»é€²è¡Œé†«ç™‚è™•ç½®ï¼Œè²»ç”¨ç”±é£¼ä¸»è² æ“”ã€‚</li>
                                <li>å·²ç¢ºèªå¯µç‰©èº«é«”ç‹€æ³é©åˆä½å®¿ï¼Œç„¡éš±çé‡å¤§ç—…æƒ…ã€‚</li>
                             </ul>
                             <p className="text-xs text-gray-500 mt-2 text-center">-- å®Œæ•´æ¢æ¬¾å¾…è£œ --</p>
                         </div>
                    </TermsModal>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

